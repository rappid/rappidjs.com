define(["sprd/manager/ITextConfigurationManager","flow","sprd/entity/Size","text/entity/TextFlow","text/entity/ParagraphElement","text/entity/SpanElement","sprd/type/Style","text/entity/TextRange"],function(e,t,n,r,i,s,o,u){return e.inherit("sprd.manager.TextConfigurationManager",{initializeConfiguration:function(e,a){var f=e.$$||{},l=f.svg,c=e.$.printType,h=e.$context.$contextModel,p,d=h.$context.$contextModel.getCollection("fontFamilies");t().seq(function(){var e=window.navigator}).par(function(e){c.fetch(null,e)},function(e){d.fetch({fullData:!0},e)}).seq(function(){f&&f.printArea?p=h.$.productType.getPrintAreaById(f.printArea.$.id):p=e.$.printArea}).seq(function(){e.set({printArea:p})}).seq(function(){if(l){var t=l.text,a=l.viewBox.split(" "),f=new r,h=t.content,v={},m=/^(\w+)\(([^(]+)\)/ig,g;if(g=m.exec(t.transform)){var y=g[1],b=g[2].split(",");y==="rotate"&&(v.rotation=parseFloat(b.shift()))}var w=null,E=null,S=t.width;for(var x=0;x<h.length;x++){var T=h[x];if(!w||T.hasOwnProperty("y"))E&&E.mergeElements(),E=new i({style:new o({textAnchor:T.textAnchor||t.textAnchor})}),f.addChild(E);S=Math.max(S,T.lineWidth||0),w=T,t.hasOwnProperty("printColorId")&&(T.printColorId=T.printColorId||t.printColorId),T.fill=T.fill||t.fill,T.fontFamilyId=T.fontFamilyId||t.fontFamilyId,T.fontId=T.fontId||t.fontId,T.fontSize=T.fontSize||t.fontSize;var N;T.printColorId&&(N=c.getPrintColorById(T.printColorId)),N=N||c.getClosestPrintColor(T.fill);var C=new s({style:new o({lineHeight:1.2,font:d.createItem(T.fontFamilyId).getFontById(T.fontId),fontSize:T.fontSize,printTypeColor:N}),text:T.content[0]||""});E.addChild(C)}v.textFlow=f,v.selection=u.createTextRange(0,0),v.textArea=new n({width:S+2*parseFloat(a[0]),height:t.height}),e.set(v)}else if(!e.textArea){var k=p.get("defaultBox")||p.get("boundary.size");e.set("textArea",new n({width:e.get(k,"width"),height:e.get(k,"height")}))}}).exec(a)}})});