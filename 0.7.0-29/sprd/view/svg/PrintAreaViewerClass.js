define(["js/svg/SvgElement","xaml!sprd/view/svg/ConfigurationViewer","js/core/List"],function(e,t,n){return e.inherit("sprd.view.svg.PrintAreaViewerClass",{defaults:{tagName:"g",componentClass:"print-area",productTypeViewViewer:null,product:null,productViewer:null,snapLines:null,snapLinesGroup:null,_viewMap:null,imageService:null},$classAttributes:["product","productTypeViewViewer","productViewer","snapLines","snapLinesGroup","imageService"],ctor:function(){this.$configurationViewerCache={},this.callBase()},_commitProductViewer:function(e){e&&e.$.editable?this.$.snapLines=new n:this.$.snapLines=null},_initializeRenderer:function(){this.translate(this.get("_viewMap.offset.x"),this.get("_viewMap.offset.y"));var t=this.get("_viewMap.transformations.operations");t&&this.$.transformations.add(new e.Transform({transform:t}));var n=this.createComponent(e,{tagName:"rect",componentClass:"print-area-border",width:this.get("_viewMap.printArea.boundary.size.width"),height:this.get("_viewMap.printArea.boundary.size.height")}),r=this.get("_viewMap.printArea.boundary.soft.content.svg.path.d");r&&(r=this.createComponent(e,{tagName:"path",componentClass:"soft-boundary-border",d:r}));var i=this.get("_viewMap.printArea.defaultBox");i&&(i=this.createComponent(e,{tagName:"rect",componentClass:"print-area-default-box",x:i.x,y:i.y,width:i.width,height:i.height})),this.addChild(n),i&&this.addChild(i),r&&this.addChild(r);var s=this.$.productViewer;s&&s.$.editable&&this.addChild(this.$.snapLinesGroup),this.callBase()},initialize:function(){this.bind("product.configurations","add",this._onConfigurationAdded,this),this.bind("product.configurations","change",this._onConfigurationChanged,this),this.bind("product.configurations","remove",this._onConfigurationRemoved,this),this.bind("product.configurations","reset",this._onConfigurationsReset,this),this.bind("product","change:configurations",this._onConfigurationsReset,this),this.callBase()},_onConfigurationsReset:function(e){var t=this;this._removeConfigurationViewer(),this.$.product&&this.$.product.$.configurations&&this.$.product.$.configurations.each(function(e){t._addConfiguration(e)})},_onConfigurationAdded:function(e){this._addConfiguration(e.$.item)},_onConfigurationRemoved:function(e){this._removeConfiguration(e.$.item)},_addConfiguration:function(e){if(!e)return;if(!e.$.printArea)return;if(e.$.printArea.$.id!==this.get("_viewMap.printArea.id"))return;var n=e.$cid;if(!this.$configurationViewerCache.hasOwnProperty(n)){var r=this.$configurationViewerCache[n]=this.createComponent(t,{product:this.$.product,printAreaViewer:this,_viewMap:this.get("_viewMap"),productViewer:this.$.productViewer,configuration:e,imageService:this.$.imageService});this.addChild(r),this.$.productViewer.trigger("add:configurationViewer",r)}},getViewerForConfiguration:function(e){for(var t in this.$configurationViewerCache)if(this.$configurationViewerCache.hasOwnProperty(t)&&this.$configurationViewerCache[t].$.configuration===e)return this.$configurationViewerCache[t];return null},_renderProduct:function(e,t){t&&this._removeConfigurationViewer();var n=this;e&&e.$.configurations&&e.$.configurations.each(function(e){n._addConfiguration(e)})},_removeConfiguration:function(e){if(!e)return;var t=this.$configurationViewerCache[e.$cid];t&&(t.remove(),t.destroy())},_removeConfigurationViewer:function(){for(var e in this.$configurationViewerCache)if(this.$configurationViewerCache.hasOwnProperty(e)){var t=this.$configurationViewerCache[e];t.remove(),t.destroy()}this.$configurationViewerCache={}},_onConfigurationChanged:function(e){if(e&&this._hasSome(e.$.changedAttributes,["printArea"])){var t=e.$.item;t.$.printArea===this.get("_viewMap.printArea")?this._addConfiguration(t):this._removeConfiguration(t)}}})});