define(["js/svg/Svg","sprd/data/ImageService","sprd/view/svg/ProductTypeViewViewer"],function(e,t,n){return e.inherit("sprd.view.ProductViewerSvg",{defaults:{height:300,width:300,view:null,product:null,_productType:"{product.productType}",_appearance:null,_view:null,selectedConfiguration:null,selected:"{selectedConfiguration}",componentClass:"product-viewer {product.appearanceBrightness()}",editable:!0},$classAttributes:["product","view","editable","selectedConfiguration","imageService"],ctor:function(){this.$productTypeViewViewerCache={},this.callBase()},initialize:function(){this.bind("product.productType","change:views",this._onViewsChanged,this),this.callBase()},_removeProductTypeViewViewers:function(){for(var e in this.$productTypeViewViewerCache)this.$productTypeViewViewerCache.hasOwnProperty(e)&&(this.$productTypeViewViewerCache[e].remove(),this.$productTypeViewViewerCache[e].destroy());this.$productTypeViewViewerCache={}},_onViewsChanged:function(){this._determinateInternalView()},_commitView:function(){this._determinateInternalView()},_determinateInternalView:function(){var e=this.$.view,t=this.$._productType;t&&(e?this.set("_view",t.getViewById(e.$.id)):this.set("_view",t.getDefaultView()))},_render_productType:function(e,t){t&&this._removeProductTypeViewViewers(),e&&(this._determinateInternalView(),this._renderProductTypeView(e,this.$._view))},_render_view:function(e){if(!e)return;var t=e.get("size.width"),n=e.get("size.height");if(t<0||n<0)t=n=500;e&&this.setViewBox(0,0,t,n),this._renderProductTypeView(this.$._productType,e)},_commitProduct:function(e){var t=this.$productTypeViewViewerCache;for(var n in t)t.hasOwnProperty(n)&&t[n].set("product",e)},_renderProductTypeView:function(e,t){if(e&&t&&e.containsView(t)){var r=e.$.id+"_"+t.$.id,i=t.get("size.width"),s=t.get("size.height");if(i<0||s<0)i=s=500;t&&this.setViewBox(0,0,i,s),this.$productTypeViewViewerCache[r]||(this.$productTypeViewViewerCache[r]=this.createComponent(n,{product:this.$.product,productViewer:this,_view:t,_productType:e,imageService:this.$.imageService})),this.$currentProductTypeViewViewer&&this.$currentProductTypeViewViewer.remove(),this.$currentProductTypeViewViewer=this.$productTypeViewViewerCache[r],this.addChild(this.$currentProductTypeViewViewer)}},destroy:function(){this._removeProductTypeViewViewers(),this.callBase()},getViewerForConfiguration:function(e){return this.$currentProductTypeViewViewer?this.$currentProductTypeViewViewer.getViewerForConfiguration(e):null}})});