define(["require","js/core/Component","underscore","moment","flow"],function(e,t,n,r,i){return t.inherit("js.core.I18n",{defaults:{path:"app/locale",locale:null,suffix:".json",translations:{},loadMomentJs:!0},initialize:function(){this.callBase(),this.loadLocale(this.$.locale)},_commitChangedAttributes:function(e){e.locale&&this.loadLocale(e.locale)},loadLocale:function(t,n){var r=this;if(!t){n&&n("locale not defined");return}i().par(function(t){e(["json!"+r.$.path+"/"+r.$.locale],function(e){r.set({translations:e}),t()},function(e){r.log(e,"error"),t()})},function(t){r.$.loadMomentJs?e([r.$.path+"/"+r.$.locale],function(){r.trigger("localeChanged"),t()},function(e){r.log(e,"error"),t()}):t()}).exec(n)},t:function(e,t,r,i){var s=Array.prototype.slice.call(arguments),o;t=s.shift(),n.isNumber(t)&&(o=t!==1,t=s.shift()),o&&(t+="_plural");var u=this.$.translations[t]||this.get(this.$.translations,t)||"";for(var a=0;a<s.length;a++)u=u.split("%"+a).join(s[a]);return u}.onChange("translations"),ts:function(e,t,r,i){var s=Array.prototype.slice.call(arguments),o=[],u=s.shift(),a;return!s.length||s[0]==null?"":(n.isNumber(u)&&(a=u,u=s.shift()),u+="."+s.shift(),o=a?[a]:[],o.push(u),o=o.concat(s),this.t.apply(this,o))}.onChange("translations"),f:function(e,t){return e instanceof Date?(t=t||"LLL",r(e).format(t)):e instanceof r?(t=t||"LLL",e.format(t)):e}.on("localeChanged")})});