define(["js/ui/View","js/data/Collection","js/core/List"],function(e){var t={HORIZONTAL:"horizontal",VERTICAL:"vertical"};return e.inherit("js.ui.SliderClass",{defaults:{componentClass:"slider",position:"relative",min:1,max:100,step:1,range:!1,value:1,startValue:1,orientation:t.HORIZONTAL},events:["on:input"],_handleDown:function(e,t){e.preventDefault();var n=this.$stage.$window;this.$currentHandle=e.target,e.target.focus();if(!this._windowUpListener||!this._windowMoveListener){var r=this;this._windowUpListener=function(e){return r._handleWindowUp(e)},this._windowMoveListener=function(e){return r._handleWindowMove(e)}}this.dom(n).bindDomEvent("pointerup",this._windowUpListener),this.dom(n).bindDomEvent("pointermove",this._windowMoveListener)},_getMaxValueForHandle:function(e){var t=this.$.max;return this.$.range&&e===this.$.startHandle&&(t=this.$.value-this.$.step),t},_getMinValueForHandle:function(e){var t=this.$.min;return this.$.range&&e===this.$.mainHandle&&(t=this.$.startValue+this.$.step),t},_getMaxValue:function(){var e=this.$.max;return this.$.range&&this.$currentHandle===this.$.mainHandle&&(e=this.$.startValue-this.$step),e},_handleWindowMove:function(e){if(this.$currentHandle){var n,r,i,s,o;n=this.globalToLocal({x:e.pageX,y:e.pageY}),r=this.$.max-this.$.min,i=this._getMaxValueForHandle(this.$currentHandle),s=this._getMinValueForHandle(this.$currentHandle),this.$.orientation==t.HORIZONTAL?o=n.x/this.$el.offsetWidth*r:o=(this.$el.offsetHeight-n.y)/this.$el.offsetHeight*r,o=Math.round(o),o+=this.$.min;var u=(o+this.$.min)%this.$.step;u!==0&&u>=this.$.step*.5?o=o-u+this.$.step:o-=u,o=Math.min(i,o),o=Math.max(s,o),this.$currentHandle===this.$.mainHandle?this.set("value",o):this.set("startValue",o),this.trigger("on:input",{value:this.$.value,startValue:this.$.startValue})}},_handleKeyDown:function(e){var t=0,n=e.target===this.$.mainHandle?"value":"startValue";switch(e.domEvent.which){case 39:t=this.$.step;break;case 37:t=-this.$.step}var r=this.get(n)+t,i=this._getMaxValueForHandle(e.target),s=this._getMinValueForHandle(e.target);r=Math.min(i,this.get(n)+t),r=Math.max(s,r),this.set(n,r)},_renderValue:function(e){this._updateHandle(this.$.mainHandle,e)},_renderStartValue:function(e){this.$.range&&this._updateHandle(this.$.startHandle,e)},_onDomAdded:function(){this.callBase(),this._renderValue(this.$.value),this._renderStartValue(this.$.startValue)},_renderOrientation:function(e,t){t&&this.removeClass(t),this.addClass(e)},_updateHandle:function(e,n){var r=(n-this.$.min)/(this.$.max-this.$.min),i=this.$.sliderBar.$el,s,o="offsetWidth",u="left",a="right";this.$.orientation==t.VERTICAL&&(o="offsetHeight",u="bottom",a="top");var f=this.$el[o];s=f*r,e.$el.style[u]=s-e.$el[o]*.5+"px",e===this.$.mainHandle?(i.style[a]=f-s+"px",this.$.range||(i.style[u]="0px")):i.style[u]=s+"px"},_handleWindowUp:function(e){this.$currentHandle=null,this.dom(this.$stage.$window).unbindDomEvent("pointerup",this._windowUpListener),this.dom(this.$stage.$window).unbindDomEvent("pointermove",this._windowUpListener)}})});