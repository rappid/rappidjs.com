define(["xaml!sprd/view/Image","sprd/data/ImageService"],function(e,t){var n=/\/views\/(\d+)/,r=/\/appearances\/(\d+)/;return e.inherit("sprd.view.ProductTypeImage",{defaults:{type:"preview",productType:null,componentClass:"sprd-image product-type-image product-type-{productType.id}",appearance:null,view:null},inject:{imageService:t},imageUrl:function(){var e=null,t=this.$.imageService,i=this.$.productType,s,o,u;if(i){s=i.$.id;if(this.$.type==="preview"){o=this.$.view?this.$.view.$.id:null;if(!o){var a=i.getDefaultView();a&&(o=a.$.id)}var f=i.$.resources;this.$.appearance&&(u=this.$.appearance.$.id,i.getAppearanceById(u)||(u=null));if(f instanceof Array)for(var l=0;l<f.length;l++){if(o&&u)break;var c;o||(c=n.exec(f[l].href),c&&(o=c[1])),u||(c=r.exec(f[l].href),c&&(u=c[1]))}return u||(u=i.getDefaultAppearanceId()),o||(o=i.getDefaultViewId()),t.productTypeImage(s,o,u,{width:Math.max(this.$.width||0,this.$.height||0),height:Math.max(this.$.width||0,this.$.height||0)})}if(this.$.type==="size")return t.productTypeSizeImage(s,{width:this.$.width,height:this.$.height})}return e}.onChange("width","height","productType","appearance","view"),alt:function(){return this.$.productType?this.$.productType.$.name:null}.onChange("productType")})});