define(["js/core/Component","underscore","flow"],function(e,t,n){return e.inherit("sprd.tracking.Omniture",{defaults:{enabled:!0,debug:!1,maxTries:10},events:["on:trackingInitialized"],ctor:function(){this.$trackQueue=[],this.$trackedEvents=[],this.$tracker=null,this.callBase()},_initializationComplete:function(){function i(){e++,n.s&&t.isObject(n.s)?(r.$tracker=n.s,r.trigger("on:trackingInitialized"),r._trackQueue()):(r.$.maxTries<=0||e<r.$.maxTries)&&setTimeout(i,200)}var e=0,n=this.$stage.$window,r=this;this.callBase(),this.runsInBrowser()&&i()},_queueOrExecute:function(e){if(!this.runsInBrowser()||!this.$.enabled)return;if(this.$tracker)try{e.apply(this.$tracker)}catch(t){this.log(t,"error")}else this.$trackQueue.push(e)},_trackQueue:function(){var e=this;n().seqEach(this.$trackQueue,function(t){t.apply(e.$tracker)}).exec(function(){e.$trackQueue=[]})},_debug:function(e){this.$.debug&&this.log(e)},track:function(e,n,r){n=n||{};if(e){if(t.indexOf(this.$trackedEvents,e)!==-1)return;this.$trackedEvents.push(e)}var i=t.clone(n);r&&(i.events=(r||[]).join(",")),this._queueOrExecute(function(){if(typeof qaContext!="undefined"&&qaContext.getTrackings())try{qaContext.getTrackings().push({service:"omniture",type:"track",data:i})}catch(e){}this.t(i)});if(this.$.debug){var s="";for(var o in i)i.hasOwnProperty(o)&&(s+=o+": "+i[o]+", ");this._debug(s)}}})});