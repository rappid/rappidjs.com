define(["js/core/Component","underscore","flow"],function(e,t,n){return e.inherit("sprd.tracking.Optimizely",{defaults:{enabled:!0,debug:!1,maxTries:10},events:["on:trackingInitialized"],ctor:function(){this.$trackQueue=[],this.$trackedEvents=[],this.$tracker=null,this.callBase()},_initializationComplete:function(){function i(){e++;var s=n.optimizely;s&&t.isObject(s)&&!t.isArray(s)&&"trackEvent"in s?(r.$tracker=s,r.trigger("on:trackingInitialized"),r._trackQueue()):(r.$.maxTries<=0||e<r.$.maxTries)&&setTimeout(i,200)}var e=0,n=this.$stage.$window,r=this;this.callBase(),this.runsInBrowser()&&i()},_queueOrExecute:function(e){if(!this.runsInBrowser()||!this.$.enabled)return;if(this.$tracker)try{e.apply(this.$tracker)}catch(t){this.log(t,"error")}else this.$trackQueue.push(e)},_trackQueue:function(){var e=this;n().seqEach(this.$trackQueue,function(t){t.apply(e.$pageTracker)}).exec(function(){e.$trackQueue=[]})},activate:function(e){this._queueOrExecute(function(){this.activate(e)})},activateSiteCatalyst:function(e){var t;e&&(t={sVariable:e}),this._queueOrExecute(function(){this.activateSiteCatalyst(t)})},delayPageviewTracking:function(e){this._queueOrExecute(function(){this.delayPageviewTracking(e)})},optOut:function(){this._queueOrExecute(function(){this.optOut()})},_debug:function(e){this.$.debug&&this.log(e)},trackEvent:function(e,t){this._queueOrExecute(function(){if(typeof qaContext!="undefined"&&qaContext.getTrackings())try{qaContext.getTrackings().push({service:"optimizely",type:"event",data:{eventName:e,data:t}})}catch(n){}this.trackEvent(e,t)}),this._debug("trackEvent: "+[e,JSON.stringify(t||{})].join(", "))}})});