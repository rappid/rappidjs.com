define(["underscore","js/core/List","js/type/Color"],function(e,t,n){var r={white:16777215,black:0,blue:2245802,red:12130326,grey:13421772,brown:6703919,green:6723891,yellow:16774400,turquoise:706527,pink:16469633},i={},s={},o=[],u={},a={},f={},l={};return{initProductTypeColorCache:function(e){var t,u,a,f,l,c,h;o=[];for(var p in r)r.hasOwnProperty(p)&&(t=n.parse(r[p]),t.key=p,o.push(t),s[t.toString()]=t);e.each(function(e){a=null,i[e.$.id]=c={};var n=e.getAvailableAppearances();if(n)for(var r=0;r<o.length;r++)u=Number.MAX_VALUE,a=null,f=null,t=o[r],n.each(function(e){l=t.distanceTo(e.getMainColor()),l<u&&(u=l,a=t,f=e),u<30&&(h=a.toString(),c[h]||(c[h]=[]),f===e?c[h].unshift(e):c[h].push(e))})})},initProductTypeSizeCache:function(e){var t,n;e.each(function(e,r){t=u[e.$.name]={order:r},e.$.categories.each(function(r){n=a[r.identifier()]={},r.$.productTypes.each(function(r){r.$.sizes&&(r.$.sizes.each(function(e){t[e.$.name]||(t[e.$.name]={productTypes:[]}),t[e.$.name].productTypes.push(r),n[e.$.name]||(n[e.$.name]={productTypes:[]}),n[e.$.name].productTypes.push(r)}),f[e.$.name]=f[e.$.name]||{},f[e.$.name][r.$.id]=e.$.name,l[r.$.id]||(l[r.$.id]=[]),l[r.$.id].push(e))})})})},getGroupedSizes:function(e,t){function n(e,t){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push({name:r,departmentName:t,productTypes:e[r].productTypes});return n}var r=u;if(e){var i,s,o;r={},e.each(function(e){t?o=[t]:o=l[e.$.id];if(o)for(var n=0;n<o.length;n++)s=o[n].$.name,i=r[s]=r[s]||{},e.$.sizes&&e.$.sizes.each(function(t){i[t.$.name]||(i[t.$.name]={productTypes:[]}),i[t.$.name].productTypes.push(e)})})}var a=[],f;for(var c in r)r.hasOwnProperty(c)&&(f={name:c,items:n(r[c],c)},a.push(f));return a},hasProductTypeColor:function(e,t){return t&&i[e.$.id]&&i[e.$.id].hasOwnProperty(t.toString())},hasProductTypeSize:function(e,t){return t&&f[t.departmentName]&&f[t.departmentName][e.$.id]===t.departmentName&&e.getSizeByName(t.name)},getAppearanceForProductTypeAndColor:function(e,t){if(t&&e){var n=i[e.$.id],r=n[t.toString()];if(r&&r.length)return r[0]}return null},getColorsForProductTypes:function(e){var t,n=[];return e.each(function(e){t=i[e.$.id];for(var r in t)t.hasOwnProperty(r)&&n.indexOf(s[r])===-1&&n.push(s[r])}),n}}});