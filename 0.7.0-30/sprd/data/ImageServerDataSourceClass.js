define(["sprd/data/SprdDataSource","js/data/Model","js/data/RestDataSource","js/data/DataSource","sprd/model/processor/UploadDesignProcessor"],function(e,t,n,r,i){var s={},o=e.inherit("sprd.data.ImageServerDataSourceClass",{defaults:{parsePayloadOnUpdate:!1},$processors:{UploadDesignProcessor:i},_saveModel:function(e,n,r){if(e._status()!==t.STATE.CREATED){r("Model isn't created");return}this.callBase()},getFormatProcessor:function(e,t){var n=t.$.image.$.type,r=t.$.image.$.file?"file":"remote",i=n+"_"+r;return s[i]||(r==="file"?s[n]=new o.FileSystemImageFormatProcessor(n):s[n]=new o.RemoteImageFormatProcessor(n)),s[n]},getQueryParameter:function(e,t){return _.defaults({mediaType:t.$.file.type.split("/").pop()},this.callBase())}});return o.FileSystemImageFormatProcessor=r.FormatProcessor.inherit({ctor:function(e){this.$type=e,this.callBase()},serialize:function(e){var t=new FormData;return t.append("upload_field",e.image.file),t},getContentType:function(){return!1}}),o.RemoteImageFormatProcessor=r.FormatProcessor.inherit({ctor:function(e){this.$type=e,this.callBase()},serialize:function(e){return'<reference xmlns="http://api.spreadshirt.net" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+e.image.src+'" />'},getContentType:function(){return"application/xml"}}),o});