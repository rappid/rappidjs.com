define("js/data/validator/Validator",["js/core/Bindable","js/core/Base"],function(e,t){var n=function(){return!0},r=e.inherit("js.data.validator.Validator",{$validatorCache:{},defaults:{field:null,errorCode:"isInvalid",errorMessage:null,condition:null},ctor:function(){this.callBase();var e=this._generateCacheKey.apply(this,arguments);return e&&!this.$validatorCache[e]&&(this.$validatorCache[e]=this),this.$validatorCache[e]},_generateCacheKey:function(){return null},validate:function(e,r,i){function f(e,n){if(o){s.log("Validator returned twice. Ignore second return",t.LOGLEVEL.WARN);return}o=!0,i(e,n)}r instanceof Function&&(i=r,r={}),r=r||{};var s=this,o=!1,u=this.$.condition||n;if(!this._validationRequired(e)){f(null);return}try{f(null,this._validate(e))}catch(a){f(a)}},_validationRequired:function(e){return!(this.$.field&&!e.$[this.$.field]&&!e.schema[this.$.field].required)},_validate:function(e){throw new Error("abstract method _validate from Validator")},_getErrorMessage:function(){return this.$.field?(this.$.errorMessage||"Field '%' is invalid").replace("%",this.$.field):this.$.errorMessage||"Entity is invalid"},_createError:function(e,t,n){return new r.Error({code:e,message:t,field:n})},_createFieldError:function(e){return this._createError(this.$.errorCode,this._getErrorMessage(),e||this.$.field)}});return r.Error=e.inherit({}),r}),define("js/data/Entity",["require","js/core/Bindable","js/core/List","flow","js/data/validator/Validator","underscore"],function(e,t,n,r,i,s){var o,u=t.inherit("js.data.Entity.ValidationErrors",{firstError:function(){for(var e in this.$)if(this.$.hasOwnProperty(e)&&this.$[e])return this.$[e];return null}.on("change"),size:function(){return s.size(this.$)}.on("change")}),a=t.inherit("js.data.Entity",{ctor:function(e){this.$errors=new u,this.$entityInitialized=!1,this._extendSchema(),this.callBase()},schema:{},validators:[],idField:"id",createdField:!1,updatedField:!1,$context:null,$dependentObjectContext:null,$isEntity:!0,$isDependentObject:!0,_extendSchema:function(){if(this.factory.schema){this.schema=this.factory.schema;return}var t=this.base;while(t.factory.classof(a)){var n=t.schema;for(var r in n)n.hasOwnProperty(r)&&!this.schema.hasOwnProperty(r)&&(this.schema[r]=n[r]);t=t.base}var i={required:!0,includeInIndex:!1,serverOnly:!1,_rewritten:!0,compose:!1},o;this.idField&&!this.schema.hasOwnProperty(this.idField)&&(this.schema[this.idField]={type:String,required:!1,serverOnly:!1,includeInIndex:!0,generated:!0}),this.updatedField&&!this.schema.hasOwnProperty(this.updatedField)&&(this.schema[this.updatedField]={type:Date,required:!1,serverOnly:!1,includeInIndex:!0,generated:!0}),this.createdField&&!this.schema.hasOwnProperty(this.createdField)&&(this.schema[this.createdField]={type:Date,required:!1,includeInIndex:!0,serverOnly:!1,generated:!0});for(var u in this.schema)if(this.schema.hasOwnProperty(u)){o=this.schema[u];var f=s.isString(o);if(f||o instanceof Array||o instanceof Function)o={type:f?e(o.replace(/\./g,"/")):o},this.schema[u]=o;s.defaults(o,i),o._key=u}this.factory.schema=this.schema},getContextForChild:function(e){return this._isChildFactoryDependentObject(e)?(this.$dependentObjectContext||(this.$parentEntity?this.$dependentObjectContext=this.$parentEntity.$dependentObjectContext:this.$dependentObjectContext=this.$context.$dataSource.createContext(this)),this.$dependentObjectContext):this.$context.$dataSource.getContextForChild(e,this)},createEntity:function(e,t){var n=this.getContextForChild(e);return n.createEntity(e,t)},_isChildFactoryDependentObject:function(e){return e&&e.prototype.$isDependentObject},parse:function(e,t,n){return e},compose:function(e,t){return s.clone(this.$)},clearErrors:function(){this.$errors.clear(),this.trigger("isValidChanged",{},this)},errors:function(){return this.$errors}.on("isValidChanged"),fieldError:function(e){return this.$errors.$[e]}.on("isValidChanged"),isValid:function(){var e=this.$errors.$;for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}.on("isValidChanged"),validate:function(e,t){e instanceof Function&&(t=e,e={}),e=e||{},s.defaults(e,{setErrors:!0,reset:!0,fields:null});var n=this,o=[],u;for(var f=0;f<this.validators.length;f++)u=this.validators[f],e.fields&&e.fields.length>0?e.fields.indexOf(u.$.field)>-1&&o.push(u):o.push(u);var l=[];o.unshift(new a.SchemaValidator),r().parEach(o,function(t,r){t.validate(n,e,function(e,t){!e&&t&&(t instanceof i.Error?l.push(t):t instanceof Array&&(l=l.concat(t))),r(e)})}).exec(function(r){e.setErrors===!0&&n._setErrors(l,e),t&&t(r,l.length===0?null:l)})},_setError:function(e,t){e instanceof Object?this.$errors.set(e):this.$errors.set(e,t),this.trigger("isValidChanged")},_setErrors:function(e,t){if(t.fields&&t.fields.length){var n;for(var r=0;r<t.fields.length;r++)n=t.fields[r],this.$errors.unset(n)}else this.$errors.clear();var i;try{for(var s=0;s<e.length;s++)i=e[s],i.$.field&&!this.$errors.$.hasOwnProperty(i.$.field)?this.$errors.set(i.$.field,i):this.$errors.$.hasOwnProperty("_base")||this.$errors.set("_base",i)}catch(o){this.log(o,"warn")}this.trigger("isValidChanged")},error:function(e){return e?this.$errors.get(e):null},validateSubEntity:function(e,t){e instanceof a?e.validate(null,t):t("parameter is not an entity")},clone:function(){var e=this.callBase();return e.$context=this.$context,e.$parent=this.$parent,e},_cloneAttribute:function(e,t){if(e instanceof n){if(this.schema.hasOwnProperty(t)){var r=this.schema[t].type;if(r instanceof Array&&r.length&&r[0].classof&&r[0].classof(a)&&!r[0].prototype.$isEntity){var i=new n;return i._$source=e,i.add(e.$items),i}}}else if(e instanceof a&&!e.$isEntity)return e;return this.callBase()},init:function(e){e&&e()},identifier:function(){return this.$[this.idField]},contextModel:function(){return this.$context?this.$context.$contextModel:null}});return a.SchemaValidator=i.inherit("js.data.validator.SchemaValidator",{validate:function(e,t,i){t instanceof Function&&(i=t,t={}),t=t||{};var s=[],o=[],u=e.$,f=e.schema,l,c,h,p;try{for(var d in f)if(f.hasOwnProperty(d)){if(t.fields&&t.fields.length>0&&t.fields.indexOf(d)===-1)continue;c=u[d],l=f[d],h=l.type;if(this._isUndefined(c,l)&&this._isRequired(e,l))s.push(this._createError("isUndefinedError",d+" is required",d));else if(c&&!this._isValidType(c,l.type))s.push(this._createError("wrongTypeError",d+" is from wrong type",d));else if(c instanceof a)o.push({key:d,value:c});else if(c instanceof n&&!c.isCollection)if(c.size()>0&&c.at(0)instanceof a)for(var v=0;v<c.$items.length;v++)o.push({key:d,value:c.$items[v]});else c.size()===0&&(!this.runsInBrowser()||!l.generated)&&this._isRequired(e,l.required)===!0&&s.push(this._createError("isEmptyError",d+" are empty",d))}}catch(m){p=m||!0}var g=this;r().seq(function(){if(p)throw p}).seqEach(o,function(t,n){e.validateSubEntity(t.value,function(e,r){r&&s.push(g._createError("associationError",t.key+" is not valid",t.key)),n(e)})}).exec(function(e){i(e,s)})},_isValidType:function(e,t){return t===String&&!s.isString(e)?!1:t===Number&&!s.isNumber(e)?!1:t===Boolean&&!s.isBoolean(e)?!1:t!==Array||e instanceof n||e instanceof Array?t!==Date||e instanceof Date?!t.classof||!t.classof(a)||e instanceof t?t===Object&&!s.isObject(e)?!1:!0:!1:!1:!1},_isUndefined:function(e,t){var n=t.type;return n&&n.isCollection?!1:(!this.runsInBrowser()||!t.generated)&&(e===o||e===null||e==="")},_isRequired:function(e,t){if(t.type&&t.type.prototype&&t.type.prototype.isCollection)return!1;var n=t.required;return n instanceof Function?n.call(e):n}}),a}),define("js/data/Model",["js/data/Entity","js/core/List","flow","underscore"],function(e,t,n,r){function a(e,t,n){r.each(e,function(e,r){if(e instanceof u||e instanceof require("js/data/Collection")){var i=t[r];i&&(i.found=!0,n.push(function(t){e.fetch({fetchSubModels:i.subModels},t)}))}else e instanceof Object})}function f(e,t,i,s){var o=function(e,t){s&&s(e,t,i)};if(e)o(e,t);else{var f=[];if(i.fetchSubModels&&i.fetchSubModels.length>0){var l=u.createSubModelLoadingChain(t,i.fetchSubModels);a(t.$,l,f);var c=r.filter(l,function(e){return!e.found});if(c.length>0){this.log(["requested submodel missing",c],"warn"),o("requested submodel missing",t);return}}n().par(f).exec(function(e){o(e,t)})}}var i={CREATED:0,LOADING:1,LOADED:2,ERROR:-1},s={CREATED:0,SAVING:1},o={NEW:0,CREATED:1,DELETED:-1},u=e.inherit("js.data.Model",{ctor:function(e){this._fetch={callbacks:[],state:i.CREATED},this._save={callbacks:[],state:s.CREATED},this.callBase(e)},schema:{href:{type:String,generated:!0,required:!1,includeInIndex:!0}},hrefField:"href",updatedField:"updated",createdField:"created",$isEntity:!1,$isDependentObject:!1,save:function(e,t){e=e||{},r.defaults(e,{invalidatePageCache:!1});if(this._save.state===s.SAVING)t&&this._save.callbacks.push(t);else{this._save.state=s.SAVING;var n=this;try{var i=this._status();if(i!==o.NEW&&i!==o.CREATED)throw new Error("status '"+i+"' doesn't allow save");this.$context.$dataSource.saveModel(this,e,function(i){n._save.state=i?s.ERROR:s.CREATED,!i&&n.$collection&&e.invalidatePageCache&&n.$collection.invalidatePageCache(),t&&t(i,n,e),r.each(n._save.callbacks,function(e){e.call(n,i,n)}),n._save.callbacks=[]})}catch(u){n._save.state=s.ERROR,t&&t(u),r.each(n._save.callbacks,function(e){e.call(n,err,n)}),n._save.callbacks=[]}}},validateAndSave:function(e,t){var r=this;n().seq(function(t){r.validate(e,t)}).seq(function(t){r.isValid()?r.save(e,t):t("Model is not valid!")}).exec(function(e){t&&t(e,r)})},getCollection:function(e){var t=this.schema[e];if(!t)throw"Couldn't find '"+e+"' in schema";var n=this.get(e);if(!n){var r=this.getContextForChild(t.type);if(!r)throw"Couldn't determine context for "+e;n=r.createCollection(t.type,null),n.$parent=this,this.set(e,n)}return n},compose:function(e,t){var n=this.callBase();return e==="create"&&n.hasOwnProperty(this.idField)&&[this.idField]===null&&delete n[this.idField],n},fetch:function(e,t){arguments.length===1&&e instanceof Function&&(t=e,e=null),e=e||{};var n=this;this._fetch.state===i.LOADING?this._fetch.callbacks.push(function(n,r){f(n,r,e,t)}):this._fetch.state==i.LOADED&&!e.noCache?f(null,this,e,t):(n._fetch.state=i.LOADING,this.$context.$dataSource.loadModel(this,e,function(s,o){n._fetch.state=s?i.ERROR:i.LOADED,f.call(n,s,o,e,t),r.each(n._fetch.callbacks,function(e){e.call(n,s,o)})}))},remove:function(e,t){try{var n=this._status(),r=this;if(n!==o.CREATED)throw new Error("status '"+n+"' doesn't allow delete");this.$context.$dataSource.removeModel(this,e,function(e){e||(r.set("id",!1),r.$collection&&r.$collection.remove(r)),t&&t(e)})}catch(i){t&&t(i)}},validateSubEntity:function(e,t){e instanceof u?t():this.callBase()},_status:function(){return this.identifier()===!1?o.DELETED:this.identifier()?o.CREATED:o.NEW}.on("change"),isNew:function(){return this._status()===o.NEW}.on("change"),isCreated:function(){return this._status()===o.CREATED}.on("change"),convertIdentifier:function(e){var t=this.idField;if(this.schema.hasOwnProperty(t)){var n=this.schema[t];if(n.type&&n.type===Number)return parseInt(e)}return e}});return u.createSubModelLoadingChain=function(e,t){var n={};return r.each(t,function(e){if(e){var t=e.split("/"),r=t.shift(),i=n[r]||{};n[r]=i,i.found=!1,i.type=r,i.subModels=[]||i.subModels,t.length>0&&i.subModels.push(t.join("/"))}}),n},u.STATE=o,u.FETCHSTATE=i,u}),define("sprd/data/SprdModel",["js/data/Model"],function(e){return e.inherit("sprd.data.SprdModel",{})}),define("js/data/Query",["Query"],function(e){var t=e.inherit("js.data.Query",{ctor:e,hasSortExpressions:function(){return this.query&&this.query.sort&&this.query.sort.length>0}});return t.query=function(){return new t},t.Where=e.Where,t.Comparator=e.Comparator,t}),define("js/data/Collection",["require","js/core/List","js/data/Model","flow","underscore","js/data/Query"],function(e,t,n,r,i,s){var o={CREATED:0,LOADING:1,LOADED:2,ERROR:-1},u={UNKNOWN:0,COUNTING:1,COUNTED:-1},a=t.inherit("js.data.Collection",{$modelFactory:n,isCollection:!0,ctor:function(t,n){n=n||{},i.defaults(n,{root:null,query:null,pageSize:null,queryParameters:{},sortParameters:null,factory:this.$modelFactory||e("js/data/Model"),type:null}),this.$filterCache={},this.$sortCache={},this._count={callbacks:[],state:u.UNKNOWN},n.root&&(i.defaults(n,n.root.options),this.$modelFactory=n.root.$modelFactory),this.callBase(t,n),this.$pageCache=[]},filter:function(e){var t=this.getRoot();if(e instanceof s){var n=i.defaults({},{query:e,root:t},t.$),r=e.whereCacheId(),o=t.$filterCache;if(r)return o[r]||(o[r]=this._createFilteredCollection(e,n)),o[r]}return t},_createFilteredCollection:function(e,t){t.$itemsCount=undefined;var n=new this.factory(null,t);return n.$context=this.$context,n},_createSortedCollection:function(e,t){var n=new this.factory(null,t);return n.$context=this.$context,n},sort:function(e){if(e instanceof s&&e.query.sort){this.$.query&&(e.query.where=this.$.query.query.where);var t=i.defaults({},{query:e,root:this.getRoot()},this.$),n=e.sortCacheId();return this.$sortCache[n]||(this.$sortCache[n]=this._createSortedCollection(e,t)),this.$sortCache[n]}return this},query:function(e){return this.filter(e).sort(e)},getRoot:function(){return this.$.root||this},fetch:function(e,t){e instanceof Function&&(t=e,e=null),e=e||{};var n=this;if(e.limit||e.offset){var i=new f(null,this,0);i.fetch(e,function(n){!n&&!i.itemsInsertedIntoCollection&&(i.itemsInsertedIntoCollection=!0),t&&t(n,i,e)})}else{function s(i){function o(t){s.push(function(r){n.fetchPage(t,e,r)})}var s=[];for(var u=0;u<i;u++)o(u);r().par(s).exec(function(e){t&&t(e,n)})}if(!this.$.pageSize)this.fetchPage(0,e,t);else{var o=this.pageCount();isNaN(o)?this.fetchPage(0,e,function(e){e?t&&t(e,n):(o=n.pageCount(),isNaN(o)?t&&t("Count for collection couldn't be fetched.",n):s(o))}):s(o)}}},pageCount:function(){return this.$.hasOwnProperty("$itemsCount")?Math.ceil(this.$.$itemsCount/this.$.pageSize):NaN},getContextForChild:function(e){return this.$context},parse:function(e){return e},createItem:function(e){var t=this.getContextForChild(this.$modelFactory).createEntity(this.$modelFactory,e);return t.$parent=this.$parent,t.$collection=this,t},fetchPage:function(e,t,n){if(e<0)throw"pageIndex must be >= 0";var r=this.$pageCache[e];r||(r=this.$pageCache[e]=new f(null,this,e));var s=this;t=i.extend(this.$,t),r.fetch(t,function(r,i){!r&&!i.itemsInsertedIntoCollection&&(i.itemsInsertedIntoCollection=!0,s.add(i.$items,{index:(e||0)*s.$.pageSize})),n&&n(r,i,t)})},count:function(e,t){var n=this;this.$context.$dataSource.countCollection(this,e,function(e,r){e||n.set("$itemsCount",r),t&&t(e,r)})},invalidatePageCache:function(){this.$pageCache={};for(var e in this.$filterCache)this.$filterCache.hasOwnProperty(e)&&this.$filterCache[e].invalidatePageCache();for(e in this.$sortCache)this.$sortCache.hasOwnProperty(e)&&this.$sortCache[e].invalidatePageCache();this.set("$itemsCount",NaN,{silent:!0}),this.reset([])},size:function(){return this.$.$itemsCount}.onChange("$itemsCount"),isEmpty:function(){var e=this.pageCount();return isNaN(e)?!1:e===0}.onChange("$itemsCount"),getQueryParameters:function(e){return this.$.queryParameters},getSortParameters:function(e){return this.$.sortParameters},destroy:function(){this.callBase()}}),f=a.Page=t.inherit({ctor:function(e,t,n){if(!t.$.pageSize&&n!==0)throw"Cannot create page for index '"+n+"' with pageSize '"+t.options.pageSize+"'";var r=t.$;r.pageSize&&(this.$offset=n*r.pageSize,this.$limit=r.pageSize),this.$pageIndex=n,this.$collection=t,this.callBase(e),this._fetch={callbacks:[],state:o.CREATED}},setMetaData:function(e){this.$metaData=e,e&&e.hasOwnProperty("count")&&this.$collection.set("$itemsCount",e.count)},parse:function(e,t){return this.getRoot().parse(e,t)},getRoot:function(){return this.$collection.getRoot()},getCollection:function(){return this.$collection},fetch:function(e,t){function s(t,n,i){var s=function(t,n){i&&i(t,n,e)};e.fetchModels||e.fetchSubModels?r().parEach(n.$items,function(t,n){t.fetch({fetchSubModels:e.fetchSubModels},n)}).exec(function(e){s(e,n)}):s(t,n)}e=e||{};if(e.limit||e.offset)this.$offset=e.offset||0,this.$limit=e.limit||this.$limit;var n=this;this._fetch.state===o.LOADING?this._fetch.callbacks.push(function(e,n){s(e,n,t)}):this._fetch.state==o.LOADED?s(null,this,t):(n._fetch.state=o.LOADING,this.$collection.$context.$dataSource.loadCollectionPage(this,e,function(e,r){n._fetch.state=e?o.ERROR:o.LOADED,s(e,r,t),i.each(n._fetch.callbacks,function(t){t(e,r)})}))}});return a.of=function(e){if(e instanceof Function)return a.inherit(a.prototype.constructor.name+"["+e.prototype.constructor.name+"]",{$modelFactory:e});throw"Cannot create Collection of '"+e+"'."},a}),define("sprd/entity/Offset",["js/data/Entity"],function(e){return e.inherit("sprd.entity.Offset",{defaults:{x:0,y:0,unit:"mm"},schema:{x:Number,y:Number,unit:String},compose:function(){var e=this.callBase();return{x:Math.round(e.x,3),y:Math.round(e.y,3),unit:e.unit}}})}),define("sprd/entity/Size",["js/data/Entity"],function(e){var t=e.inherit("sprd.entity.Size",{defaults:{width:0,height:0,unit:"mm"},schema:{width:Number,height:Number,unit:String}});return t.empty=new t,t}),define("sprd/model/Currency",["sprd/data/SprdModel","underscore"],function(e,t){var n=["USD","GBP"];return e.inherit("sprd.model.Currency",{defaults:{decimalCount:2},formatPrice:function(e,t){return e?(t=t||"vatIncluded",this.formatValue(e.get(t))):null}.on("change"),formatValue:function(e){var r=Math.pow(10,this.$.decimalCount);e=Math.round(e*r)/r,e=(new String(e)).split(".");var i=e.length;i===1?e.push("00"):e[1].length<this.$.decimalCount?e[1]+="0":e[1].length>this.$.decimalCount&&(e[1]=e[1].substr(0,2));if(this.$.pattern){var s=t.include(n,this.$.isoCode),o=s?".":",";e=this.$.pattern.replace("%",e.join(o)).replace("$",this.$.symbol),s&&(e=e.replace(" ",""))}return e}.on("change")})}),define("sprd/entity/Price",["js/data/Entity","sprd/model/Currency"],function(e,t){return e.inherit("sprd.entity.Price",{defaults:{vatExcluded:0,vatIncluded:0,vat:0,currency:t},schema:{vatExcluded:Number,vatIncluded:Number,vat:Number,currency:t},formattedPrice:function(){var e=this.$.currency;return e?e.formatPrice(this):null},add:function(e){e&&this.set({vatIncluded:this.$.vatIncluded+e.$.vatIncluded,vatExcluded:this.$.vatExcluded+e.$.vatExcluded})}})}),define("js/type/Color",["js/core/Base"],function(e){String.prototype.right||(String.prototype.right=function(e){return this.substr(this.length-e)});var t=e.inherit("js.type.Color",{distanceTo:function(e){return t.calculateColorDistance(this,e)}},{parse:function(e){return e instanceof t?e:/^#[0-9A-F]{3,6}$/i.test(e)?t.fromHexString(e):Object.prototype.toString.call(e)==="[object Number]"?t.fromHex(e):e instanceof Object&&"r"in e&&"g"in e&&"b"in e?new t.RGB(e.r,e.g,e.b):null},fromHexString:function(e){return t.fromHex(parseInt("0x"+e.replace(/^#/,"")))},fromHex:function(e){return new t.RGB(e>>16&255,e>>8&255,e&255)},calculateColorDistance:function(e,n){e=t.parse(e),n=t.parse(n);var r=e.toLAB(),i=n.toLAB();return Math.sqrt(Math.pow(i.l-r.l,2)+Math.pow(i.a-r.a,2)+Math.pow(i.b-r.b,2))}});return t.RGB=t.inherit("js.type.Color.RGB",{ctor:function(e,t,n){this.r=e||0,this.g=t||0,this.b=n||0},toRGB:function(){return this},toHSB:function(){var e=this.r/255,n=this.g/255,r=this.b/255,i=0,s=0,o,u,a;e>=n?u=e:u=n,r>u&&(u=r),e<=n?a=e:a=n,r<a&&(a=r),o=u;var f=u-a;return u==0?s=0:s=f/u,s!=0&&(e==u?i=(n-r)/f:n==u?i=2+(r-e)/f:r==u&&(i=4+(e-n)/f),i*=60,i<0&&(i+=360)),new t.HSB(i,s*100,o*100)},toXYZ:function(){var e=this.r/255,n=this.g/255,r=this.b/255;return e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,r>.04045?r=Math.pow((r+.055)/1.055,2.4):r/=12.92,e*=100,n*=100,r*=100,new t.XYZ(e*.4124+n*.3576+r*.1805,e*.2126+n*.7152+r*.0722,e*.0193+n*.1192+r*.9505)},toLAB:function(){return this.toXYZ().toLAB()},toHex:function(){return this.r<<16|this.g<<8|this.b},invert:function(){return new t.RGB(255-this.r,255-this.g,255-this.b)},toString:function(){return"#"+this.toHexString()},toHexString:function(){return("0"+this.r.toString(16)).right(2)+("0"+this.g.toString(16)).right(2)+("0"+this.b.toString(16)).right(2)},clone:function(){return new this.factory(this.r,this.g,this.b)}}),t.HSB=t.inherit("js.type.Color.HSB",{ctor:function(e,t,n){this.h=e||0,this.s=t||0,this.b=n||0},toRGB:function(){var e=0,n=0,r=0,i,s,o,u,a=this.h/60,f=this.s/100,l=this.b/100;i=a>>0,s=l*(1-f),o=l*(1-f*(a-i)),u=l*(1-f*(1-a+i));switch(i){case 0:e=l,n=u,r=s;break;case 1:e=o,n=l,r=s;break;case 2:e=s,n=l,r=u;break;case 3:e=s,n=o,r=l;break;case 4:e=u,n=s,r=l;break;case 5:e=l,n=s,r=o}return new t.RGB(e*255>>0,n*255>>0,r*255>>0)},toXZY:function(){return this.toRGB().toXZY()},toLAB:function(){return this.toRGB().toLAB()},toHSB:function(){return this},toString:function(){return this.toRGB().toString()},toHexString:function(){return this.toRGB().toHexString()},clone:function(){return new this.factory(this.h,this.s,this.b)}}),t.XYZ=t.inherit("js.type.Color.XYZ",{ctor:function(e,t,n){this.x=e,this.y=t,this.z=n},toLAB:function(){var e=95.047,n=100,r=108.883,i=this.x/e,s=this.y/n,o=this.z/r;return i>.008856?i=Math.pow(i,1/3):i=7.787*i+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116,o>.008856?o=Math.pow(o,1/3):o=7.787*o+16/116,new t.LAB(116*s-16,500*(i-s),200*(s-o))},toXYZ:function(){return this},clone:function(){return new this.factory(this.x,this.y,this.z)}}),t.LAB=t.inherit("js.type.Color.LAB",{ctor:function(e,t,n){this.l=e,this.a=t,this.b=n},clone:function(){return new this.factory(this.l,this.a,this.b)}}),t}),define("sprd/entity/PrintTypeColor",["js/data/Entity","sprd/entity/Price","js/type/Color"],function(e,t,n){return e.inherit("sprd.entity.PrintTypeColor",{defaults:{price:t},schema:{name:String,fill:String,price:t},parse:function(e){return e=this.callBase(),e.fill=n.parse(e.fill),e},getPrintType:function(){return this.$parent},color:function(){return this.$.fill},toHexString:function(){return this.$.fill?this.$.fill.toRGB().toString():null}})}),define("sprd/model/PrintType",["sprd/data/SprdModel","sprd/entity/Size","sprd/entity/PrintTypeColor","js/data/Entity","js/type/Color","sprd/entity/Price"],function(e,t,n,r,i,s){var o={ENLARGEABLE:"enlargeable",SHRINKABLE:"shrinkable",UNUSABLE:"unusable",UNSCALABLE:"unscalable"},u={PrintColors:"print_colors",CMYK:"cmyk",RGB:"rgb"},a=e.inherit("sprd.model.PrintType",{defaults:{dpi:null,price:s},schema:{dpi:String,size:t,colors:[n],price:s},printColorCache:{},getClosestPrintColor:function(e){e=i.parse(e);if(this.isPrintColorColorSpace()){var t=null,r=null;return this.$.colors.each(function(n){var i=e.distanceTo(n.color());if(t===null||i<t)t=i,r=n}),r}var s=this.$.id+"_"+e.toRGB().toString();if(!this.printColorCache[s]){var o=new n({fill:e,price:this._getDigitalPrintColorPrice()});o.$parent=this,this.printColorCache[s]=o}return this.printColorCache[s]},getPrintColorById:function(e){if(this.$.colors)for(var t=0;t<this.$.colors.$items.length;t++){var n=this.$.colors.$items[t];if(n.$.id==e)return n}return null},isPrintColorColorSpace:function(){return this.get("restrictions.colorSpace")===u.PrintColors},_getDigitalPrintColorPrice:function(){return this.$digitalPrintColorPrice||(this.$digitalPrintColorPrice=new s),this.$digitalPrintColorPrice},isScalable:function(){var e=this.get("restrictions.scaleability");return e!==o.UNUSABLE&&e!==o.UNSCALABLE},isEnlargeable:function(){return this.get("restrictions.scaleability")===o.ENLARGEABLE},isShrinkable:function(){return this.get("restrictions.scaleability")===o.SHRINKABLE},containsPrintTypeColor:function(e){if(!e)return!1;if(this.isPrintColorColorSpace()){var t=!1;return this.$.colors.each(function(n){n.$.id==e.$.id&&n.$.name==e.$.name&&(t=!0)}),t}return!0}});return a.Restrictions=r.inherit("sprd.model.PrintType.Restrictions",{defaults:{colorSpace:u.PrintColors,whiteSupported:!0,transparencySupported:!0,scaleability:o.ENLARGEABLE,maxPrintColorLayers:3},schema:{colorSpace:String,whiteSupported:Boolean,transparencySupported:Boolean,scaleability:String,maxPrintColorLayers:Number,printableAlongWithPrintTypes:[a],printableAbovePrintTypes:[a]}}),a.Mapping={DigitalTransfer:"1",Flock:"2",OffsetTransfer:"3",ScreenPrintTransfer:"4",ScreenPrint:"5",NylonFlex:"6",Sticker:"7",ThermalSublimation:"10",ColdTransfer:"11",Flex:"14",SpecialFlex:"16",DigitalDirect:"17",LaserPrinter:"20",ButtonPrint:"21"},a.prototype.schema.restrictions=a.Restrictions,a.Restrictions.SCALEABILITY=o,a.Restrictions.COLOR_SPACE=u,a}),define("sprd/entity/PrintArea",["js/data/Entity","sprd/model/PrintType","sprd/entity/Size"],function(e,t,n){var r=e.inherit("sprd.entity.PrintArea.Restriction",{defaults:{textAllowed:!0,designAllowed:!0,excludedPrintTypes:[]},schema:{textAllowed:Boolean,designAllowed:Boolean,excludedPrintTypes:[t]}}),i=e.inherit("sprd.entity.PrintArea",{defaults:{restrictions:r,boundary:null,_size:"{boundary.size}",_softBoundary:"{boundary.soft}",defaultBox:null},schema:{restrictions:r},getProductType:function(){return this.$parent},hasSoftBoundary:function(){return!!this.$._softBoundary&&!!this.$._softBoundary.content}.onChange("_softBoundary"),_commit_size:function(e){e&&this.set("defaultBox",{x:e.width/6,y:e.height/7,width:e.width*4/6,height:e.height*5/7})},getDefaultView:function(){var e=this.getProductType();return this.$.defaultView&&e?e.getViewById(this.$.defaultView.id):null},height:function(){return this.get("_size.height")}.onChange("_size"),width:function(){return this.get("_size.width")}.onChange("_size")});return i.Restriction=r,i}),define("sprd/entity/ViewMap",["js/data/Entity","sprd/entity/Offset","sprd/entity/PrintArea"],function(e,t,n){return e.inherit("sprd.entity.ViewMap",{defaults:{transformations:""},schema:{transformations:String,printArea:n,offset:t},getProductType:function(){return this.$parent},getDefaultPrintArea:function(){var e=this.$.id,t,n,r=this.printAreas();for(n=0;n<r.length;n++){t=r[n];if(t.id===e)return t}return r[0]},getViewMaps:function(){var e=[],t=this.$parent;if(t)for(var n=0;n<this.$.viewMaps.length;n++){var r=this.$.viewMaps[n];if(r.id===this.$.id){var i=t.getPrintAreaById(r.printArea.id);i&&e.push(i)}}return e},printAreas:function(){var e=[],t=this.$parent;if(t)for(var n=0;n<t.$.viewMaps.$items.length;n++){var r=t.$.viewMaps.$items[n];r.id===this.$.id&&e.push(r.$.printArea)}return e}})}),define("sprd/entity/ProductTypeView",["js/data/Entity","sprd/entity/ViewMap","sprd/entity/Size","underscore"],function(e,t,n,r){return e.inherit("sprd.entity.ProductTypeView",{schema:{name:String,perspective:String,viewMaps:[t],size:n},getProductType:function(){return this.$parent},getDefaultPrintArea:function(){var e;if(this.$.viewMaps)for(var t=0;t<this.$.viewMaps.$items.length;t++){e=this.$.viewMaps.$items[t].$.printArea;if(e)return e}return null},getViewMapForPrintArea:function(e){if(e)for(var t=0;t<this.$.viewMaps.$items.length;t++){var n=this.$.viewMaps.$items[t];if(n&&n.$.printArea===e)return n}return null},getPrintAreas:function(){var e=[];return this.$.viewMaps.each(function(t){e=e.concat(t.printAreas())}),e},containsPrintArea:function(e){return e&&r.indexOf(this.getPrintAreas(),e)!==-1}})}),define("sprd/entity/AppearanceColor",["js/data/Entity","js/type/Color"],function(e,t){return e.inherit("sprd.entity.AppearanceColor",{schema:{index:Number,value:String},parse:function(e){return e=this.callBase(),e.value=t.parse(e.value),e},color:function(){return this.$.value}})}),define("sprd/entity/Appearance",["js/data/Entity","sprd/model/PrintType","sprd/entity/AppearanceColor"],function(e,t,n){return e.inherit("sprd.entity.Appearance",{schema:{name:String,printTypes:[t],colors:[n]},getMainColor:function(){return this.get("colors[0].value")}})}),define("sprd/model/StockState",["sprd/data/SprdModel","sprd/entity/Appearance","js/data/Entity"],function(e,t,n){return e.inherit("sprd.model.StockState",{schema:{appearance:t,size:n}})}),define("sprd/collection/StockStates",["js/data/Collection","sprd/model/StockState"],function(e,t){return e.inherit("sprd.collection.StockStates",{$modelFactory:t,isSizeAndAppearanceAvailable:function(e,t){return this.each(function(n){n.$.size.$.id===e.$.id&&n.$.appearance.$.id===t.$.id&&this["return"](n.$.available)})||!1}})}),define("sprd/entity/ProductTypeSize",["js/data/Entity"],function(e){var t=["XS","S","M","L","XL","XXL","3XL","4XL","5XL"];return e.inherit("sprd.entity.ProductTypeSize",{schema:{measures:[e]},isNormalSize:function(){for(var e=0;e<t.length;e++)if(t[e].toLowerCase()===this.$.name.toLowerCase())return!0;return!1}})}),define("sprd/model/ProductType",["sprd/data/SprdModel","sprd/entity/ProductTypeView","js/data/Entity","sprd/entity/Appearance","sprd/collection/StockStates","js/core/List","sprd/entity/ProductTypeSize","sprd/entity/PrintArea","js/type/Color","sprd/entity/Price"],function(e,t,n,r,i,s,o,u,a,f){return e.inherit("sprd.model.ProductType",{schema:{views:[t],appearances:[r],printAreas:[u],sizes:[o],price:f,stockStates:i},defaults:{availableAppearances:s,outOfStock:!1},getViewById:function(e){if(this.$.views)for(var t=0;t<this.$.views.$items.length;t++){var n=this.$.views.$items[t];if(n.$.id==e)return n}return null},containsView:function(e){return this.$.views?this.$.views.includes(e):!1},containsAppearance:function(e){return this.$.appearances?this.$.appearances.includes(e):!1},containsSize:function(e){return this.$.sizes?this.$.sizes.includes(e):!1},getSizeById:function(e){return this.$.sizes?this.$.sizes.each(function(t){t.$.id==e&&this["return"](t)}):null},getSizeByName:function(e){return this.$.sizes?this.$.sizes.each(function(t){t.$.name==e&&this["return"](t)}):null},getDefaultView:function(){return this.$.defaultValues?this.getViewById(this.getDefaultViewId()):null},getDefaultViewId:function(){return this.$.defaultValues?this.$.defaultValues.defaultView.id:null},getPrintAreaById:function(e){if(this.$.printAreas)for(var t=0;t<this.$.printAreas.$items.length;t++){var n=this.$.printAreas.$items[t];if(n.$.id==e)return n}return null},getDefaultAppearance:function(){return this.getAppearanceById(this.getDefaultAppearanceId())},getDefaultAppearanceId:function(){return this.$.defaultValues?this.$.defaultValues.defaultAppearance.id:null},getAppearanceById:function(e){if(this.$.appearances){var t;for(var n=0;n<this.$.appearances.$items.length;n++){t=this.$.appearances.$items[n];if(e==t.$.id)return t}}return null},getClosestAppearance:function(e){e=a.parse(e);var t=null,n=null,r=this.$.appearances;return r&&r.each(function(r){var i=e.distanceTo(r.getMainColor());if(n===null||i<n)n=i,t=r}),t},getViewByPerspective:function(e){if(this.$.views)for(var t=0;t<this.$.views.$items.length;t++){var n=this.$.views.$items[t];if(n.$.perspective==e)return n}return null},getDefaultPrintArea:function(){return this.$.printAreas?this.$.printAreas.at(0):null},getAvailableSizesForAppearance:function(e){if(!e)return null;var t=new s;if(!this.$.sizes||!this.$.stockStates)return this.$.sizes;var n;for(var r=0;r<this.$.sizes.length;r++)n=this.$.sizes.at(r),this.$.stockStates.isSizeAndAppearanceAvailable(n,e)&&t.add(n);return t}.on(["stockStates","reset"]),isSizeAndAppearanceAvailable:function(e,t){return this.$.stockStates?this.$.stockStates.isSizeAndAppearanceAvailable(e,t):!1}.on(["stockStates","reset"]),getMeasures:function(){return this.$.sizes&&this.$.sizes.size()>0?this.$.sizes.at(0).$.measures:[]}.onChange("sizes"),getFirstAvailableAppearance:function(){var e=this.getAvailableAppearances();return e?e.at(0):null}.onChange("stockStates"),isOutOfStock:function(){var e=this.getAvailableAppearances();return e&&e.size()>0},getAvailableAppearances:function(){if(this._cachedAvailableAppearances)return this._cachedAvailableAppearances;if(this.$.stockStates){this._cachedAvailableAppearances=new s;var e=this;return this.$.appearances.each(function(t){e.getAvailableSizesForAppearance(t).size()>0&&e._cachedAvailableAppearances.add(t)}),this._cachedAvailableAppearances}return null}.onChange("stockStates"),_commitStockStates:function(e){e&&(this._cachedAvailableAppearances=null)}})}),define("sprd/model/ProductBase",["sprd/data/SprdModel","sprd/model/ProductType","sprd/entity/Appearance","sprd/entity/Price"],function(e,t,n,r){return e.inherit("sprd.model.ProductBase",{schema:{productType:t,appearance:{type:n,isReference:!0},restrictions:Object,defaultValues:Object,price:{type:r,generated:!0}},defaults:{productType:null,appearance:null,view:null},ctor:function(){this.callBase()},price:function(){return this.$.price}.onChange("price"),getDefaultView:function(){if(this.$.productType){var e=this.getDefaultViewId();return e!==null?this.$.productType.getViewById(e):this.$.productType.getDefaultView()}return null},getDefaultViewId:function(){return this.$.defaultValues?this.$.defaultValues.defaultView.id:null},getDefaultAppearance:function(){return this.$.appearance&&this.$.productType?this.$.productType.getAppearanceById(this.$.appearance.$.id):null},compose:function(){var e=this.callBase();e.restrictions={freeColorSelection:!1,example:!1};var t=this.get("view.id");return t&&(e.defaultValues={defaultView:{id:t}}),e}})}),define("js/data/TypeResolver",["js/core/Base"],function(e){return e.inherit("js.data.TypeResolver",{resolve:function(e,t){return null}})}),define("js/data/AttributeTypeResolver",["js/data/TypeResolver"],function(e){return e.inherit("js.data.AttributeTypeResolver",{ctor:function(e){e=e||{},e.attribute=e.attribute||"type";if(!e.mapping)throw new Error("no mapping defined");this.$options=e},resolve:function(e,t){var n=this.$options,r=n.mapping;for(var i in r)if(r.hasOwnProperty(i)&&i===e[n.attribute])return r[i];return null}})}),define("sprd/type/Matrix2d",["js/core/Base"],function(e){var t=e.inherit("sprd.type.Matrix2d",{ctor:function(e){this.components=e||[1,0,0,0,1,0,0,0,1]},translate:function(e,t){return this.multiply([1,0,e,0,1,t,0,0,1])},scale:function(e,t){return this.multiply([e,0,0,0,t,0,0,0,1])},rotate:function(e){return this.multiply([Math.cos(e),-Math.sin(e),0,Math.sin(e),Math.cos(e),0,0,0,1])},rotateDeg:function(e){return this.rotate(Math.PI*e/180)},multiply:function(e){return t.multiply(this,e)},transformPoint:function(e){var t=Array.prototype.slice.call(arguments);if(t.length>1)e=[t[0],t[1],t[2]||1];else if(e instanceof Array)e=[e[0],e[1],e[2]||1];else{if(!(e instanceof Object))throw new Error("unknown point format");e=[e.x,e.y,1]}var n=this.components,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=e[0],p=e[1],d=e[2];return[r*h+i*p+s*d,o*h+u*p+a*d,f*h+l*p+c*d]},clone:function(){return new t(this.components)}},{getComponents:function(e){return e instanceof t?e.components:e},multiply:function(e,n){e=t.getComponents(e),n=t.getComponents(n);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return new t([h*r+p*o+d*f,h*i+p*u+d*l,h*s+p*a+d*c,v*r+m*o+g*f,v*i+m*u+g*l,v*s+m*a+g*c,y*r+b*o+w*f,y*i+b*u+w*l,y*s+b*a+w*c])}});return t}),define("sprd/util/ArrayUtil",["underscore","js/core/List"],function(e,t){return{getAsArray:function(e){return e instanceof t?e.$items:e},average:function(){var t=[],n=Array.prototype.slice.call(arguments);if(n.length===1)return n[0];if(n.length>0){var r=n[0];for(var i=0;i<r.length;i++){var s=r[i],o=!0;for(var u=1;u<n.length;u++)if(!e.contains(n[u],s)){o=!1;break}o&&t.push(s)}}return t},removeDuplicates:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];t.indexOf(r)===-1&&t.push(r)}return t}}}),define("sprd/util/ProductUtil",["underscore","sprd/util/ArrayUtil","js/core/List","sprd/model/ProductType","flow","sprd/entity/Price"],function(e,t,n,r,i,s){return{getPossiblePrintTypesForDesignOnPrintArea:function(e,n,r){return t.average(e.$.printTypes.$items,this.getPossiblePrintTypesForPrintAreas([n],r))},getPossiblePrintTypesForDesignOnProduct:function(e,t){return this.getPossiblePrintTypesForDesignOnPrintArea(e,t.$.view.getDefaultPrintArea(),t.$.appearance.$.id)},getPossiblePrintTypesForTextOnPrintArea:function(e,n,r){return t.average(e.$.printTypes.$items,this.getPossiblePrintTypesForPrintAreas([n],r))},getPossiblePrintTypesForPrintAreas:function(n,r){var i=[];return n=t.getAsArray(n),e.each(n,function(t){var n=t.$parent,s=n.getAppearanceById(r);s&&e.each(s.$.printTypes.$items,function(n){!e.contains(t.$.restrictions.$.excludedPrintTypes.$items,n)&&!e.contains(i,n)&&i.push(n)})}),i},getCheapestPriceForDesignOnProduct:function(e,t){var n=this.getPossiblePrintTypesForDesignOnProduct(e,t),r=null;if(n.length)for(var i=0;i<n.length;i++){var o=new s,u=n[i];if(u.isPrintColorColorSpace()){var a=u.getClosestPrintColor(e.$.colors.at(0).$.default);o.add(a.$.price)}o.add(u.$.price),o.add(e.$.price);if(!r||r.$.vatIncluded>o.$.vatIncluded)r=o}return r},fetchColorsForProductTypes:function(e,t,r){t=t||2;var s=new n;i().parEach(e,function(e,t){e.fetch(null,t)}).seqEach(e,function(e,n){e.$.appearances.each(function(e){var n=!1;s.each(function(r){n=e.$.color.distanceTo(r)<t}),n||s.add(e.$.color)})}).exec(function(e){r(e,s)})}}}),define("sprd/entity/Configuration",["js/data/Entity","sprd/entity/Offset","sprd/entity/Size","sprd/entity/PrintArea","sprd/model/PrintType","js/core/List","sprd/entity/Price","sprd/type/Matrix2d","sprd/util/ProductUtil","sprd/entity/PrintTypeColor","underscore"],function(e,t,n,r,i,s,o,u,a,f,l){return e.inherit("sprd.entity.Configuration",{schema:{offset:t,printArea:{type:r,isReference:!0},printType:i,printColors:[f],content:Object,restrictions:Object,type:String},defaults:{printArea:null,printType:null,offset:t,scale:{x:1,y:1},rotation:0,printColors:s,_size:"{size()}",_x:"{offset.x}",_y:"{offset.y}",_printTypePrice:"{printType.price}"},_commitChangedAttributes:function(e,t){function s(e){l.extend(i,e),r._debounceFunctionCall(o,"validateTransform",n,r)}function o(){r._setError(r._validateTransform(i)),i={}}var n=t&&t.userInteraction?300:0,r=this,i={};this.callBase(),this._hasSome(e,["scale","rotation","printArea","printColors","printArea","printType"])?(s(e),this.trigger("configurationChanged")):e.hasOwnProperty("offset")&&e.offset&&!e.offset.isDeepEqual(this.$previousAttributes.offset)&&(s(e),this.trigger("configurationChanged"))},_validateTransform:function(e){var t=this._hasSome(e,["rotation"]),n=this._hasSome(e,["_size","_x","_y","scale","offset","bound"]),r=this._hasSome(e,["printType"]),i,s,o=e.printType||this.$.printType,u=e.scale||this.$.scale,a=e.rotation||this.$.rotation,f={},c=this.$.printArea;if(n||t)i=this.width(u.x),s=this.height(u.y),c&&(c.hasSoftBoundary()?f.hardBoundary=!1:f.hardBoundary=this._hasHardBoundaryError(e.offset||this.$.offset,i,s,a,u));if(n||r)i=i||this.width(),s=s||this.height(),l.extend(f,this._validatePrintTypeSize(o,i,s,u));return f},_validatePrintTypeSize:function(e,t,n,r){return e?{printTypeScaling:!e.isScalable()&&(r.x!=1||r.y!=1),maxBound:t>e.get("size.width")||n>e.get("size.height")}:{}},_hasHardBoundaryError:function(e,t,n,r,i){var s=this.$.printArea;if(!s||!e)return;var o=this._getBoundingBox(e,t,n,r,i,!0);return!(o.x>=0&&o.y>=0&&o.x+o.width<=s.get("boundary.size.width")&&o.y+o.height<=s.get("boundary.size.height"))},_getBoundingBox:function(e,t,n,r,i,s,o){e=e||this.$.offset,t=t||this.width(),n=n||this.height(),r=r||this.$.rotation;var a=e.$.x,f=e.$.y;if(!(r%360))return{x:a,y:f,height:n,width:t};var l,c,h,p,d=(new u).rotateDeg(r);o=o||0;var v=t/2,m=n/2,g=[[-v+o,-m],[v+o,-m],[v+o,m],[-v+o,m]],y=d.transformPoint(g[0]);l=c=y[0],h=p=y[1];for(var b=1;b<g.length;b++)y=d.transformPoint(g[b]),l=Math.min(y[0],l),c=Math.max(y[0],c),h=Math.min(y[1],h),p=Math.max(y[1],p);return{x:l+v+a-o,y:h+m+f,width:c-l,height:p-h}},size:function(){return this.log("size() not implemented","debug"),n.empty},height:function(e){return!e&&e!==0&&(e=this.$.scale.y),Math.abs(this.size().$.height*e)}.onChange("scale","size()").on("sizeChanged"),width:function(e){return!e&&e!==0&&(e=this.$.scale.x),Math.abs(this.size().$.width*e)}.onChange("scale","size()").on("sizeChanged"),isScalable:function(){return this.get("printType.isScalable()")}.onChange("printType"),isRotatable:function(){return!0},isRemovable:function(){return!0},price:function(){var e=this.get("printType.price");return e?e.clone():new o},getSizeForPrintType:function(e){return n.empty},possiblePrintTypes:function(e){var t=[],n=this.$.printArea;return n&&e&&(t=a.getPossiblePrintTypesForPrintAreas([n],e.$.id)),t}.onChange("printArea"),isAllowedOnPrintArea:function(e){return!1},getPossiblePrintTypesForPrintArea:function(){return[]},allowScale:function(){return!0},minimumScale:function(){return 0},isReadyForCompose:function(){return!0}})}),define("sprd/util/UnitUtil",["sprd/entity/Size"],function(e){return{pointToMillimeter:function(e){return e/72*25.4},millimeterToPoint:function(e){return e/25.4*72},pixelToMm:function(e,t){return e*25.4/t},ptToMm:function(e){return e/72*25.4},mmToPt:function(e){return e/25.4*72},convertSizeToMm:function(t,n){return t.$.unit==="px"?new e({unit:"mm",height:this.pixelToMm(t.$.height,n),width:this.pixelToMm(t.$.width,n)}):t}}}),define("sprd/entity/DesignColor",["js/data/Entity","js/type/Color"],function(e,t){return e.inherit("sprd.entity.DesignColor",{schema:{"default":String,origin:String,layer:String},parse:function(e){return e=this.callBase(),e["default"]=t.parse(e["default"]),e.origin=t.parse(e.origin),e}})}),define("sprd/model/Design",["sprd/data/SprdModel","sprd/model/PrintType","sprd/entity/Size","sprd/entity/DesignColor","sprd/entity/Price","js/data/Entity"],function(e,t,n,r,i,s){var o={No:"no",OnPrintArea:"onPrintArea",OnProduct:"onProduct"},u=s.inherit("sprd.model.Design.Restrictions",{defaults:{denyOtherDesigns:o.No,denyOtherText:o.No},schema:{fixedColors:Boolean,colorCount:Number,ownText:Boolean,minimumScale:Number,denyOtherText:String,denyOtherDesigns:String,allowScale:Boolean,allowFlip:Boolean,allowRotate:Boolean}}),a=e.inherit("sprd.model.Design",{defaults:{name:"",description:"",restrictions:null},schema:{name:String,description:String,size:n,printTypes:[t],tags:String,colors:[r],price:i,restrictions:u,user:"sprd/model/User"},parse:function(e){return e=this.callBase(),e.href&&(e.wtfMbsId=e.id,e.id=e.href.split("/").pop()),e},isVectorDesign:function(){return this.$.colors.length>0}});return a.Restrictions=u,a}),define("sprd/manager/IConfigurationManager",["js/core/Bindable"],function(e){return e.inherit("sprd.manager.IConfigurationManager",{initializeConfiguration:function(e,t){}})}),define("sprd/manager/IDesignConfigurationManager",["sprd/manager/IConfigurationManager"],function(e){return e.inherit("sprd.manager.IDesignConfigurationManager",{initializeConfiguration:function(e,t){}})}),define("sprd/entity/DesignConfiguration",["sprd/entity/Configuration","sprd/entity/Size","sprd/util/UnitUtil","sprd/model/Design","sprd/entity/PrintTypeColor","underscore","sprd/model/PrintType","sprd/util/ProductUtil","js/core/List","flow","sprd/manager/IDesignConfigurationManager"],function(e,t,n,r,i,s,o,u,a,f,l){var c;return e.inherit("sprd.model.DesignConfiguration",{schema:{design:r},defaults:{type:"design",_dpi:"{printType.dpi}",design:null,_designCommission:"{design.price}",_allowScale:"{design.restrictions.allowScale}"},ctor:function(){this.$sizeCache={},this.$$={},this.callBase()},inject:{manager:l},type:"design",_commitPrintType:function(e){if(!e)return;var t=[],n=this.$.printColors;n.each(function(n){t.push(e.getClosestPrintColor(n.color()))});if(e.$.id===o.Mapping.SpecialFlex)for(var r=1;r<t.length;r++)t[r]=t[0];n.reset(t),this.trigger("configurationChanged"),this.trigger("priceChanged")},getPrintColorsAsRGB:function(){var e=[];if(this.$.design.$.colors.size()===this.$.printColors.size())for(var t=0;t<this.$.design.$.colors.$items.length;t++){var n=this.$.design.$.colors.$items[t],r=this.$.printColors.$items[t];e[n.$.layer]=r.color().toRGB().toHexString()}return e},setColor:function(e,t){var n=this.$.printType;t instanceof i||(t=n.getClosestPrintColor(t));if(!n.containsPrintTypeColor(t))throw new Error("Color not contained in print type");var r=this.$.printColors.$items;if(r[e]===t)return;r.splice(e,1,t);if(n.$.id===o.Mapping.SpecialFlex)for(var s=0;s<r.length;s++)s!==e&&(r[s]=r[e]);this.$.printColors.reset(r),this.trigger("configurationChanged"),this.trigger("priceChanged")},size:function(){return this.getSizeForPrintType(this.$.printType)}.onChange("_dpi","design"),getSizeForPrintType:function(e){if(this.$.design&&this.$.design.$.size&&e&&e.$.dpi){var r=e.$.dpi;return this.$sizeCache[r]||(this.$sizeCache[r]=n.convertSizeToMm(this.$.design.$.size,r)),this.$sizeCache[r]}return t.empty},isScalable:function(){return this.get("printType.isScalable()")&&this.$._allowScale}.onChange("printType","_allowScale"),allowScale:function(){return this.$._allowScale},_validatePrintTypeSize:function(e,t,n,r){var i=this.callBase(),s=this.$.design;return!e||!r||!s?i:(i.minBound=!e.isShrinkable()&&Math.min(Math.abs(r.x),Math.abs(r.y))*100<this.get("design.restrictions.minimumScale"),i.maxBound=i.maxBound||e.isShrinkable()&&!s.isVectorDesign()&&Math.max(Math.abs(r.x),Math.abs(r.y))>1,i)},price:function(){var e=[],t=this.callBase();this.$.printColors.each(function(t){s.indexOf(e,t)===-1&&e.push(t)});for(var n=0;n<e.length;n++)e[n]&&t.add(e[n].get("price"));return t.add(this.get("_designCommission")),t}.on("priceChanged").onChange("_designCommission","_printTypePrice"),getPossiblePrintTypes:function(e){var t=[],n=this.$.printArea,r=this.$.design;return n&&e&&r&&(t=u.getPossiblePrintTypesForDesignOnPrintArea(r,n,e.$.id)),t}.onChange("printArea","design"),compose:function(){var e=this.callBase(),t=[],n=this.$.scale,r=this.$.rotation,i=this.width(),s=this.height();r&&t.push("rotate("+r+","+Math.round(i/2,3)+","+Math.round(s/2,3)+")"),n&&(n.x<0||n.y<0)&&t.push("scale("+(n.x<0?-1:1)+","+(n.y<0?-1:1)+")");var o=this.$.design.$.wtfMbsId;e.content={unit:"mm",dpi:"25.4",svg:{image:{transform:t.join(" "),width:Math.round(i,3),height:Math.round(s,3),designId:o}}},delete e.design;var u=[],a=[];return this.$.printColors.each(function(e){u.push(e.$.id),a.push(e.color().toRGB().toString())}),this.$.printType.isPrintColorColorSpace()?e.content.svg.image.printColorIds=u.join(" "):e.content.svg.image.printColorRGBs=a.join(" "),e.printColors=c,e.restrictions={changeable:!0},e},parse:function(e){return e=this.callBase(),e.designs&&(this.$$.design=e.designs[0]),e.designs=c,e.printArea&&(this.$$.printArea=e.printArea,e.printArea=null),e.content&&(this.$$.svg=e.content.svg),e},init:function(e){this.$.manager.initializeConfiguration(this,e)},isAllowedOnPrintArea:function(e){return e&&e.get("restrictions.designAllowed")==1},getPossiblePrintTypesForPrintArea:function(e,t){return u.getPossiblePrintTypesForDesignOnPrintArea(this.$.design,e,t)},minimumScale:function(){return(this.get("design.restrictions.minimumScale")||100)/100}})}),define("sprd/manager/ITextConfigurationManager",["sprd/manager/IConfigurationManager"],function(e){return e.inherit("sprd.manager.ITextConfigurationManager",{initializeConfiguration:function(e,t){}})}),define("sprd/entity/TextConfiguration",["sprd/entity/Configuration","flow","sprd/entity/Size","underscore","sprd/model/PrintType","sprd/util/ProductUtil","js/core/Bus","sprd/util/UnitUtil","sprd/util/ArrayUtil","sprd/manager/ITextConfigurationManager"],function(e,t,n,r,i,s,o,u,a,f){return e.inherit("sprd.entity.TextConfiguration",{defaults:{textArea:null,textFlow:null,composedTextFlow:null,selection:null,bound:null},inject:{composer:"composer",bus:o,ApplyStyleToElementOperation:"ApplyStyleToElementOperation",Style:"Style",manager:f},type:"text",init:function(e){var n=this,r=this.$.manager;t().seq(function(e){r.initializeConfiguration(n,e)}).seq(function(e){n.$stageRendered||n.$stage&&n.$stage.rendered?n._composeText(!1,e):e()}).exec(e)},_postConstruct:function(){this.bind("textFlow","operationComplete",this._onTextFlowChange,this),this._composeText()},_preDestroy:function(){this.unbind("textFlow","operationComplete",this._onTextFlowChange,this)},bus_StageRendered:function(){this.$stageRendered=!0,this._composeText()}.bus("Stage.Rendered"),_commitChangedAttributes:function(e){e.hasOwnProperty("bound")&&this._setError(this._validateTransform(e)),this.callBase()},_onTextFlowChange:function(){var e=this;this._composeText(!1,function(){e._debounceFunctionCall(function(){e.$.bus.trigger("Application.productChanged",null,e)},"productChanged",300)}),this.trigger("priceChanged"),this.trigger("configurationChanged")},_debouncedComposeText:function(){this._debounceFunctionCall(this._composeText,"composeText",300,this,[!0])},_composeText:function(e,t){if(!this.$stage||!this.$stage.rendered)return;var n=this.$.textFlow;if(!n)return;var r=this.$.textArea;if(!r)return;var i=this.$.composer,s=this;i.compose(n,r.$,function(n,r){r&&!e&&(s.$.textArea.set("height",r.composed.getHeight()),s.trigger("sizeChanged")),s.set({composedTextFlow:r,bound:r?r.measure:null}),t&&t(n)})},_validatePrintTypeSize:function(e,t,n,r){var i=this.$.bound,s=this.callBase(e,i?i.width*r.x:t,i?i.height*r.y:n,r);if(!e||!r)return s;var o=!1,u=this.$.textFlow;if(u&&!e.isShrinkable()){var a=u.getFirstLeaf();do{var f=a.get("style");if(f&&f.$.fontSize&&f.$.font){var l=(f.$.fontSize||0)*r.x;if(l<f.$.font.$.minimalSize){o=!0;break}}}while(a=a.getNextLeaf(u))}return s.minBound=o,s},_getBoundingBox:function(e,t,n,r,i,s){var o=this.$.bound;if(o&&s){e=e||this.$.offset,e=e.clone(),i=i||this.$.scale,t=o.width*i.x,n=o.height*i.y,e.set({x:e.$.x+o.x*i.x,y:e.$.y+o.y*i.y});var u=i.x,a=-(this.width(u)-o.width*u)/2+o.x*u;return this.callBase(e,t,n,r,i,s,a)}return this.callBase()},_commitPrintType:function(e){if(!e)return;var t=this.$.textFlow;if(t){var n=null,r=t.getFirstLeaf();do{var s=r.get("style");if(s&&s.$.printTypeColor){var o=s.$.printTypeColor;e.$.id===i.Mapping.SpecialFlex&&(n=e.getClosestPrintColor(o.color())),s.set("printTypeColor",n||e.getClosestPrintColor(o.color()))}}while(r=r.getNextLeaf(t));this._composeText()}this.trigger("priceChanged")},price:function(){var e=[],t=this.callBase(),n=this.$.textFlow;if(n){var i=n.getFirstLeaf();do{var s=i.get("style");if(s&&s.$.printTypeColor){var o=s.$.printTypeColor;r.indexOf(e,o)===-1&&e.push(o)}}while(i=i.getNextLeaf(n));for(var u=0;u<e.length;u++)e[u]&&t.add(e[u].get("price"))}return t}.on("priceChanged").onChange("_printTypePrice"),getUsedFonts:function(){function t(n){if(n){var i=n.get("style.font");i&&r.indexOf(e,i)===-1&&e.push(i),n.isLeaf||n.$.children.each(function(e){t(e)})}}var e=[];return this.$.textFlow&&t(this.$.textFlow),e},compose:function(){var e=this.callBase();e.type="text",e.restrictions={changeable:!0};var t=[],n=this.$.scale,i=this.$.rotation,s=this.width(),o=this.height();i&&t.push("rotate("+i+","+Math.round(s/2,3)+","+Math.round(o/2,3)+")"),n&&(n.x<0||n.y<0)&&t.push("scale("+(n.x<0?-1:1)+","+(n.y<0?-1:1)+")"),delete e.printColors;var u=this.$.composedTextFlow,a=this.$.scale.x,f=this.$.scale.y,l={width:this.$.textArea.$.width*a,height:this.$.textArea.$.height*f,content:[]};l.transform=t.join(" ");var c=0,h=!1;if(!u)throw new Error("No composed text flow");for(var p=0;p<u.composed.children.length;p++){var d=u.composed.children[p],v=d.item.composeStyle();for(var m=0;m<d.children.length;m++){var g=d.children[m];for(var y=0;y<g.children.length;y++){var b=g.children[y];c+=b.getTextHeight()*f;for(var w=0;w<b.children.length;w++){var E=b.children[w].item,S={content:[E.$.text]},x=E.$.style.serialize();x.fontSize=(x.fontSize||0)*f,h||(r.extend(l,x),h=!0);if(w===0){v&&r.extend(x,{textAnchor:v.textAnchor});var T=0;switch(x.textAnchor){case"middle":T=l.width/2;break;case"end":T=l.width}x.x=T,x.y=c}r.extend(S,x),l.content.push(S)}c+=(b.getHeight()-b.getTextHeight())*f}}}return e.content={dpi:"25.4",unit:"mm",svg:{text:l,viewBox:[0,0,l.width,l.height].join(" ")}},e},setColor:function(e,t){if(this.$.ApplyStyleToElementOperation&&this.$.Style){var n=this.$.selection;n.$.anchorIndex===n.$.activeIndex&&(n=n.clone(),n.set({anchorIndex:0,activeIndex:this.$.textFlow.textLength()-1})),(new this.$.ApplyStyleToElementOperation(n,this.$.textFlow,new this.$.Style({printTypeColor:t}))).doOperation()}},getPossiblePrintTypes:function(e){var t=[],n,i=this.$.printArea,o=this.$.textFlow,u=this.$.selection;if(i&&e&&o&&u){var a=o.findLeaf(u.$.absoluteStart),f=o.findLeaf(u.$.absoluteEnd);if(a)do a.$.style&&a.$.style.$.font&&(n=s.getPossiblePrintTypesForTextOnPrintArea(a.$.style.$.font.getFontFamily(),i,e.$.id),r.each(n,function(e){t.indexOf(e)===-1&&t.push(e)})),a=a.getNextLeaf();while(a!==null&&a!==f)}return t}.onChange("printArea","design"),getPossiblePrintTypesForPrintArea:function(e,t){var n=[],i=[],o=this.$.textFlow;if(o){var u=o.getFirstLeaf();do{var f=u.get("style");f&&f.$.font&&r.indexOf(n,f.$.font.getFontFamily())===-1&&n.push(f.$.font.getFontFamily())}while(u=u.getNextLeaf(o))}for(var l=0;l<n.length;l++)i.push(s.getPossiblePrintTypesForTextOnPrintArea(n[l],e,t));return a.average.apply(a,i)},parse:function(e){return e=this.callBase(),this.$$=this.$$||{},e.printArea&&(this.$$.printArea=e.printArea,e.printArea=null),e.content&&(this.$$.svg=e.content.svg),e},getSizeForPrintType:function(e){return this.size()},size:function(){return this.$.textArea||n.empty}.onChange("textArea").on("sizeChanged"),clone:function(e){e=e||{},e.exclude=e.exclude||[],e.exclude.push("bus","composer","textArea","composedTextFlow");var t=this.callBase(e);return t.$stage=this.$stage,t.$.composedTextFlow=null,t},sync:function(){return this.$stage=this._$source.$stage,this.callBase()},isAllowedOnPrintArea:function(e){return e&&e.get("restrictions.textAllowed")==1},isReadyForCompose:function(){return!!this.$.composedTextFlow},isDeepEqual:function(e){var t=["offset","rotation","printType","printColors","scale","printArea"],n,r,i,s;for(n=t.length;n--;){r=t[n],s=this.$[r],i=e.$[r];if(this.$.hasOwnProperty(r)){if(s===null&&i!==null)return!1;if(s!==null&&i===null)return!1;if(s.isDeepEqual&&s.isDeepEqual instanceof Function){if(!s.isDeepEqual(i))return!1}else if(s!==i)return!1}}return this.$.textFlow===null&&e.$.textFlow===null?!0:this.$.textFlow?this.$.textFlow.isDeepEqual(e.$.textFlow):!1}})}),define("sprd/manager/IProductManager",["js/core/Bindable"],function(e){return e.inherit("sprd.manager.IProductManager",{defaults:{removeConfigurationOutsideViewPort:!0,removeConfigurationOutsidePrintArea:!0},checkConfigurationOffset:function(e,t){},initializeProduct:function(e,t){}})}),define("js/core/Error",[],function(){return Error.inherit("js.core.Error",{ctor:function(e,t,n){Error.prototype.constructor.call(this,e,t),this.message=e,this.statusCode=t,this.baseError=n}})}),define("sprd/error/ProductCreationError",["js/core/Error"],function(e){var t,n=e.inherit("sprd.error.ProductCreationError",{},{createFromResponse:function(e){if(!e)return null;if(e.xhr&&e.xhr.responses){var r=e.xhr.responses.text;for(var i=0;i<t.length;i++){var s=t[i];if(s.test.test(r))return new n(s.type,n.ErrorCodes[s.type]||n.ErrorCodes.PRODUCT_CREATION,e)}}return new n("ProductCreationError",n.ErrorCodes.PRODUCT_CREATION)}});return n.ErrorCodes={PRODUCT_CREATION:-100,HARD_BOUNDARY:-101,CONFIGURATION_OVERLAP:-102,MAX_BOUND:-103,MIN_BOUND:-104,COPYRIGHT:-105},t=[{test:/smaller\sthan/,type:"MIN_BOUND"},{test:/HARD\sBOUNDARY/,type:"HARD_BOUNDARY"},{test:/is\sto\sbig\sfor\sprinttype/,type:"MAX_BOUND"},{test:/blacklisted\sterm/,type:"COPYRIGHT"}],n}),define("sprd/model/Product",["sprd/model/ProductBase","js/core/List","js/data/AttributeTypeResolver","sprd/entity/DesignConfiguration","sprd/entity/TextConfiguration","sprd/entity/Price","js/data/TypeResolver","js/data/Entity","underscore","flow","sprd/manager/IProductManager","sprd/error/ProductCreationError","sprd/model/ProductType"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p;return e.inherit("sprd.model.Product",{schema:{productType:h,configurations:[new n({attribute:"type",mapping:{design:r,text:i}})]},defaults:{configurations:t},inject:{manager:l},ctor:function(){this.configurationsOnViewCache={},this.callBase();var e=function(){this.trigger("priceChanged")},t=function(){this.trigger("productChanged")},n=function(n){var r=n.$.item,s=r.get("printArea.getDefaultView().id");s&&(this.configurationsOnViewCache[s]=null,this.trigger("configurationValidChanged")),this._setUpConfiguration(r),r instanceof i&&r._composeText(),e.call(this),t.call(this)},r=function(n){var r=n.$.item,i=r.get("printArea.getDefaultView().id");i&&(this.configurationsOnViewCache[i]=null,this.trigger("configurationValidChanged")),this._tearDownConfiguration(r),t.call(this),e.call(this)};this.bind("configurations","add",n,this),this.bind("configurations","remove",r,this),this.bind("configurations","reset",function(){this.configurationsOnViewCache={},this.trigger("configurationValidChanged"),e.call(this),t.call(this)},this),this.bind("configurations","item:priceChanged",e,this),this.bind("configurations","item:configurationChanged",t,this),this.bind("change:configurations",t,this),this.bind("configurations","item:change:printArea",function(){this.configurationsOnViewCache={},this.trigger("configurationValidChanged"),t.call(this)},this),this.bind("configurations","item:isValidChanged",function(){this.trigger("configurationValidChanged")},this),this.bind("configurations","item:change:offset",this._onConfigurationOffsetChanged,this)},getDefaultAppearance:function(){var e=this.$.productType;return e?e.getAppearanceById(this.get("appearance.id")):null}.onChange("appearance","productType"),_onConfigurationOffsetChanged:function(e){var t=this.$.manager,n=e.$.item;t&&t.checkConfigurationOffset&&t.checkConfigurationOffset(this,n)},configurationsOnViewErrorKey:function(e){var t=null,n;if(!e)return null;var r=e.$.id,i=this.$.productType;n=this.configurationsOnViewCache[r],!n&&i&&i.containsView(e)&&(this.configurationsOnViewCache[r]=n=this.getConfigurationsOnView(e));if(!n)return null;for(var s=0;s<n.length;s++){var o=n[s];if(!o.isValid()&&o.$errors)for(var u in o.$errors.$)if(o.$errors.$.hasOwnProperty(u)){t=o.$errors.$[u];if(t){t=u;break}}}return this.configurationsOnViewCache[r].errorKey=t,t}.on("configurationValidChanged"),_setUpConfiguration:function(e){if(!this.$stage)return;this.$stage.$bus.setUp(e)},_tearDownConfiguration:function(e){if(!this.$stage)return;this.$stage.$bus.tearDown(e)},_postConstruct:function(){var e=this.$.configurations,t=this;e&&e.each(function(e){t._setUpConfiguration(e)})},_preDestroy:function(){var e=this.$.configurations,t=this;e&&e.each(function(e){t._tearDownConfiguration(e)})},price:function(){var e=new s({vatIncluded:this.get("productType.price.vatIncluded"),currency:this.get("productType.price.currency")});return this.$.configurations.each(function(t){e.add(t.price())}),e}.on("priceChanged",["productType","change:price"]).onChange("productType"),_addConfiguration:function(e){this.$.configurations.add(e)},getConfigurationsOnView:function(e){e=e||this.$.view;var t=this.$.productType;if(e&&t){if(t.containsView(e))return this.getConfigurationsOnPrintAreas(e.getPrintAreas());throw new Error("View not on product type")}return[]},getConfigurationsOnPrintAreas:function(e){e=e||[],e instanceof Array||(e=[e]);var t=[];for(var n=0;n<this.$.configurations.$items.length;n++){var r=this.$.configurations.$items[n];a.contains(e,r.$.printArea)&&t.push(r)}return t},compose:function(){var e=this.callBase();e.restrictions={freeColorSelection:!1,example:!1};var t=this.get("view.id");return t&&(e.defaultValues={defaultView:{id:t}}),e},fetch:function(e,t){var n=this;this.callBase(e,function(e){e||(n.$originalProduct=n.clone()),t&&t(e,n)})},hasChanges:function(){return!(this.$.configurations.isDeepEqual(this.$originalProduct.$.configurations)&&this.$.appearance.isDeepEqual(this.$originalProduct.$.appearance)&&this.$.productType.isDeepEqual(this.$originalProduct.$.productType))},save:function(e,t){if(this.$originalProduct){if(!this.hasChanges()){this.set({id:this.$originalProduct.$.id,href:this.$originalProduct.$.href}),t&&t(null,this);return}this.set("id",p)}var n=this;this.callBase(e,function(e){e?e=c.createFromResponse(e):n.$originalProduct=n.clone(),t&&t(e,n)})},init:function(e){var t=this;f().seq(function(e){t.isNew()?e():t.fetch(null,e)}).seq(function(e){var n=t.$.productType;n.fetch(null,e)}).seq(function(){var e=t.$.productType,n;t.$.appearance&&(n=e.getAppearanceById(t.$.appearance.$.id)),n=n||e.getDefaultAppearance(),t.set({appearance:n,view:t.$.view||e.getViewById(t.get("defaultValues.defaultView.id"))||e.getDefaultView()})}).seq(function(e){f().parEach(t.$.configurations.$items,function(e,n){t._setUpConfiguration(e),e.init(n)}).exec(e)}).exec(function(n){n?e&&e(n):e&&e(null,t)})},appearanceBrightness:function(){var e=this.get("appearance.getMainColor()");return e?e.distanceTo("#000000")<e.distanceTo("#FFFFFF")?"dark":"bright":""}.onChange(["appearance"]),isReadyForCompose:function(){var e=!0;return this.$.configurations&&this.$.configurations.each(function(t){e=e&&t.isReadyForCompose()}),e},_commitChangedAttributes:function(e){this.callBase(),(e.hasOwnProperty("appearance")||e.hasOwnProperty("productType"))&&this.trigger("productChanged")}})}),define("sprd/model/Article",["sprd/data/SprdModel","sprd/model/Product","sprd/entity/Price"],function(e,t,n){var r=/^http.*products\/(\d+).*$/;return e.inherit("sprd.model.Article",{schema:{product:t,price:n},price:function(){return this.$.price},product:function(e){var n=function(t,n){e&&e(t,n)},i;if(this.$.product){n(null,this.$.product);return}if(this.$.resources)for(var s=0;s<this.$.resources.length;s++){var o=this.$.resources[s],u=r.exec(o.href);if(u){i=u[1];break}}i?n(null,this.$context.createEntity(t,i)):this.fetch(null,function(e,t){n(e,t?t.$.product:null)})}})}),define("sprd/entity/ConcreteElement",["js/data/Entity","sprd/model/Product","sprd/model/Article","sprd/entity/Appearance"],function(e,t,n,r){var i="sprd:product",s="sprd:article";return e.inherit("sprd.entity.ConcreteElement",{schema:{appearance:r,size:e},defaults:{appearance:null,size:null,item:null,continueShoppingLink:null,editLink:null},isEqual:function(e){return this.get("appearance.id")===e.get("appearance.id")&&this.get("size.id")===e.get("size.id")&&this.get("item.id")===e.get("item.id")},getProduct:function(){return this.$.item instanceof t?this.$.item:this.$.item instanceof n?this.$.item.$.product:null}.on(["item","change:product"]).onChange("item"),getArticle:function(){return this.$.item instanceof n?this.$.item:null},getSize:function(){return this.$.size?this.getProduct().$.productType.getSizeById(this.$.size.$.id):null},getAppearance:function(){return this.$.appearance?this.getProduct().$.productType.getAppearanceById(this.$.appearance.$.id):null},getType:function(){return this.$.item instanceof t?i:this.$.item instanceof n?s:null},uniqueId:function(){return(this.getType()===i?"P":"A")+this.get("item.id")},sku:function(){return[this.get("getProduct().productType.id"),this.get("appearance.id"),this.get("size.id")].join(" - ")}})}),define("sprd/model/BasketItem",["sprd/data/SprdModel","sprd/entity/ConcreteElement","sprd/entity/Price"],function(e,t,n){return e.inherit("sprd.model.BasketItem",{schema:{element:t,quantity:Number,price:n,priceItem:n,origin:String},defaults:{quantity:1,element:null,price:null},increaseQuantity:function(e){e=e||1,this.set("quantity",this.$.quantity+e)},decreaseQuantity:function(e){e=e||1,this.set("quantity",this.$.quantity-e)},_updatePrices:function(){this.totalVatIncluded.trigger(),this.totalVatExcluded.trigger()},vatIncluded:function(){return this.$.priceItem?this.$.priceItem.$.vatIncluded:this.get("element.item.price().vatIncluded")||0},vatExcluded:function(){return this.$.priceItem?this.$.priceItem.$.vatExcluded:this.get("element.item.price().vatExcluded")||0},discountPriceVatIncluded:function(){return this.$.price?this.$.price.$.vatIncluded:0}.onChange("price"),totalVatIncluded:function(){return this.vatIncluded()*this.$.quantity}.on("change:quantity"),totalVatExcluded:function(){return this.vatExcluded()*this.$.quantity}.on("change:quantity"),totalDiscountVatIncluded:function(){return this.discountPriceVatIncluded()*this.$.quantity}.onChange("price","quantity")})}),define("sprd/model/DiscountScale",["sprd/data/SprdModel","js/data/Entity"],function(e,t){var n=t.inherit("sprd.entity.Discount",{});return e.inherit("sprd.model.DiscountScale",{schema:{discounts:[t]},maxDiscount:function(){return this.$.discounts&&this.$.discounts.size()?this.$.discounts.at(this.$.discounts.size()-1):""}.onChange("discounts"),getDiscountById:function(e){var t=null;return e&&this.$.discounts&&this.$.discounts.each(function(n){n.$.id===e&&(t=n,this["break"]())}),t}.onChange("discounts")})}),define("sprd/model/Basket",["sprd/data/SprdModel","sprd/model/BasketItem","js/data/Collection","sprd/model/Currency","js/data/Entity","sprd/entity/Price","sprd/model/DiscountScale"],function(e,t,n,r,i,s,o){var u=i.inherit("sprd.entity.BasketDiscount",{schema:{discountScale:o}});return e.inherit("sprd.model.Basket",{schema:{basketItems:n.of(t),priceItems:s,shop:"sprd/model/Shop",currency:r,discounts:[u]},ctor:function(){this.callBase(),this.bind("basketItems","change",this._triggerFunctions,this),this.bind("basketItems","add",this._triggerFunctions,this),this.bind("basketItems","remove",this._triggerFunctions,this)},addElement:function(e,t){t=t||1;var n=this.getBasketItemForElement(e);return n?n.increaseQuantity(t):(n=this.$.basketItems.createItem(),n.set({element:e,quantity:t}),this.$.basketItems.add(n)),n},mergeBasketItem:function(e){var t,n;this.$.basketItems.each(function(t){!n&&t.$.element!==e.$.element&&t.$.element.isEqual(e.$.element)&&(n=t,this["break"]())}),n&&(this.$.basketItems.each(function(n){!t&&n.$.element===e.$.element&&(t=n)}),n.increaseQuantity(t.$.quantity),this.$.basketItems.remove(t))},getBasketItemForElement:function(e){var t=this.getCollection("basketItems");for(var n=0;n<t.$items.length;n++){var r=t.$items[n];if(r.$.element.isEqual(e))return r}return null},_triggerFunctions:function(){this.trigger("change",{})},totalItemsCount:function(){var e=0;return this.$.basketItems&&this.$.basketItems.each(function(t){e+=t.$.quantity}),e}.on("change"),vatIncluded:function(){var e=0;return this.$.basketItems&&this.$.basketItems.each(function(t){e+=t.totalVatIncluded()}),e}.on("change"),vatExcluded:function(){var e=0;return this.$.basketItems&&this.$.basketItems.each(function(t){e+=t.totalVatExcluded()}),e}.on("change"),discountVatIncluded:function(){return this.$.discounts&&this.$.discounts.size()?this.$.discounts.at(0).get("price.vatIncluded"):0}.onChange("discounts"),totalVatIncluded:function(){return this.$.priceItems?this.$.priceItems.$.vatIncluded-this.discountVatIncluded():null}.onChange("priceItems","discounts"),platformCheckoutLink:function(){return this.$.links?this.$.links[2].href:null}.onChange("links"),shopCheckoutLink:function(){return this.$.links?this.$.links[1].href:null}.onChange("links")})}),define("sprd/entity/DepartmentCategory",["js/data/Entity","sprd/model/ProductType"],function(e,t){var n;return n=e.inherit("sprd.entity.DepartmentCategory",{}),n.prototype.schema={productTypes:[t]},n}),define("sprd/model/ProductTypeDepartment",["sprd/data/SprdModel","sprd/entity/DepartmentCategory","underscore"],function(e,t,n){return e.inherit("sprd.model.ProductTypeDepartment",{schema:{categories:[t]},getProductTypeCategoryById:function(e){return this.$.categories?this.$.categories.each(function(t){t.$.id==e&&this["return"](t)}):null},isRealDepartment:function(){var e="EU",t=e==="EU"?["10","8"]:["7","6"];return n.indexOf(t,this.$.id)===-1}.onChange("id")})}),define("sprd/entity/ArticleCategoryEntity",["js/data/Entity"],function(e){var t;return t=e.inherit("sprd.entity.ArticleCategoryEntity",{getIdsOfSubcategories:function(){var e=[];return this.$.articleCategories&&this.$.articleCategories.each(function(t){t.$.id.indexOf("b")===-1&&e.push(t.$.id)}),e}}),t.prototype.schema={articleCategories:[t]},t}),define("sprd/model/ArticleCategory",["sprd/data/SprdModel","sprd/entity/ArticleCategoryEntity"],function(e,t){return e.inherit("sprd.model.ArticleCategory",{schema:{articleCategories:[t]},getSubCategories:function(){return this.articleCategories},getSubCategoryById:function(e){return this.$.articleCategories.each(function(t){t.$.id==e&&this["return"](t)})}})}),define("sprd/model/DesignCategory",["sprd/data/SprdModel","sprd/model/Design","js/data/Collection"],function(e,t,n){var r=e.inherit("sprd.model.DesignCategory",{schema:{designs:n.of(t)},isMarketPlace:function(){return this.$.id==="b1000000"},getSubCategories:function(){return this.$.designCategories},getSubCategoryById:function(e){return this.$.designCategories.each(function(t){t.$.id==e&&this["return"](t)})},hasSubCategories:function(){return this.$.designCategories&&this.$.designCategories.size()},parse:function(e){return e.id.indexOf("b")===-1&&(e.id="b"+e.id),e}});return r.prototype.schema.designCategories=[r],r}),define("sprd/model/Country",["sprd/data/SprdModel"],function(e){return e.inherit("sprd.model.Country",{})}),define("sprd/entity/Font",["js/data/Entity"],function(e){return e.inherit("sprd.entity.Font",{schema:{name:String,weight:String,style:String,minimalSize:Number},getFontFamily:function(){return this.$parent},getUniqueFontName:function(){return"sprdfont_"+this.$.id},isBold:function(){return this.$.weight==="bold"}.onChange("weight"),isItalic:function(){return this.$.style==="italic"}.onChange("style")})}),define("sprd/model/FontFamily",["sprd/data/SprdModel","sprd/model/PrintType","sprd/entity/Font"],function(e,t,n){return e.inherit("sprd.model.FontFamily",{schema:{printTypes:[t],fonts:[n],deprecated:Boolean},getFont:function(e,t){e===!0?e="bold":e===!1&&(e="normal"),t===!0?t="italic":t===!1&&(t="normal"),e=e||"normal",t=t||"normal";for(var n=0;n<this.$.fonts.$items.length;n++){var r=this.$.fonts.$items[n];if(r.$.weight===e&&r.$.style===t)return r}return null},getNearestFont:function(e,t){var n=this.getFont(e,t);return!n&&t&&(n=this.getFont(e,!1)),!n&&e&&(n=this.getFont(!1,t)),n||this.getDefaultFont()},getDefaultFont:function(){return this.$.fonts?this.$.fonts.at(0):null},getFontById:function(e){var t=this.$.fonts.$items;for(var n=0;n<t.length;n++)if(t[n].$.id==e)return t[n];return null},_supports:function(e){if(!this.$.fonts)return!1;var t=this.$.fonts.$items;for(var n=0;n<t.length;n++)if(t[n][e]&&t[n][e]())return!0;return!1},supportsBold:function(){return this._supports("isBold")}.onChange("fonts"),supportsItalic:function(){return this._supports("isItalic")}.onChange("fonts")})}),define("sprd/model/Application",["sprd/data/SprdModel","js/data/Entity","js/core/List"],function(e,t,n){var r=t.inherit("sprd.model.Application.Property",{defaults:{key:null,value:null},schema:{key:String,value:Object},parse:function(e){var t=this.callBase();return t.value==="true"?t.value=!0:t.value==="false"&&(t.value=!1),t}}),i=e.inherit("sprd.model.Application",{defaults:{name:"",properties:n},schema:{name:String,properties:[r]},getProperty:function(e){for(var t=0;t<this.$.properties.length;t++){var n=this.$.properties[t];if(n.$.key===e)return n}return null}});return i.Property=r,i}),define("sprd/model/AbstractShop",["sprd/data/SprdModel","js/data/Collection","sprd/model/Basket","sprd/model/Currency","sprd/model/Design","sprd/model/ProductType","sprd/model/ProductTypeDepartment","sprd/model/ArticleCategory","sprd/model/DesignCategory","sprd/model/Article","sprd/model/Country","sprd/model/PrintType","sprd/model/FontFamily","sprd/model/Product","sprd/model/DiscountScale","sprd/model/Application"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return e.inherit("sprd.model.AbstractShop",{schema:{country:l,currency:r,productTypes:t.of(s),printTypes:t.of(c),fontFamilies:t.of(h),productTypeDepartments:t.of(o),designCategories:t.of(a),designs:t.of(i),articleCategories:t.of(u),articles:t.of(f),discountSupported:Boolean,discountScale:d,products:t.of(p),currencies:t.of(r),countries:t.of(l),baskets:t.of(n),applications:t.of(v)}})}),define("sprd/model/Shop",["sprd/model/AbstractShop"],function(e){return e.inherit("sprd.model.Shop",{defaults:{platform:null},isMarketPlace:function(){var e=this.$.platform,t=this.$.id;return e==="EU"&&t==205909||e==="NA"&&t==93439}.onChange("platform","id")})}),define("raw",[],function(){var e,t,n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=function(e,t){throw new Error("Environment unsupported.")},i={};return typeof window!="undefined"&&window.navigator&&window.document||typeof importScripts!="undefined"?(t=function(){var e,t,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(t=0;t<3;t++){r=n[t];try{e=new ActiveXObject(r)}catch(i){}if(e){n=[r];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},r=function(e,n){var r;try{r=t(),r.open("GET",e,!0),r.onreadystatechange=function(){r.readyState===4&&(r.responseText?n(null,r.responseText):n("no responseXML found"))},r.send(null)}catch(i){n(i)}}):typeof process!="undefined"&&process.versions&&!!process.versions.node&&(e=require.nodeRequire("fs"),r=function(t,n){try{var r=e.readFileSync(t,"utf8");n(null,r)}catch(i){console.error.call(console,i),n(i)}}),{write:function(e,t,n){if(t in i){var r=i[t].replace(/((\r\n|\n|\r)[\s\t]*)/gm," ").replace(/'/g,"\\'");n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},version:"0.1.0",load:function(e,t,n,s){var o=t.toUrl(e);r(o,function(t,r){if(!t)if(s.isBuild){var u=r.replace(/\r\n/g,"\n");u=u.replace(/\r/g,"\n"),u=u.replace(/\n/g,"\\n"),i[e]=u,n(null)}else n(r);else n.error(new Error("Raw for "+o+" not found"))})}}}),define("raw!example/window/CustomDialog.xml",[],function(){return'<ui:Dialog xmlns="http://www.w3.org/1999/xhtml"\n           xmlns:js="js.core"\n           xmlns:ui="js.ui"\n           title="My Dialog">\n    <js:Content name="body">\n        <input type="text" cid="nameInput" value="Guest"/>\n        <p>\n            Hello {nameInput.value}!\n        </p>\n    </js:Content>\n    <js:Content name="footer">\n        <ui:Button onclick="closeDialog" label="close"/>\n        <ui:Button onclick="confirmDialog" label="Save" type="primary"/>\n    </js:Content>\n</ui:Dialog>'}),define("app/module/UiClass",["js/core/Module","sprd/model/Shop","js/data/Query","raw!example/window/CustomDialog.xml"],function(e,t,n,r){return e.inherit("app.module.UiClass",{defaults:{shop:null,customDialogExample:""},start:function(){if(!this.$.shop){var e=this.$.api.createEntity(t,205909);e.fetch(),this.set("shop",e)}this.set("customDialogExample",r),this.callBase()},_itemClickHandler:function(e){var t=e.target.find("$dataItem");this.visitArticle(t.$.data)},_keyHandler:function(e){e.domEvent.keyCode===13&&e.target.$.selectedItems.size()&&this.visitArticle(e.target.$.selectedItems.at(0))},_openDialog:function(e){this.$.myDialog.showModal(function(){})},queryCreator:function(){return function(e){return n.query().eql("s",e)}},visitArticle:function(e){window.open("http://www.spreadshirt.net/-C4408A"+e.$.id)}})}),define("sprd/data/ImageService",["js/core/Component","underscore"],function(e,t){var n=[120,178],r=e.inherit("sprd.data.ImageService",{defaults:{subDomainCount:10,endPoint:"//image.spreadshirt.net/image-server/v1",gateway:"/image-server/v1"},productTypeImage:function(e,t,n,i){return this.buildUrl(["productTypes",e,"views",t,"appearances",n],r.getImageSizeParameter(i),e)},productTypeSizeImage:function(e,t){return this.buildUrl(["productTypes",e,"variants","size"],r.getImageSizeParameter(t),e)},designImage:function(e,t){var n=r.getImageSizeParameter(t)||{},i=t.printColors;if(i)for(var s=0;s<i.length;s++)n["colors["+s+"]"]=i[s];return this.buildUrl(["designs",e],n,(e||"").replace(/^.*?(\d+).*/,"$1"))},appearanceImage:function(e,t){return this.buildUrl(["appearances",e],r.getImageSizeParameter(t),e)},printColorImage:function(e,t){return this.buildUrl(["printColors",e],r.getImageSizeParameter(t),e)},emptyImage:function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},fontUrl:function(e,t){return t=t||"woff"||"svg#font",this.buildUrl(["fontFamilies",e.getFontFamily().$.id,"fonts",e.$.id+"."+t])},buildUrl:function(e,t,n){var i,s=this.$.subDomainCount;return isNaN(parseInt(n))?i=this.$.gateway:(i=this.$.endPoint,i=i.replace(/(\/\/image)\./,"$1"+n%s+".")),e=e||[],e.unshift(i),r.buildUrl(e,t)}});return r.exceptionalSizes=[120,178],r.normalizeImageSize=function(e){return t.indexOf(n,e)===-1&&(e=Math.ceil(e/50)*50),Math.max(50,Math.min(1200,e))},r.getImageSizeParameter=function(e){var t={};return e.width&&(t.width=r.normalizeImageSize(e.width)),e.height&&(t.height=r.normalizeImageSize(e.height)),t},r.buildUrl=function(e,t){var n=r.buildQueryString(t);return e.join("/")+(n?"?"+n:"")},r.buildQueryString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+encodeURIComponent(e[n]));if(t.length)return t.join("&")},r}),define("moment",function(){return function(e){function t(e,t,n,r){var i=n.lang();return i[e].call?i[e](n,r):i[e][t]}function n(e,t){return function(n){return u(e.call(this,n),t)}}function r(e){return function(t){var n=e.call(this,t);return n+this.lang().ordinal(n)}}function i(e,t,n){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=n||!1}function s(e){var t=this._data={},n=e.years||e.y||0,r=e.months||e.M||0,i=e.weeks||e.w||0,s=e.days||e.d||0,u=e.hours||e.h||0,a=e.minutes||e.m||0,f=e.seconds||e.s||0,l=e.milliseconds||e.ms||0;this._milliseconds=l+f*1e3+a*6e4+u*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=l%1e3,f+=o(l/1e3),t.seconds=f%60,a+=o(f/60),t.minutes=a%60,u+=o(a/60),t.hours=u%24,s+=o(u/24),s+=i*7,t.days=s%30,r+=o(s/30),t.months=r%12,n+=o(r/12),t.years=n,this._lang=!1}function o(e){return e<0?Math.ceil(e):Math.floor(e)}function u(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function a(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function f(e){return Object.prototype.toString.call(e)==="[object Array]"}function l(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function c(e,t,n,r){var i,s,o=[];for(i=0;i<7;i++)o[i]=e[i]=e[i]==null?i===2?1:0:e[i];return e[7]=o[7]=t,e[8]!=null&&(o[8]=e[8]),e[3]+=n||0,e[4]+=r||0,s=new Date(0),t?(s.setUTCFullYear(e[0],e[1],e[2]),s.setUTCHours(e[3],e[4],e[5],e[6])):(s.setFullYear(e[0],e[1],e[2]),s.setHours(e[3],e[4],e[5],e[6])),s._a=o,s}function h(e,t){var n,r,i=[];!t&&D&&(t=require("./lang/"+e));for(n=0;n<P.length;n++)t[P[n]]=t[P[n]]||M.en[P[n]];for(n=0;n<12;n++)r=k([2e3,n]),i[n]=new RegExp("^"+(t.months[n]||t.months(r,""))+"|^"+(t.monthsShort[n]||t.monthsShort(r,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||i,M[e]=t,t}function p(e){var t=typeof e=="string"&&e||e&&e._lang||null;return t?M[t]||h(t):k}function d(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function v(e){var t=e.match(B),n,r;for(n=0,r=t.length;n<r;n++)tt[t[n]]?t[n]=tt[t[n]]:t[n]=d(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function m(e,t){function n(t){return e.lang().longDateFormat[t]||t}var r=5;while(r--&&j.test(t))t=t.replace(j,n);return Y[t]||(Y[t]=v(t)),Y[t](e)}function g(e){switch(e){case"DDDD":return R;case"YYYY":return U;case"S":case"SS":case"SSS":case"DDD":return q;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return z;case"Z":case"ZZ":return W;case"T":return X;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return I;default:return new RegExp(e.replace("\\",""))}}function y(e,t,n,r){var i,s;switch(e){case"M":case"MM":n[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++)if(p().monthsParse[i].test(t)){n[1]=i,s=!0;break}s||(n[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(n[2]=~~t);break;case"YY":n[0]=~~t+(~~t>70?1900:2e3);break;case"YYYY":n[0]=~~Math.abs(t);break;case"a":case"A":r.isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":n[3]=~~t;break;case"m":case"mm":n[4]=~~t;break;case"s":case"ss":n[5]=~~t;break;case"S":case"SS":case"SSS":n[6]=~~(("0."+t)*1e3);break;case"Z":case"ZZ":r.isUTC=!0,i=(t+"").match(K),i&&i[1]&&(r.tzh=~~i[1]),i&&i[2]&&(r.tzm=~~i[2]),i&&i[0]==="+"&&(r.tzh=-r.tzh,r.tzm=-r.tzm)}t==null&&(n[8]=!1)}function b(e,t){var n=[0,0,1,0,0,0,0],r={tzh:0,tzm:0},i=t.match(B),s,o;for(s=0;s<i.length;s++)o=(g(i[s]).exec(e)||[])[0],o&&(e=e.slice(e.indexOf(o)+o.length)),tt[i[s]]&&y(i[s],o,n,r);return r.isPm&&n[3]<12&&(n[3]+=12),r.isPm===!1&&n[3]===12&&(n[3]=0),c(n,r.isUTC,r.tzh,r.tzm)}function w(e,t){var n,r=e.match(F)||[],s,o=99,u,a,f;for(u=0;u<t.length;u++)a=b(e,t[u]),s=m(new i(a),t[u]).match(F)||[],f=l(r,s),f<o&&(o=f,n=a);return n}function E(e){var t="YYYY-MM-DDT",n;if(V.exec(e)){for(n=0;n<4;n++)if(J[n][1].exec(e)){t+=J[n][0];break}return W.exec(e)?b(e,t+" Z"):b(e,t)}return new Date(e)}function S(e,t,n,r,i){var s=i.relativeTime[e];return typeof s=="function"?s(t||1,!!n,e,r):s.replace(/%d/i,t||1)}function x(e,t,n){var r=A(Math.abs(e)/1e3),i=A(r/60),s=A(i/60),o=A(s/24),u=A(o/365),a=r<45&&["s",r]||i===1&&["m"]||i<45&&["mm",i]||s===1&&["h"]||s<22&&["hh",s]||o===1&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",A(o/30)]||u===1&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,S.apply({},a)}function T(e,t){k.fn[e]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}function N(e){k.duration.fn[e]=function(){return this._data[e]}}function C(e,t){k.duration.fn["as"+e]=function(){return+this/t}}var k,L="1.7.2",A=Math.round,O,M={},_="en",D=typeof module!="undefined"&&module.exports,P="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),H=/^\/?Date\((\-?\d+)/i,B=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,j=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,F=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,I=/\d\d?/,q=/\d{1,3}/,R=/\d{3}/,U=/\d{1,4}/,z=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,W=/Z|[\+\-]\d\d:?\d\d/i,X=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,$="YYYY-MM-DDTHH:mm:ssZ",J=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],K=/([\+\-]|\d\d)/gi,Q="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),G={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Y={},Z="DDD w M D d".split(" "),et="M D H h m s w".split(" "),tt={M:function(){return this.month()+1},MMM:function(e){return t("monthsShort",this.month(),this,e)},MMMM:function(e){return t("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var e=new Date(this.year(),this.month(),this.date()),t=new Date(this.year(),0,1);return~~((e-t)/864e5+1.5)},d:function(){return this.day()},dd:function(e){return t("weekdaysMin",this.day(),this,e)},ddd:function(e){return t("weekdaysShort",this.day(),this,e)},dddd:function(e){return t("weekdays",this.day(),this,e)},w:function(){var e=new Date(this.year(),this.month(),this.date()-this.day()+5),t=new Date(e.getFullYear(),0,4);return~~((e-t)/864e5/7+1.5)},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return u(~~(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(e/60),2)+":"+u(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(10*e/6),4)}};while(Z.length)O=Z.pop(),tt[O+"o"]=r(tt[O]);while(et.length)O=et.pop(),tt[O+O]=n(tt[O],2);tt.DDDD=n(tt.DDD,3),k=function(t,n){if(t===null||t==="")return null;var r,s;return k.isMoment(t)?new i(new Date(+t._d),t._isUTC,t._lang):(n?f(n)?r=w(t,n):r=b(t,n):(s=H.exec(t),r=t===e?new Date:s?new Date(+s[1]):t instanceof Date?t:f(t)?c(t):typeof t=="string"?E(t):new Date(t)),new i(r))},k.utc=function(e,t){return f(e)?new i(c(e,!0),!0):(typeof e=="string"&&!W.exec(e)&&(e+=" +0000",t&&(t+=" Z")),k(e,t).utc())},k.unix=function(e){return k(e*1e3)},k.duration=function(e,t){var n=k.isDuration(e),r=typeof e=="number",i=n?e._data:r?{}:e,o;return r&&(t?i[t]=e:i.milliseconds=e),o=new s(i),n&&(o._lang=e._lang),o},k.humanizeDuration=function(e,t,n){return k.duration(e,t===!0?null:t).humanize(t===!0?!0:n)},k.version=L,k.defaultFormat=$,k.lang=function(e,t){var n;if(!e)return _;(t||!M[e])&&h(e,t);if(M[e]){for(n=0;n<P.length;n++)k[P[n]]=M[e][P[n]];k.monthsParse=M[e].monthsParse,_=e}},k.langData=p,k.isMoment=function(e){return e instanceof i},k.isDuration=function(e){return e instanceof s},k.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"}}),k.fn=i.prototype={clone:function(){return k(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!l(this._a,(this._a[7]?k.utc(this._a):k(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return m(this,e?e:k.defaultFormat)},add:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,1),this},subtract:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,-1),this},diff:function(e,t,n){var r=this._isUTC?k(e).utc():k(e).local(),i=(this.zone()-r.zone())*6e4,s=this._d-r._d-i,o=this.year()-r.year(),u=this.month()-r.month(),a=this.date()-r.date(),f;return t==="months"?f=o*12+u+a/30:t==="years"?f=o+(u+a/30)/12:f=t==="seconds"?s/1e3:t==="minutes"?s/6e4:t==="hours"?s/36e5:t==="days"?s/864e5:t==="weeks"?s/6048e5:s,n?f:A(f)},from:function(e,t){return k.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(k(),e)},calendar:function(){var e=this.diff(k().sod(),"days",!0),t=this.lang().calendar,n=t.sameElse,r=e<-6?n:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:n;return this.format(typeof r=="function"?r.apply(this):r)},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<k([this.year()]).zone()||this.zone()<k([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return k.utc([this.year(),this.month()+1,0]).date()},lang:function(t){return t===e?p(this):(this._lang=t,this)}};for(O=0;O<Q.length;O++)T(Q[O].toLowerCase(),Q[O]);T("year","FullYear"),k.duration.fn=s.prototype={weeks:function(){return o(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=this.lang().relativeTime,r=x(t,!e,this.lang()),i=t<=0?n.past:n.future;return e&&(typeof i=="function"?r=i(r):r=i.replace(/%s/i,r)),r},lang:k.fn.lang};for(O in G)G.hasOwnProperty(O)&&(C(O,G[O]),N(O.toLowerCase()));C("Weeks",6048e5),D&&(module.exports=k),typeof ender=="undefined"&&(this.moment=k),typeof define=="function"&&define.amd&&define("moment",[],function(){return k})}.call(this),moment}),define("js/conf/ResourceConfiguration",["js/conf/Configuration","js/data/Model"],function(e,t){return e.inherit("js.conf.ResourceConfiguration",{defaults:{resourceHandler:null,modelClassName:null,path:null,collectionClassName:null,processor:null},_initializationComplete:function(){this._validateConfiguration(),this.callBase()},_validateConfiguration:function(){if(!this.$.modelClassName)throw"no modelClassName defined for '"+this.$.path+"'."},getConfigurationForModelClassName:function(e){return this.getConfigurationByKeyValue("modelClassName",e)},getConfigurationForModelClass:function(e){var n;while(!n&&e&&e.classof&&e.classof(t))n=this.getConfigurationForModelClassName(e.prototype.constructor.name),e=e.prototype.base;return n},getConfigurationForPath:function(e){return this.getConfigurationByKeyValue("path",e,!1)}})}),define("js/conf/DataSourceConfiguration",["js/conf/ResourceConfiguration"],function(e){return e.inherit("js.conf.DataSourceConfiguration",{_validateConfiguration:function(){}})}),define("js/data/DataSource",["js/core/Component","js/core/Base","js/data/Collection","underscore","js/data/Model","js/data/Entity","js/core/List","flow","JSON","moment","js/conf/DataSourceConfiguration","js/conf/ResourceConfiguration","js/data/TypeResolver"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d=t.inherit("js.data.DataSource.Context",{defaults:{collectionPageSize:null},ctor:function(e,t,n,r){this.callBase(),this.$contextModel=t,this.$contextCache={},this.$dataSource=e,this.$properties=n,this.$parent=r,this.$cache={}},addEntityToCache:function(e){this.$cache[d.generateCacheIdFromEntity(e)]=e},addCollectionToCache:function(e){this.$cache[d.generateCacheIdFromCollection(e)]=e},getInstanceByCacheId:function(e){return this.$cache[e]},getPathComponents:function(){return[]},createEntity:function(e,t){if(r.isFunction(e)){var n=e.prototype.constructor.name;if(!n)throw new Error("No model class name defined");var i;t&&(i=this.getInstanceByCacheId(d.generateCacheIdForEntity(n,t)));if(!i){var s={};s[e.prototype.idField]=t,i=new e(s),this.addEntity(i,!0)}return i}throw"Factory has to be a function"},addEntity:function(e,t){e.$context=this,t&&this.addEntityToCache(e)},createCollection:function(e,t){t=t||{};if(r.isFunction(e)){if(e===this.$dataSource.$collectionFactory)throw new Error("Untyped collections not allowed");var n=e.prototype.constructor.name;if(!n)throw new Error("No collection class name defined");r.defaults(t,{factory:e});var i=this.getInstanceByCacheId(d.generateCacheIdForCollection(n));return i||(i=new e(null,t),i.$context=this,this.addCollectionToCache(i)),i}throw"Factory has to be a function"},getContext:function(e,t){var n=this.createContextCacheId(e,t);return n?(this.$contextCache.hasOwnProperty(n)||(this.$contextCache[n]=this.$dataSource.createContext(e,t,this)),this.$contextCache[n]):this},createContextCacheId:function(e,t){var n=[];return r.each(r.extend({},t),function(e,t){n.push(t+"="+e)}),n.sort(),e&&n.unshift(d.generateCacheIdFromEntity(e)),n.length===0?null:n.join("&")},clear:function(){this.$contextCache={}}},{generateCacheIdForCollection:function(e){return e},generateCacheIdForEntity:function(e,t){return e+"_"+t},generateCacheIdFromEntity:function(e){return d.generateCacheIdForEntity(e.constructor.name,e.$[e.idField])},generateCacheIdFromCollection:function(e){return d.generateCacheIdForCollection(e.factory.prototype.constructor.name)}}),v=t.inherit("js.data.DataSource.Processor",{ctor:function(e){if(!e)throw"dataSource is required for Processor";this.$dataSource=e},compose:function(e,t,n){return this._composeEntity(e,t,n)},composeCollection:function(e,t,n){var r=[],i=this,s={};return n=n||{},e.each(function(e){var o,u=e.constructor.name;if(u)if(s.hasOwnProperty(u))o=s[u];else{o=["id"];for(var a in e.schema)e.schema.hasOwnProperty(a)&&e.schema[a].includeInIndex===!0&&o.push(a);s[u]=o}n.includeInIndex=o,r.push(i.compose(e,t,n))}),r},_getReferenceKey:function(e,t){return e},_composeObject:function(e,t,n){var r={};for(var i in e)if(e.hasOwnProperty(i)){var s=this._getCompositionValue(e[i],i,t,n);s!==p&&(r[i]=s)}return r},_getCompositionValue:function(e,t,r,u,a){if(e instanceof i)return this._composeSubModel(e,r,u,a);if(e instanceof n)return this._composeSubCollection(e,r,u,a);if(e instanceof s)return this._composeEntity(e,r,u);if(e instanceof o){var l=[],c=this;return e.each(function(e,t){l.push(c._getCompositionValue(e,t,r,u,a))}),l}if(e instanceof Date)return e?f(e).format(this.$dataSource.$.dateFormat):null;if(e instanceof Array){var h=[];for(var p=0;p<e.length;p++)h.push(this._getCompositionValue(e[p],p,r,u,a));return h}return e instanceof Object?this._composeObject(e):e},_composeEntity:function(e,t,n){var o={},u=e.compose(t,n),a,f,l=e instanceof i,c=e.factory;for(var h in e.schema)if(e.schema.hasOwnProperty(h)&&(!l||!n||!n.includeInIndex||r.contains(n.includeInIndex,h))){a=e.schema[h],f=a.type;var d=this._getCompositionValue(u[h],h,t,n,e);if(d!==p){if(d&&a.isReference&&f.classof&&f.classof(s)&&!f.classof(i)){var v=d[f.prototype.idField];d={},d[f.prototype.idField]=v}o[this._getReferenceKey(h,f)]=d}}return o},_composeSubModel:function(e,t,n,r){return e.identifier()},_composeSubCollection:function(e,t,n){return p},parse:function(e,t,r,u){var a=e.schema,l,c,p,d;for(var v in a)if(a.hasOwnProperty(v)){l=a[v],c=l.type,p=this._getValueForKey(t,v,c,l),d=null;var m,g,y,b;if(c instanceof Array){if(c.length===1)m=c[0];else{if(c.length!==0)throw"Cannot determinate ModelFactory. Multiple factories defined for '"+v+"'.";this.log('ModelFactory for ListItem for "'+v+'" not defined',"warn"),d=s}m instanceof Function&&(d=m,m=null);if(p&&p instanceof Array){b=t[v]=new o;for(y=0;y<p.length;y++)m&&(d=m.resolve(p[y],v)),d&&d.classof(s)?(g=this.$dataSource._getContext(d,e,p[y]).createEntity(d,this._getIdForValue(p[y],d)),g instanceof s&&!(g instanceof i)&&(g.$parent=e,g.$parentEntity=e),g.set(this._parseModel(g,p[y],r,u)),b.add(g)):b.add(p[y])}}else if(n&&c.classof(n)){var w=this.$dataSource._getContext(c,e,p);w&&(e.$[v]instanceof n?t[v]=e.$[v]:(b=t[v]=w.createCollection(c,p instanceof Object&&!(p instanceof Array)?p:null),b.$parent=w.$contextModel,p&&p instanceof Array&&b.reset(this.parseCollection(b,p,r,u))))}else if(c!==Date||!p||p instanceof Date){if(c.classof(s)&&p){c instanceof h?d=c.resolve(p,v):d=c||s;if(!d||!d.classof(s))throw"Factory for type '"+v+"' isn't an instance of Entity";t[v]=g=this.$dataSource._getContext(d,e,p).createEntity(d,this._getIdForValue(p,d)),g instanceof s&&!(g instanceof i)&&(g.$parent=e,g.$parentEntity=e),g.set(this._parseModel(g,p,r,u))}}else t[v]=f(p,this.$dataSource.$.dateFormat).toDate()}return e.parse(t)},_getIdForValue:function(e,t){return e[t.prototype.idField]},_parseModel:function(e,t,n,r){var i=this.$dataSource.getProcessorForModel(e);return i.parse(e,t,n,r)},parseCollection:function(e,t,n,r){if(t instanceof Array){var s,o;for(var u=0;u<t.length;u++){var a=t[u];a instanceof i||(s=this.$dataSource._getContext(e.$modelFactory,e,a),o=s.createEntity(e.$modelFactory,this._getIdForValue(a,e.$modelFactory)),o.set(this._parseModel(o,a,n,r)),t[u]=o)}return t}throw"data has to be an array"},_getValueForKey:function(e,t,n,r){return r&&r.key&&(t=r.key),e[t]},saveSubModels:function(e,t,s){var o=e.schema,a=[],f,l,c,h=function(e){a.push(e)};for(var p in o)o.hasOwnProperty(p)&&(f=o[p],f.classof&&(f.classof(i)?(c=e.$[p],c&&r.include(e.$nestedModels,p)&&a.push(c)):f.classof(n)&&(l=e.$[p],l&&l.each(h))));u().parEach(a,function(e,n){e.save(t,n)}).exec(s)},getSubModelsForModel:function(e){function n(s){if(s===e)return;if(r.indexOf(t,s)!==-1)return;if(s instanceof i){t.push(s);return}for(var u in s)if(s.hasOwnProperty(u)){var a=s[u];if(a instanceof Array)for(var f=0;f<a.length;f++)n(a[f]);else a instanceof o?a.each(n):a instanceof Object&&n(a)}}var t=[];return n(e.$),t}}),m=e.inherit("js.data.DataSource",{$processors:{},$entityFactory:s,$defaultProcessorFactory:v,$defaultProcessor:null,defaults:{dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},ctor:function(){this.$dataSourceConfiguration=null,this.$configuredTypes=[],this.$rootContext=this.createContext(),this.$formatProcessors=[],this.callBase(),this.initializeFormatProcessors(),this.initializeProcessors()},initializeFormatProcessors:function(){},initializeProcessors:function(){this.$defaultProcessor=new this.$defaultProcessorFactory(this);for(var e in this.$processors)this.$processors.hasOwnProperty(e)&&this.$processors[e]instanceof Function&&(this.$processors[e]=new this.$processors[e](this))},composeModel:function(e,t){var n=this.getProcessorForModel(e,t);return n.compose(e,m.ACTION.CREATE,t)},parseModel:function(e,t,n){var r=this.getProcessorForModel(e,n);return e.set(r.parse(e,t,m.ACTION.CREATE,n)),e},_childrenInitialized:function(){this.callBase();for(var e=0;e<this.$configurations.length;e++){var t=this.$configurations[e];if(t instanceof l){this.$dataSourceConfiguration=t;break}}this._validateConfiguration()},_validateConfiguration:function(){},getConfigurationForModelClass:function(e){return this.$dataSourceConfiguration.getConfigurationForModelClass(e)},getConfigurationForCollectionClassName:function(e){return this.$dataSourceConfiguration.getConfigurationForCollectionClassName(e)},getContextForChild:function(e,t){if(e){var r,s;e.classof(i)?r=this.getConfigurationForModelClass(e):e.classof(n)&&(r=this.getConfigurationForModelClass(e.prototype.$modelFactory));if(r&&t){var o=r;do{o=o.$parent;if(!(o instanceof c))break;if(o.$.modelClassName===t.constructor.name)return this.getContextByProperties(t,null,t.$context)}while(o.$parent);var u=t.$context;while(u&&u.$contextModel){if(u.$contextModel.constructor.name===r.$.modelClassName)return u.$contextModel.$context;u=u.$contextModel.$context}}}return t?t.$context:this.root()},getContextByProperties:function(e,t,n){return e||t&&r.size(t)?(n=n||this.root(),n.getContext(e,t)):this.root()},root:function(){return this.$rootContext},createContext:function(e,t,n){return new d(this,e,t,n)},createEntity:function(e,t,n){return n=n||this.getContextByProperties(),n.createEntity(e,t)},createCollection:function(e,t,n){return n=n||this.getContextByProperties(),n.createCollection(e,t)},resolveReferences:function(e,t,n,r){r&&r("Abstract method",t)},loadModel:function(e,t,n){n&&n("Abstract method",e)},loadCollectionPage:function(e,t,n){n&&n("Abstact method loadCollectionPage",e)},countCollection:function(e,t,n){n&&n("Abstrat method countCollection",NaN)},saveModel:function(e,t,n){var r=this;u().seq(function(n){r._beforeModelSave(e,t,n)}).seq(function(n){r._saveModel(e,t,n)}).seq(function(n){r._afterModelSave(e,t,n)}).exec(function(r){n&&n(r,e,t)})},_beforeModelSave:function(e,t,n){n&&n()},_saveModel:function(e,t,n){n&&n("Abstract method saveModel",e)},_afterModelSave:function(e,t,n){n&&n()},removeModel:function(e,t,n){n&&n("Abstract method removeModel",e)},getProcessorForModel:function(e,t){var n;return e&&(n=this.getProcessorForModelClass(e.factory,t)),n||this.$defaultProcessor},getProcessorForModelClass:function(e,t){var n=this.getConfigurationForModelClass(e);if(n&&n.$.processor){var r=n.$.processor;if(this.$processors[r])return this.$processors[r];throw"Processor for '"+r+"' not an instance of js.data.DataSource.Processor."}},getProcessorForCollection:function(e,t){var n;return e&&e.$modelFactory&&(n=this.getProcessorForModelClass(e.$modelFactory,t)),n||this.$defaultProcessor},getFormatProcessor:function(e){return this.$formatProcessors[0]},clone:function(){var e=this.callBase();return e.$dataSourceConfiguration=this.$dataSourceConfiguration,e},_getContext:function(e,t,r){if(e.classof){if(e.classof(n))return t.getContextForChild(e);if(e.classof(i))return t.getContextForChild(e);if(e.classof(s))return t.getContextForChild(e)}return null},_translateQueryObject:function(e){return e}});return m.FormatProcessor=t.inherit("js.data.DataSource.FormatProcessor",{serialize:function(e){throw"abstract method"},deserialize:function(e){throw"abstract method"},getContentType:function(){throw"abstract method"}}),m.JsonFormatProcessor=m.FormatProcessor.inherit("js.data.DataSource.JsonFormatProcessor",{serialize:function(e){return a.stringify(e)},deserialize:function(e){return a.parse(e)},getContentType:function(){return"application/json"}}),m.ERROR={NOT_FOUND:"not_found"},m.Context=d,m.Processor=v,m.ACTION={LOAD:"load",CREATE:"create",UPDATE:"update",DELETE:"delete"},m.IdGenerator={genId:function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},m}),define=typeof define!="undefined"?define:function(e,t){module.exports=t(exports,require("../..").Query),define=undefined},define("js/lib/query/composer/RestQueryComposer",["exports","Query"],function(e,t){var n={eql:"=",gt:">",lt:"<",lte:"<=",gte:">="},r,i={compose:function(e){var t=e.query,n={};return t.sort&&(n.sort=this.translateSort(t.sort)),t.where&&(n.where=this.translateOperator(t.where)),n},translateSort:function(e){var t=[];for(var n=0;n<e.length;n++)t.push((e[n].direction===1?"+":"-")+e[n].field);return t.join(",")},translateOperator:function(e,i){i=i===r?0:i;var s=e.operator;if(e instanceof t.Where){var o=this.translateExpressions(e.expressions,i+1).join(" "+s+" ");return o.length&&s!=="not"&&i!==0&&(o="("+o+")"),s==="not"&&(o=s+o),o}if(!(e instanceof t.Comparator))return s;var u=e.getValue(),a=typeof u;a==="string"&&(/^(\d+|false|true|null)$/.test(u)||this.value==="false"||this.value==="true")&&(u=a+":"+u);if(n.hasOwnProperty(s))return e.field+n[s]+u;if(e.field&&u!==r)return u instanceof Array&&(u="("+e.value.join(",")+")"),s+"("+e.field+","+u+")"},translateExpressions:function(e,t){var n=[];for(var r=0;r<e.length;r++)n.push(this.translateOperator(e[r],t));return n}};return e.RestQueryComposer=i,e}),define("js/data/RestDataSource",["js/data/DataSource","js/data/Model","underscore","flow","JSON","js/data/Collection","require","js/lib/query/composer/RestQueryComposer"],function(e,t,n,r,i,s,o,u){var a=/http.+\/([^/]+)$/,f=e.Processor.inherit("js.data.RestDataSource.RestDataProcessor",{_composeSubModel:function(e,n,r,i){if(i instanceof t){var s=0,o=this.$dataSource.$dataSourceConfiguration.getConfigurationForModelClass(e.factory),u=s.$parent,a=[];while(o&&o.$.path)a.unshift(o),o=o.$parent;var f=[];o=this.$dataSource.$dataSourceConfiguration.getConfigurationForModelClass(i.factory);while(o&&o.$.path)f.unshift(o),o=o.$parent;var l=0;while(f[l]&&a[l]&&f[l].$.path===a[l].$.path)l++;s=a.length-l;if(s>0){var c=[];u=e;while(s>0)c.unshift(u.identifier()),u=u.$context.$contextModel,s--;var h={};return h[e.idField]=c.join("/"),h}}var p={};return p[e.idField]=e.identifier(),p}}),l=e.inherit("js.data.RestDataSource",{defaults:{endPoint:null,gateway:null,determinateContextAttribute:"href",parsePayloadOnCreate:!0,parsePayloadOnUpdate:!0,useSafeHttpMethods:!1,collectionPageSize:100,suffix:null},ctor:function(){this.callBase()},$defaultProcessorFactory:f,initialize:function(){this.$.endPoint||this.log("No end-point for RestDataSource defined","warn"),this.$.gateway||(this.$.gateway=this.$.endPoint)},_validateConfiguration:function(){if(!this.$dataSourceConfiguration)throw"No DataSourceConfiguration specified"},initializeFormatProcessors:function(){var t=new e.JsonFormatProcessor;t.regex=/json/,this.$formatProcessors.push(t)},createContext:function(e,t,n){return new l.RestContext(this,e,t,n)},getQueryParameters:function(e,t){var r={};return this.$.useSafeHttpMethods&&(e===l.METHOD.DELETE?r.method="delete":e===l.METHOD.PUT&&(r.method="put")),t instanceof s&&(n.defaults(r,t.getQueryParameters(e),t.getRoot().$context.getQueryParameters()),t.$.query&&n.defaults(r,this.getQueryComposer().compose(t.$.query))),r},getQueryComposer:function(){return u.RestQueryComposer},_getHttpMethod:function(e){if(this.$.useSafeHttpMethods)if(e===l.METHOD.PUT||e===l.METHOD.DELETE)return l.METHOD.POST;return e},getPathComponentsForResource:function(e){return e instanceof s?this.getPathComponentsForModelClass(e.$modelFactory):e instanceof t?this.getPathComponentsForModel(e):null},getPathComponentsForModel:function(e){if(e){var t=this.getPathComponentsForModelClass(e.factory);if(t)return e.isNew()||t.push(e.identifier()),t}return null},getPathComponentsForModelClass:function(e){if(e){var t=this.$dataSourceConfiguration.getConfigurationForModelClass(e);if(t){var n=t.$.path;if(n)return[n]}}return null},_buildUriForResource:function(e,t){var n=this.getPathComponentsForResource(e);if(!n)throw new Error("path for resource unknown");var r=[t||this.$.gateway];return r=r.concat(e.$context.getPathComponents()),r=r.concat(n),this.$.suffix&&(r[r.length-1]=r[r.length-1]+"."+this.$.suffix),this._resourcePathToUri(r,e)},_resourcePathToUri:function(e,t){return e.join("/")},loadModel:function(e,t,i){var s=this,o=this._buildUriForResource(e),u=n.defaults(e.$context.getQueryParameters(),this.getQueryParameters(l.METHOD.GET,e));t.noCache&&(u.timestamp=(new Date).getTime()),r().seq("xhr",function(e){s.$stage.$applicationContext.ajax(o,{type:l.METHOD.GET,queryParameter:u},e)}).seq(function(n){var r=this.vars.xhr;r.status===200||r.status===304?(s._parseModelPayload(r,e,t),n(null,e,t)):s._handleXHRError({url:o,xhr:r,queryParameter:u,model:e,options:t},i)}).exec(function(n){i&&i(n,e,t)})},_parseModelPayload:function(t,n,r){var i=t.getResponseHeader("Content-Type"),s=this.getFormatProcessorForContentType(i);if(!s)throw new Error("No formatProcessor for content type '"+i+"' found",null,r);var o=s.deserialize(t.responses.text),u=this.getProcessorForModel(n,r);o=u.parse(n,o,e.ACTION.LOAD,r),n.set(o)},handleCreationSuccess:function(e,t,n){var r=e.model,i=function(t){n&&n(t,r,e.options)},o=this;try{var u=t.getResponseHeader("Location");if(u){o.$.parsePayloadOnCreate&&o._parseModelPayload(t,r,e.options);var a=this.extractIdFromLocation(u,e);if(a||a===0){r.set(r.idField,a),r.hrefField&&r.set(r.hrefField,u);var f=r.schema,l;for(var c in f)if(f.hasOwnProperty(c)){l=f[c];if(l.classof&&l.classof(s)){var h=r.getContextForChild(l);r.set(c,h.createCollection(l,null))}}r.$context.addEntityToCache(r),i(null)}else i("Id couldn't be extracted")}else i("Location header not found")}catch(p){i(p||!0)}},_getContext:function(e,t,n){if(this.$.determinateContextAttribute){if(!n)return null;if(n.hasOwnProperty(this.$.determinateContextAttribute)){var r,i,s,u=this.root(),a,f,l;if(!this.$cachedEndpoint){var c=n[this.$.determinateContextAttribute];r=c.replace(/(http(s)?:\/\/.+?)\//i,""),this.$cachedEndpoint=c.substring(0,c.length-r.length),i=r.split("/");while(!this.$dataSourceConfiguration.getConfigurationByKeyValue("path",i[0]))this.$cachedEndpoint+=i.shift()+"/"}else r=n[this.$.determinateContextAttribute].replace(this.$cachedEndpoint,""),i=r.split("/");for(var h=0;h<i.length-2;h+=2){l=i[h],f=i[h+1],s?s=s.getConfigurationByKeyValue("path",l):s=this.$dataSourceConfiguration.getConfigurationByKeyValue("path",l);if(!s)throw new Error("Couldn't find configuration for path element "+h+" of "+i.join("/")+" ");a=o(s.$.modelClassName.replace(/\./g,"/"));var p=u.createEntity(a,f);u=u.getContext(p)}return u}}return this.callBase()},handleUpdateSuccess:function(e,t,n){var r=e.model;this.$.parsePayloadOnUpdate&&this._parseModelPayload(t,r,e.options),n&&n(null,r,e.options)},extractIdFromLocation:function(e,t){var n=a.exec(e);return n?n[1]:null},_saveModel:function(i,s,o){s=s||{};var u=e.ACTION.UPDATE,a=l.METHOD.PUT;i._status()===t.STATE.NEW&&(u=e.ACTION.CREATE,a=l.METHOD.POST);var f=this.getProcessorForModel(i,s),c=this.getFormatProcessor(u,i),h=this;r().seq(function(e){f.saveSubModels(i,s,e)}).seq(function(t){var r=h._buildUriForResource(i),o=n.defaults(i.$context.getQueryParameters(),h.getQueryParameters(a,i));a=h._getHttpMethod(a);var l=f.compose(i,u,s),p=c.serialize(l);h.$stage.$applicationContext.ajax(r,{type:a,queryParameter:o,data:p,xhrCreated:s.xhrCreated,xhrBeforeSend:s.xhrBeforeSend,contentType:c.getContentType()},function(n,a){if(!n){var f={xhr:a,url:r,queryParameter:o,model:i,options:s};u===e.ACTION.CREATE&&a.status===201?h.handleCreationSuccess(f,a,t):u===e.ACTION.UPDATE&&a.status===200?h.handleUpdateSuccess(f,a,t):h._handleXHRError(f,t)}else t(n)})}).exec(function(e){o&&o(e,i,s)})},extractListMetaData:function(e,t,n,r){return t},extractListData:function(e,t,r,i){for(var s in t)if(t.hasOwnProperty(s)&&n.isArray(t[s]))return t[s]},loadCollectionPage:function(t,r,s){var o=t.getRoot(),u=this.$dataSourceConfiguration.getConfigurationForModelClass(o.$modelFactory);if(!u)throw new Error("Couldn't find path config for "+o.$modelFactory.prototype.constructor.name);var a=[u.$.path];if(!a){s("path for model unknown",null,r);return}var f={};n.defaults(f,(r||{}).params,this.getQueryParameters(l.METHOD.GET,t.$collection)),n.extend(f,this._getPagingParameterForCollectionPage(t)),r.noCache&&(f.timestamp=(new Date).getTime()),f.fullData=f.fullData||r.fullData||!1;for(var c in f)f.hasOwnProperty(c)&&n.isObject(f[c])&&(f[c]=i.stringify(f[c]));var h=this._buildUriForResource(o),p=this;this.$stage.$applicationContext.ajax(h,{type:l.METHOD.GET,queryParameter:f},function(n,i){if(!!n||i.status!=200&&i.status!=304)p._handleXHRError({url:h,xhr:i,queryParameter:f,collection:o,options:r},s);else{var u=i.getResponseHeader("Content-Type"),a=p.getFormatProcessorForContentType(u);if(!a){s("No formatProcessor for content type '"+u+"' found",null,r);return}try{var l=a.deserialize(i.responses.text),c=p.extractListMetaData(t,l,r,i);t.setMetaData(c);var d=p.extractListData(t,l,r,i),v=p.getProcessorForCollection(t);d=v.parseCollection(t.getRoot(),d,e.ACTION.LOAD,r),t.add(d),s(null,t,r)}catch(m){p.log(m,"error"),s(m,t,r)}}})},_handleXHRError:function(e,t){this.trigger("on:xhrError",e),t&&t(e)},_createSortParameter:function(e){var t=null,n=[];for(var r in e)e.hasOwnProperty(r)&&(t=t||{},n.push((e[r]===-1?"+":"-")+r));return n.length>0&&(t={sort:"("+n.join(",")+")"}),t},_getPagingParameterForCollectionPage:function(e){var t={};return e.$offset&&(t.offset=e.$offset),e.$limit&&(t.limit=e.$limit),t},removeModel:function(e,t,r){r=r||function(){};var i=this._buildUriForResource(e),s=l.METHOD.DELETE,o=n.defaults(e.$context.getQueryParameters(),this.getQueryParameters(s,e));s=this._getHttpMethod(s),this.$stage.$applicationContext.ajax(i,{type:s,queryParameter:o},function(t,n){!!t||n.status!=200&&n.status!=304&&n.status!=202&&n.status!=204?(t=t||"wrong status code",r(t,e)):r(null,e)})},getFormatProcessorForContentType:function(e){for(var t=0;t<this.$formatProcessors.length;t++){var n=this.$formatProcessors[t];if(n.regex.test(e))return n}return null}});return l.RestContext=e.Context.inherit("js.data.RestDataSource.Context",{getPathComponents:function(){var e=[];if(!this.$parent)return[];e=this.$parent.getPathComponents();if(!this.$contextModel)throw new Error("ContextModel missing for non-root-Context");var t=this.$dataSource.getConfigurationForModelClass(this.$contextModel.factory);return e.push(t.$.path,this.$contextModel.identifier()),e},createCollection:function(e,t,r){return t=t||{},n.defaults(t,{pageSize:this.$dataSource.$.collectionPageSize||100}),this.callBase(e,t,r)},getQueryParameters:function(){return{}}}),l.METHOD={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},l.XmlFormatProcessor=e.FormatProcessor.inherit("js.data.RestDataSource.XmlFormatProcessor",{serialize:function(e){throw"not implemented"},deserialize:function(e){throw"not implemented"}}),l.RestDataProcessor=f,l}),define("sprd/data/SprdDataSource",["js/data/RestDataSource","js/data/Model","js/data/Collection","underscore"],function(e,t,n,r){var i=e.inherit("sprd.data.SprdDataSource",{defaults:{apiKey:null,secret:null,session:null},_getConfigurationForResource:function(e){var r=e.$context,i=this.$dataSourceConfiguration;return r&&r.$contextModel&&(i=i.getConfigurationForModelClass(r.$contextModel.factory)),e instanceof t?i.getConfigurationForModelClass(e.factory):e instanceof n?i.getConfigurationForModelClass(e.$modelFactory):null},getQueryParameters:function(e,t){var n={};this.$.locale&&(n.locale=this.$.locale);var s=r.defaults(n,this.callBase()),o,u=this.$.apiKey,a;o=this._getConfigurationForResource(t);if(!o)throw new Error("Configuration for resource not found");var f=o.$.signatureRequired,l=o.$.apiKeyRequired,c=o.$.sessionRequired;a=f||c,this.$.session&&c&&(s=r.defaults({sessionId:this.$.session.$.id}));if(a){var h=this.$.secret,p=Date.now(),d=this._buildUriForResource(t,this.$.endPoint),v=e+" "+d+" "+p+" "+h;s=r.defaults({sig:i.SHA1(v),time:p,apiKey:u})}if(l||f||c)s=r.defaults(s,{apiKey:u});return s}});return i.SHA1=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e){var t="",n,r;for(n=7;n>=0;n--)r=e>>>n*4&15,t+=r.toString(16);return t}function r(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var i,s,o,u=new Array(80),a=1732584193,f=4023233417,l=2562383102,c=271733878,h=3285377520,p,d,v,m,g,y;e=r(e);var b=e.length,w=[];for(s=0;s<b-3;s+=4)o=e.charCodeAt(s)<<24|e.charCodeAt(s+1)<<16|e.charCodeAt(s+2)<<8|e.charCodeAt(s+3),w.push(o);switch(b%4){case 0:s=2147483648;break;case 1:s=e.charCodeAt(b-1)<<24|8388608;break;case 2:s=e.charCodeAt(b-2)<<24|e.charCodeAt(b-1)<<16|32768;break;case 3:s=e.charCodeAt(b-3)<<24|e.charCodeAt(b-2)<<16|e.charCodeAt(b-1)<<8|128}w.push(s);while(w.length%16!=14)w.push(0);w.push(b>>>29),w.push(b<<3&4294967295);for(i=0;i<w.length;i+=16){for(s=0;s<16;s++)u[s]=w[i+s];for(s=16;s<=79;s++)u[s]=t(u[s-3]^u[s-8]^u[s-14]^u[s-16],1);p=a,d=f,v=l,m=c,g=h;for(s=0;s<=19;s++)y=t(p,5)+(d&v|~d&m)+g+u[s]+1518500249&4294967295,g=m,m=v,v=t(d,30),d=p,p=y;for(s=20;s<=39;s++)y=t(p,5)+(d^v^m)+g+u[s]+1859775393&4294967295,g=m,m=v,v=t(d,30),d=p,p=y;for(s=40;s<=59;s++)y=t(p,5)+(d&v|d&m|v&m)+g+u[s]+2400959708&4294967295,g=m,m=v,v=t(d,30),d=p,p=y;for(s=60;s<=79;s++)y=t(p,5)+(d^v^m)+g+u[s]+3395469782&4294967295,g=m,m=v,v=t(d,30),d=p,p=y;a=a+p&4294967295,f=f+d&4294967295,l=l+v&4294967295,c=c+m&4294967295,h=h+g&4294967295}return y=n(a)+n(f)+n(l)+n(c)+n(h),y.toLowerCase()},i}),define("sprd/model/processor/DefaultProcessor",["js/data/DataSource"],function(e){return e.Processor.inherit("sprd.model.processor.DefaultProcessor",{_composeSubModel:function(e,t,n){return{id:e.$.id}}})}),define("sprd/model/processor/BasketProcessor",["sprd/model/processor/DefaultProcessor"],function(e){return e.inherit("sprd.model.processor.BasketProcessor",{compose:function(e){var t=this.callBase(),n=e.$.basketItems,r=[];if(n){var i=this;n.each(function(e){r.push(i.$dataSource.composeModel(e))}),t.basketItems=r}return t}})}),define("sprd/model/processor/BasketItemProcessor",["sprd/model/processor/DefaultProcessor","sprd/model/Shop","sprd/model/Article","sprd/model/Product"],function(e,t,n,r){var i="sprd:product",s="sprd:article";return e.inherit("sprd.model.processor.BasketItemProcessor",{parse:function(e,o,u,a){var f=o.element,l=f.properties,c,h={};for(var p=0;p<l.length;p++){c=l[p];if(c.key==="size"||c.key==="appearance")h[c.key]||(h[c.key]={}),h[c.key].id=c.value;c.key==="sizeLabel"&&(h.size||(h.size={}),h.size.name=c.value),c.key==="appearanceLabel"&&(h.appearance||(h.appearance={}),h.appearance.name=c.value)}var d=this.$dataSource.createEntity(t,o.shop.id);if(f.type===s)h.item=this.$dataSource.getContextForChild(n,d).createEntity(n,f.id);else{if(f.type!==i)throw"Element type '"+f.type+"' not supported";h.item=this.$dataSource.getContextForChild(r,d).createEntity(r,f.id)}return h.item.set("price",o.price),o.element=h,this.callBase(e,o,u,a)},compose:function(e){var t=this.callBase(),n=t.element,r={};r.properties=[{key:"appearance",value:n.appearance.id},{key:"size",value:n.size.id}];var i=[],s=e.get("element.continueShoppingLink");s&&i.push({type:"continueShopping",href:s});var o=e.get("element.editLink");o&&i.push({type:"edit",href:o}),i.length>0&&(r.links=i),r.type=e.$.element.getType(),r.href=e.get("element.item.href"),r.id=e.get("element.item.id");var u={element:r,quantity:t.quantity};return t.origin&&(u.origin=t.origin),u}})}),define("sprd/data/SprdApiQueryComposer",["js/data/Query"],function(e){var t;return{compose:function(e){e=e.query;var t={};e.sort&&(t.sortField=e.sort[0].field,t.sortOrder=e.sort[0].direction?"asc":"desc"),e.where&&(t.query=this.translateOperator(e.where));if(e.extra)for(var n in e.extra)e.extra.hasOwnProperty(n)&&(t[n]=e.extra[n]);return t},translateOperator:function(n,r){r=r===t?0:r;var i=n.operator;if(n instanceof e.Where)return this.translateExpressions(n.expressions,r+1).join(" ");if(n instanceof e.Comparator){if(i==="in")return["+",n.field,":(",n.value.join(" "),")"].join("");if(i==="eql")return n.value}return""},translateExpressions:function(e,t){var n=[];for(var r=0;r<e.length;r++)n.push(this.translateOperator(e[r],t));return n}}}),define("sprd/data/SprdApiDataSourceClass",["sprd/data/SprdDataSource","js/data/RestDataSource","underscore","sprd/data/SprdModel","sprd/model/processor/DefaultProcessor","sprd/model/processor/BasketProcessor","sprd/model/processor/BasketItemProcessor","sprd/data/SprdApiQueryComposer"],function(e,t,n,r,i,s,o,u){var a=e.inherit("sprd.data.SprdApiDataSourceClass",{defaults:{locale:"en_EU",parsePayloadOnCreate:!1,parsePayloadOnUpdate:!1},$defaultProcessorFactory:i,$processors:{BasketProcessor:s,BasketItemProcessor:o},getQueryParameters:function(e,t){return n.defaults({mediaType:"json"},this.callBase())},createContext:function(e,t,n){return new a.SprdApiContext(this,e,t,n)},getQueryComposer:function(){return u},_getContextPath:function(e){var t=/\/api\/v1\/(.*)$/.exec(e[this.$.determinateContextAttribute]);return t?t[1]:this.callBase()},shop:function(e,t){e=e||this.$.shopId,t=t||this.$.locale;var n={shopId:e};return t&&(n.locale=t),this.getContext(n)},user:function(e,t){e=e||this.$.shopId,t=t||this.$.locale;var n={userId:e};return t&&(n.locale=t),this.getContext(n)}});return a.SprdApiContext=t.RestContext.inherit({getQueryParameters:function(){var e={mediaType:"json"};return this.$properties&&this.$properties.locale&&(e.locale=this.$properties.locale),n.defaults(e,this.callBase())}}),a}),define("xaml!sprd/data/SprdApiDataSource",["sprd/data/SprdApiDataSourceClass","js/core/Element","js/conf/DataSourceConfiguration","js/conf/ResourceConfiguration"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<data:SprdApiDataSourceClass xmlns:data="sprd.data" xmlns:conf="js.conf">\n    <conf:DataSourceConfiguration>\n        <conf:ResourceConfiguration path="languages" modelClassName="sprd.model.Language"/>\n        <conf:ResourceConfiguration path="countries" modelClassName="sprd.model.Country"/>\n        <conf:ResourceConfiguration path="shops" modelClassName="sprd.model.Shop">\n            <conf:ResourceConfiguration path="address" modelClassName="sprd.model.Address"/>\n            <conf:ResourceConfiguration path="articles" modelClassName="sprd.model.Article"/>\n            <conf:ResourceConfiguration path="articleCategories" modelClassName="sprd.model.ArticleCategory"/>\n            <conf:ResourceConfiguration path="designCategories" modelClassName="sprd.model.DesignCategory">\n                <conf:ResourceConfiguration path="designs" modelClassName="sprd.model.Design"/>\n            </conf:ResourceConfiguration>\n            <conf:ResourceConfiguration path="printTypes" modelClassName="sprd.model.PrintType"/>\n            <conf:ResourceConfiguration path="designs" modelClassName="sprd.model.Design" signatureRequired="true"/>\n            <conf:ResourceConfiguration path="designCategories" modelClassName="sprd.model.DesignCategory"/>\n\n            <conf:ResourceConfiguration path="productTypes" modelClassName="sprd.model.ProductType">\n                <conf:ResourceConfiguration path="stockStates" modelClassName="sprd.model.StockState" collectionClassName="sprd.collection.StockStates"/>\n            </conf:ResourceConfiguration>\n            <conf:ResourceConfiguration path="discountScales" modelClassName="sprd.model.DiscountScale"/>\n            <conf:ResourceConfiguration path="fontFamilies" modelClassName="sprd.model.FontFamily"/>\n            <conf:ResourceConfiguration path="products" modelClassName="sprd.model.Product" signatureRequired="true"/>\n            <conf:ResourceConfiguration path="productTypeDepartments" modelClassName="sprd.model.ProductTypeDepartment"/>\n            <conf:ResourceConfiguration path="shippingTypes" modelClassName="sprd.model.ShippingType"/>\n            <conf:ResourceConfiguration path="applications" modelClassName="sprd.model.Application"/>\n        </conf:ResourceConfiguration>\n        <conf:ResourceConfiguration path="currencies" modelClassName="sprd.model.Currency">\n\n        </conf:ResourceConfiguration>\n        <conf:ResourceConfiguration path="baskets" modelClassName="sprd.model.Basket" processor="BasketProcessor" apiKeyRequired="true">\n            <conf:ResourceConfiguration path="items" modelClassName="sprd.model.BasketItem" processor="BasketItemProcessor"/>\n        </conf:ResourceConfiguration>\n        <conf:ResourceConfiguration path="users" modelClassName="sprd.model.User">\n            <conf:ResourceConfiguration path="shops" modelClassName="sprd.model.Shop">\n                <conf:ResourceConfiguration path="articles" modelClassName="sprd.model.Article"/>\n            </conf:ResourceConfiguration>\n\n            <conf:ResourceConfiguration path="printTypes" modelClassName="sprd.model.PrintType" sessionRequired="true"/>\n            <conf:ResourceConfiguration path="designs" modelClassName="sprd.model.Design" sessionRequired="true"/>\n            <conf:ResourceConfiguration path="products" modelClassName="sprd.model.Product" sessionRequired="true"/>\n            <conf:ResourceConfiguration path="designCategories" modelClassName="sprd.model.DesignCategory"/>\n\n            <conf:ResourceConfiguration path="fontFamilies" modelClassName="sprd.model.FontFamily"/>\n            <conf:ResourceConfiguration path="productTypeDepartments" modelClassName="sprd.model.ProductTypeDepartment"/>\n            <conf:ResourceConfiguration path="shippingTypes" modelClassName="sprd.model.ShippingType"/>\n\n            <conf:ResourceConfiguration path="productTypes" modelClassName="sprd.model.ProductType" sessionRequired="true">\n                <conf:ResourceConfiguration path="stockStates" modelClassName="sprd.model.StockState" collectionClassName="sprd.collection.StockStates"/>\n            </conf:ResourceConfiguration>\n        </conf:ResourceConfiguration>\n\n        <conf:ResourceConfiguration path="sessions" modelClassName="sprd.model.Session"/>\n        <conf:ResourceConfiguration path="messages" modelClassName="sprd.model.Message" signatureRequired="true"/>\n    </conf:DataSourceConfiguration>\n</data:SprdApiDataSourceClass>')})}),define("js/ui/LinkClass",["js/ui/View"],function(e){var t=/^(([^:]+:\/\/)|(javascript:))/i,n=/^#?\/?/,r=/^#?(.*)$/;return e.inherit("js.ui.LinkClass",{defaults:{tagName:"a",href:null,label:"",target:"intern",iconClass:null,iconLabel:""},_renderIconClass:function(e){if(e)this._renderTemplateToPlaceHolder("iconTemplate","icon",{$iconClass:e});else{var t=this.getPlaceHolder("icon");t&&t.clear()}},_renderLabel:function(e){this.$.title||this._renderTitle(e)},_renderTitle:function(e){this._setAttribute("title",e)},_renderTarget:function(e){e!=="intern"&&e!=="external"&&this._setAttribute("target",e)},_renderHref:function(e){this.$tagName=="a"&&(e=e||"javascript:void(0);",this.$.target!=="external"&&!t.test(e)&&this.$.target!=="_blank"&&(e="#/"+e.replace(n,""),this.runsInBrowser()||(e=e.replace(r,"#!$1"))),this.$el.setAttribute("href",e))}})}),define("js/ui/PlaceHolder",["js/html/HtmlElement","js/core/Content","underscore"],function(e,t,n){return e.inherit({defaults:{name:null},render:function(){if(this.isRendered())return this.$el;this.$textNode=this.$stage.$document.createTextNode("");var e;return this.$.content&&(e=this._getDomElementForContent(this.$.content)),e||(e=this.$textNode),this.$el=e,this.$el},clear:function(){this.set({content:null})},_renderContent:function(e){var t=this.$el.parentNode;if(t){var n=this._getDomElementForContent(e);n?(t.replaceChild(n,this.$el),this.$el=n):this.$textNode!==this.$el&&(t.replaceChild(this.$textNode,this.$el),this.$el=this.$textNode)}},_getDomElementForContent:function(e){var r;e instanceof t?r=e.$children:n.isArray(e)?r=e:e?r=[e]:r=[];var i,s;for(var o=0;o<r.length;o++){i=r[o];if(i.render)return s=i.render(),s}return null}})}),define("xaml!js/ui/Link",["js/ui/LinkClass","js/core/Element","js/core/Template","js/ui/PlaceHolder","js/html/HtmlElement"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:LinkClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">\n    <js:Template name="layout">\n        <ui:PlaceHolder name="icon"/> {label}\n    </js:Template>\n    <js:Template name="iconTemplate">\n        <i class="{$iconClass}">{iconLabel}</i>\n    </js:Template>\n</ui:LinkClass>')})}),define("js/ui/Button",["xaml!js/ui/Link","js/core/Content"],function(e){return e.inherit({defaults:{componentClass:"btn",labelClass:"",type:null},_renderType:function(e,t){t&&this.removeClass("btn-"+t),e&&this.addClass("btn-"+e)},_renderSize:function(e,t){e&&this.removeClass("btn-"+e),t&&this.addClass("btn-"+t)}})}),define("app/lib/highlight/highlight",function(){return function(e){var t=new function(){function e(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function n(e,t,n){return RegExp(t,"m"+(e.case_insensitive?"i":"")+(n?"g":""))}function r(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeName=="CODE")return n;if(n.nodeType!=3||!n.nodeValue.match(/\s+/))break}}function i(e,t){var n="";for(var r=0;r<e.childNodes.length;r++)if(e.childNodes[r].nodeType==3){var s=e.childNodes[r].nodeValue;t&&(s=s.replace(/\n/g,"")),n+=s}else e.childNodes[r].nodeName=="BR"?n+="\n":n+=i(e.childNodes[r]);return/MSIE [678]/.test(navigator.userAgent)&&(n=n.replace(/\r/g,"\n")),n}function s(e){var t=e.className.split(/\s+/);t=t.concat(e.parentNode.className.split(/\s+/));for(var n=0;n<t.length;n++){var r=t[n].replace(/^language-/,"");if(v[r]||r=="no-highlight")return r}}function o(e){var t=[];return function(e,n){for(var r=0;r<e.childNodes.length;r++)e.childNodes[r].nodeType==3?n+=e.childNodes[r].nodeValue.length:e.childNodes[r].nodeName=="BR"?n+=1:e.childNodes[r].nodeType==1&&(t.push({event:"start",offset:n,node:e.childNodes[r]}),n=arguments.callee(e.childNodes[r],n),t.push({event:"stop",offset:n,node:e.childNodes[r]}));return n}(e,0),t}function u(t,n,r){function u(){return t.length&&n.length?t[0].offset!=n[0].offset?t[0].offset<n[0].offset?t:n:n[0].event=="start"?t:n:t.length?t:n}function a(t){var n="<"+t.nodeName.toLowerCase();for(var r=0;r<t.attributes.length;r++){var i=t.attributes[r];n+=" "+i.nodeName.toLowerCase(),i.value!==undefined&&i.value!==!1&&i.value!==null&&(n+='="'+e(i.value)+'"')}return n+">"}var i=0,s="",o=[];while(t.length||n.length){var f=u().splice(0,1)[0];s+=e(r.substr(i,f.offset-i)),i=f.offset;if(f.event=="start")s+=a(f.node),o.push(f.node);else if(f.event=="stop"){var l,c=o.length;do c--,l=o[c],s+="</"+l.nodeName.toLowerCase()+">";while(l!=f.node);o.splice(c,1);while(c<o.length)s+=a(o[c]),c++}}return s+e(r.substr(i))}function a(){function e(r,i,s){if(r.compiled)return;var o;s||(r.beginRe=n(i,r.begin?r.begin:"\\B|\\b"),!r.end&&!r.endsWithParent&&(r.end="\\B|\\b"),r.end&&(r.endRe=n(i,r.end))),r.illegal&&(r.illegalRe=n(i,r.illegal)),r.relevance===undefined&&(r.relevance=1);if(r.keywords){r.lexemsRe=n(i,r.lexems||t.IDENT_RE,!0);for(var u in r.keywords){if(!r.keywords.hasOwnProperty(u))continue;r.keywords[u]instanceof Object?o=r.keywords[u]:(o=r.keywords,u="keyword");for(var a in o){if(!o.hasOwnProperty(a))continue;r.keywords[a]=[u,o[a]]}}}r.contains||(r.contains=[]),r.compiled=!0;for(var f=0;f<r.contains.length;f++)r.contains[f]=="self"&&(r.contains[f]=r),e(r.contains[f],i,!1);r.starts&&e(r.starts,i,!1)}for(var r in v){if(!v.hasOwnProperty(r))continue;e(v[r].defaultMode,v[r],!0)}}function f(t,r){function i(e,t){for(var n=0;n<t.contains.length;n++)if(t.contains[n].beginRe.test(e))return t.contains[n]}function s(e,t){if(y[e].end&&y[e].endRe.test(t))return 1;if(y[e].endsWithParent){var n=s(e-1,t);return n?n+1:0}return 0}function o(e,t){return t.illegal&&t.illegalRe.test(e)}function u(e,t){var r=[];for(var i=0;i<e.contains.length;i++)r.push(e.contains[i].begin);var s=y.length-1;do y[s].end&&r.push(y[s].end),s--;while(y[s+1].endsWithParent);return e.illegal&&r.push(e.illegal),n(t,"("+r.join("|")+")",!0)}function l(e,t){var n=y[y.length-1];n.terminators||(n.terminators=u(n,g)),n.terminators.lastIndex=t;var r=n.terminators.exec(e);return r?[e.substr(t,r.index-t),r[0],!1]:[e.substr(t),"",!0]}function c(e,t){var n=g.case_insensitive?t[0].toLowerCase():t[0],r=e.keywords[n];return r&&r instanceof Array?r:!1}function h(t,n){t=e(t);if(!n.keywords)return t;var r="",i=0;n.lexemsRe.lastIndex=0;var s=n.lexemsRe.exec(t);while(s){r+=t.substr(i,s.index-i);var o=c(n,s);o?(w+=o[1],r+='<span class="'+o[0]+'">'+s[0]+"</span>"):r+=s[0],i=n.lexemsRe.lastIndex,s=n.lexemsRe.exec(t)}return r+t.substr(i,t.length-i)}function p(e,t){if(t.subLanguage&&v[t.subLanguage]){var n=f(t.subLanguage,e);return w+=n.keyword_count,n.value}return h(e,t)}function d(t,n){var r=t.className?'<span class="'+t.className+'">':"";t.returnBegin?(E+=r,t.buffer=""):t.excludeBegin?(E+=e(n)+r,t.buffer=""):(E+=r,t.buffer=n),y.push(t),b+=t.relevance}function m(t,n,r){var u=y[y.length-1];if(r)return E+=p(u.buffer+t,u),!1;var a=i(n,u);if(a)return E+=p(u.buffer+t,u),d(a,n),a.returnBegin;var f=s(y.length-1,n);if(f){var l=u.className?"</span>":"";u.returnEnd?E+=p(u.buffer+t,u)+l:u.excludeEnd?E+=p(u.buffer+t,u)+l+e(n):E+=p(u.buffer+t+n,u)+l;while(f>1)l=y[y.length-2].className?"</span>":"",E+=l,f--,y.length--;var c=y[y.length-1];return y.length--,y[y.length-1].buffer="",c.starts&&d(c.starts,""),u.returnEnd}if(o(n,u))throw"Illegal"}a.called||(a(),a.called=!0);var g=v[t],y=[g.defaultMode],b=0,w=0,E="";try{var S,x=0;g.defaultMode.buffer="";do{S=l(r,x);var T=m(S[0],S[1],S[2]);x+=S[0].length,T||(x+=S[1].length)}while(!S[2]);if(y.length>1)throw"Illegal";return{relevance:b,keyword_count:w,value:E}}catch(N){if(N=="Illegal")return{relevance:0,keyword_count:0,value:e(r)};throw N}}function l(t){var n={keyword_count:0,relevance:0,value:e(t)},r=n;for(var i in v){if(!v.hasOwnProperty(i))continue;var s=f(i,t);s.language=i,s.keyword_count+s.relevance>r.keyword_count+r.relevance&&(r=s),s.keyword_count+s.relevance>n.keyword_count+n.relevance&&(r=n,n=s)}return r.language&&(n.second_best=r),n}function c(e,t,n){return t&&(e=e.replace(/^((<[^>]+>|\t)+)/gm,function(e,n,r,i){return n.replace(/\t/g,t)})),n&&(e=e.replace(/\n/g,"<br>")),e}function h(e,t,n){var r=i(e,n),a=s(e),h,p;if(a=="no-highlight")return;a?h=f(a,r):(h=l(r),a=h.language);var d=o(e);d.length&&(p=document.createElement("pre"),p.innerHTML=h.value,h.value=u(d,o(p),r)),h.value=c(h.value,t,n);var v=e.className;v.match("(\\s|^)(language-)?"+a+"(\\s|$)")||(v=v?v+" "+a:a);if(/MSIE [678]/.test(navigator.userAgent)&&e.tagName=="CODE"&&e.parentNode.tagName=="PRE"){p=e.parentNode;var m=document.createElement("div");m.innerHTML="<pre><code>"+h.value+"</code></pre>",e=m.firstChild.firstChild,m.firstChild.className=p.className,p.parentNode.replaceChild(m.firstChild,p)}else e.innerHTML=h.value;e.className=v,e.result={language:a,kw:h.keyword_count,re:h.relevance},h.second_best&&(e.second_best={language:h.second_best.language,kw:h.second_best.keyword_count,re:h.second_best.relevance})}function p(){if(p.called)return;p.called=!0;var e=document.getElementsByTagName("pre");for(var n=0;n<e.length;n++){var i=r(e[n]);i&&h(i,t.tabReplace)}}function d(){window.addEventListener?(window.addEventListener("DOMContentLoaded",p,!1),window.addEventListener("load",p,!1)):window.attachEvent?window.attachEvent("onload",p):window.onload=p}var v={};this.LANGUAGES=v,this.highlight=f,this.highlightAuto=l,this.fixMarkup=c,this.highlightBlock=h,this.initHighlighting=p,this.initHighlightingOnLoad=d,this.IDENT_RE="[a-zA-Z][a-zA-Z0-9_]*",this.UNDERSCORE_IDENT_RE="[a-zA-Z_][a-zA-Z0-9_]*",this.NUMBER_RE="\\b\\d+(\\.\\d+)?",this.C_NUMBER_RE="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",this.BINARY_NUMBER_RE="\\b(0b[01]+)",this.RE_STARTERS_RE="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",this.BACKSLASH_ESCAPE={begin:"\\\\.",relevance:0},this.APOS_STRING_MODE={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[this.BACKSLASH_ESCAPE],relevance:0},this.QUOTE_STRING_MODE={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[this.BACKSLASH_ESCAPE],relevance:0},this.C_LINE_COMMENT_MODE={className:"comment",begin:"//",end:"$"},this.C_BLOCK_COMMENT_MODE={className:"comment",begin:"/\\*",end:"\\*/"},this.HASH_COMMENT_MODE={className:"comment",begin:"#",end:"$"},this.NUMBER_MODE={className:"number",begin:this.NUMBER_RE,relevance:0},this.C_NUMBER_MODE={className:"number",begin:this.C_NUMBER_RE,relevance:0},this.BINARY_NUMBER_MODE={className:"number",begin:this.BINARY_NUMBER_RE,relevance:0},this.inherit=function(e,t){var n={};for(var r in e)n[r]=e[r];if(t)for(var r in t)n[r]=t[r];return n}};t.LANGUAGES.xml=function(){var e="[A-Za-z0-9\\._:-]+",t={endsWithParent:!0,contains:[{className:"attribute",begin:e,relevance:0},{begin:'="',returnBegin:!0,end:'"',contains:[{className:"value",begin:'"',endsWithParent:!0}]},{begin:"='",returnBegin:!0,end:"'",contains:[{className:"value",begin:"'",endsWithParent:!0}]},{begin:"=",contains:[{className:"value",begin:"[^\\s/>]+"}]}]};return{case_insensitive:!0,defaultMode:{contains:[{className:"pi",begin:"<\\?",end:"\\?>",relevance:10},{className:"doctype",begin:"<!DOCTYPE",end:">",relevance:10,contains:[{begin:"\\[",end:"\\]"}]},{className:"comment",begin:"<!--",end:"-->",relevance:10},{className:"cdata",begin:"<\\!\\[CDATA\\[",end:"\\]\\]>",relevance:10},{className:"tag",begin:"<style(?=\\s|>|$)",end:">",keywords:{title:{style:1}},contains:[t],starts:{className:"css",end:"</style>",returnEnd:!0,subLanguage:"css"}},{className:"tag",begin:"<script(?=\\s|>|$)",end:">",keywords:{title:{script:1}},contains:[t],starts:{className:"javascript",end:"</script>",returnEnd:!0,subLanguage:"javascript"}},{className:"vbscript",begin:"<%",end:"%>",subLanguage:"vbscript"},{className:"tag",begin:"</?",end:"/?>",contains:[{className:"title",begin:"[^ />]+"},t]}]}}}(),t.LANGUAGES.javascript={defaultMode:{keywords:{keyword:{"in":1,"if":1,"for":1,"while":1,"finally":1,"var":1,"new":1,"function":1,"do":1,"return":1,"void":1,"else":1,"break":1,"catch":1,"instanceof":1,"with":1,"throw":1,"case":1,"default":1,"try":1,"this":1,"switch":1,"continue":1,"typeof":1,"delete":1},literal:{"true":1,"false":1,"null":1}},contains:[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,t.C_LINE_COMMENT_MODE,t.C_BLOCK_COMMENT_MODE,t.C_NUMBER_MODE,{begin:"("+t.RE_STARTERS_RE+"|case|return|throw)\\s*",keywords:{"return":1,"throw":1,"case":1},contains:[t.C_LINE_COMMENT_MODE,t.C_BLOCK_COMMENT_MODE,{className:"regexp",begin:"/",end:"/[gim]*",contains:[{begin:"\\\\/"}]}],relevance:0},{className:"function",begin:"\\bfunction\\b",end:"{",keywords:{"function":1},contains:[{className:"title",begin:"[A-Za-z$_][0-9A-Za-z$_]*"},{className:"params",begin:"\\(",end:"\\)",contains:[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,t.C_LINE_COMMENT_MODE,t.C_BLOCK_COMMENT_MODE]}]}]}},e.hljs=t}(typeof exports=="undefined"?this:exports),hljs}),define("app/view/CodeTextElement",["js/core/TextElement","app/lib/highlight/highlight"],function(e,t){return e.inherit("app/view/CodeTextElement",{_initializeBindings:function(){this.$descriptor&&this.$descriptor.nodeType!==4&&this.callBase(),this._initializationComplete()},render:function(){return this.$initialized||this._initialize(this.$creationPolicy),this.$el=this.$stage.$document.createElement("div"),_.isUndefined(this.$.textContent)||this._renderTextContent(this.$.textContent),this.$el},_renderTextContent:function(e){var n=e.split("\n"),r=0,i=0;while(n.length>i&&!n[0].trim().length)n.shift();var s;if(n.length>i)do s=n[i].charCodeAt(r),s===32&&r++;while(s===32||s===10);for(i=0;i<n.length;i++)n[i]=n[i].substr(r);e=n.join("\n"),e=t.highlightAuto(e).value,e=e.replace(/(\?|>)></g,"$1&gt;<"),this.$.preRenderText&&(e=this.$.preRenderText(e)),this.$el.innerHTML="<div>"+e+"</div>"}})}),define("app/view/Explanation",["js/core/Component"],function(e){return e.inherit("app/view/Explanation",{defaults:{template:'<span class="explanation" data-title="%title%" data-content="%description%">%content%</span>',search:null,title:null},execute:function(e){if(this.$.search){var t=this.$.search,n=this._getTextContentFromDescriptor(this.$descriptor).replace(/\n/g,"").trim();e=e.replace(t,this.generateExplanationPopUp(t,n,this.$.title))}return e},generateExplanationPopUp:function(e,t,n){return this.$.template.replace("%content%",e).replace("%description%",t).replace("%title%",n)}})}),define("app/view/Code",["js/ui/View","app/view/CodeTextElement","app/view/Explanation"],function(e,t,n){return e.inherit({defaults:{tagName:"pre","class":"prettyprint"},_createTextElement:function(e,n){var r=this;return new t({preRenderText:function(e){return r.renderExplanations(e)}},e,this.$stage,this,n)},renderExplanations:function(e){if(this.$children)for(var t=0;t<this.$children.length;t++){var r=this.$children[t];r instanceof n&&(e=r.execute(e))}return e}})}),define("js/ui/MenuButtonClass",["js/ui/View","js/core/Content","js/ui/Button","underscore"],function(e,t,n,r){return e.inherit("js.ui.MenuButtonClass",{defaults:{label:"",componentClass:"btn-group menu-button",menuClassName:"dropdown-menu",menuVisible:!1,labelClass:"",buttonClass:"btn",iconClass:null,iconLabel:""},$defaultContentName:"menu",$instances:[],addChild:function(e){this.callBase(),e instanceof n&&this._collectButton(e)},_collectButton:function(e){this.$button=e,this.$toggleButton=e},_renderType:function(e){this.$button.set({type:e})},_renderIconClass:function(e){this.$button.set({iconClass:e})},_renderLabel:function(e){this.$button&&this.$button.set({label:e})},_renderMenuVisible:function(e){if(e===!0){for(var t=0;t<this.$instances.length;t++)this.$instances[t]!=this&&this.$instances[t].set({menuVisible:!1});this.addClass("open")}else this.removeClass("open")},_bindDomEvents:function(e){this.callBase(),r.contains(this.$instances,this)||this.$instances.push(this);var t=this;this.bindDomEvent("click",function(){t.set({menuVisible:!1})}),this.$toggleButton.bind("on:click",function(e){t.$.enabled&&(e.stopPropagation(),e.preventDefault(),t.set({menuVisible:!t.$.menuVisible}))}),this.$button.bind("on:click",function(e){t.trigger("on:click",e,t)}),this.dom(this.$stage.$document).bindDomEvent("click",function(e){t.set({menuVisible:!1})})},_preventDefault:function(e){e.$.stopPropagation()},closeMenu:function(){this.set("menuVisible",!1)},openMenu:function(){this.set("menuVisible",!0)},toggleMenu:function(){this.set("menuVisible",!this.$.menuVisible)}})}),define("xaml!js/ui/MenuButton",["js/ui/MenuButtonClass","js/core/Element","js/core/Template","js/ui/Button","js/ui/PlaceHolder","js/html/HtmlElement","js/ui/ContentPlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:MenuButtonClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">\n    <js:Template name="layout">\n        <ui:Button class="dropdown-toggle" componentClass="{buttonClass}" iconLabel="{iconLabel}" labelClass="{labelClass}">\n            <js:Template name="layout">\n                <ui:PlaceHolder name="icon"/><span class="{labelClass}">{label} </span>\n                <span class="caret"></span>\n            </js:Template>\n        </ui:Button>\n        <ui:ContentPlaceHolder tagName="div" name="menu" class="{menuClassName}" onclick="_preventDefault"/>\n    </js:Template>\n</ui:MenuButtonClass>')})}),define("js/ui/SplitButtonClass",["xaml!js/ui/MenuButton"],function(e){return e.inherit("js.ui.SplitButtonClass",{$defaultContentName:"menu",defaults:{menuClassName:"dropdown-menu right"},_renderType:function(e){this.$toggleButton.set({type:e}),this.$button.set({type:e})},_renderHref:function(e){this.$button.set({href:e})},_collectButton:function(e){e.$["class"].indexOf("dropdown-toggle")>-1?this.$toggleButton=e:this.$button=e}})}),define("xaml!js/ui/SplitButton",["js/ui/SplitButtonClass","js/core/Element","js/core/Template","js/ui/Button","js/html/HtmlElement","js/ui/ContentPlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:SplitButtonClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">\n    <js:Template name="layout">\n        <ui:Button class="btn"/>\n        <ui:Button class="btn dropdown-toggle">\n            <js:Template name="layout">\n                <span class="caret"></span>\n            </js:Template>\n        </ui:Button>\n        <ui:ContentPlaceHolder tagName="div" name="menu" class="{menuClassName}" onclick="_preventDefault"/>\n    </js:Template>\n\n</ui:SplitButtonClass>')})}),define("js/html/Input",["js/html/HtmlElement","underscore","moment"],function(e,t,n){var r={},i;return e.inherit("js.html.Input",{$classAttributes:["updateOnEvent","checked"],defaults:{type:"text",checked:!1,updateOnEvent:"input"},_commitChangedAttributes:function(e){this.$.type==="radio"&&e.name&&(this.$previousAttributes.name&&r[this.$previousAttributes.name]&&delete r[this.$previousAttributes.name][this.$cid],r[e.name]=r[e.name]||{},r[e.name][this.$cid]=this),this.callBase()},_renderEnabled:function(e){e?this.$el.removeAttribute("disabled"):this.$el.setAttribute("disabled","disabled")},_supportsPlaceholder:function(){return"placeHolder"in this.$el||"placeholder"in this.$el},_renderValue:function(e){if(e===null||e===i)e="";e==""&&!this._supportsPlaceholder()&&this.$.placeholder&&!this.$.focused&&(e=this.$.placeholder),String(e)!==this.$el.value&&(this.$.type==="date"&&e instanceof Date&&(e=n(e).format("YYYY-MM-DD")),this.$el.value=e)},_commitChecked:function(e){if(e&&this.$.type==="radio"){var t=r[this.$.name];for(var n in t)t.hasOwnProperty(n)&&t[n]!==this&&t[n].set("checked",!1)}},_renderChecked:function(e){this.$el.checked=!!e},_transformValue:function(e){if(this.$.type==="number"){if(e==="")return null;e=parseInt(e,10),isNaN(e)&&(e=this.$.value)}else if(this.$.type==="date")try{e=e!==""?new Date(e):null}catch(t){this.log("Invalid Date","warn"),e=this.$.value}return e},_bindDomEvents:function(){var e=this;if(t.include(["text","password","date","number"],this.$.type)){if(this.$.type==="date"||this.$.type==="number")this.$.updateOnEvent="change";this.$.updateOnEvent==="input"&&"onpropertychange"in this.$el?this.bindDomEvent("keyup",function(t){e.set("value",e._transformValue(e.$el.value))}):this.bindDomEvent(this.$.updateOnEvent,function(t){e.set("value",e._transformValue(e.$el.value))})}else(this.$.type==="checkbox"||this.$.type==="radio")&&this.bindDomEvent("click",function(t){e.set("checked",e.$el.checked)});this.callBase()},_renderPlaceholder:function(e){if(!this._supportsPlaceholder()){var t=this;this.__blurHandler||(this.__blurHandler=function(e){t.set("focused",!1);if(t.$el.value!="")return;t.$el.value=t.$.placeholder||"",t.addClass("placeholder")},this.bindDomEvent("blur",this.__blurHandler)),this.__focusHandler||(this.__focusHandler=function(){t.set("focused",!0),t.removeClass("placeholder"),t.$el.value=""},this.bindDomEvent("focus",this.__focusHandler)),e&&this.addClass("placeholder")}else this._setAttribute("placeHolder",e)}})}),define("js/ui/SelectionView",["js/ui/ItemsView","js/html/HtmlElement","underscore","js/core/List"],function(e,t,n,r){return e.inherit("js.ui.SelectionView",{$defaultTemplateName:null,defaults:{multiSelect:!1,placeHolderValue:null,selectedViews:r,selectedItems:r,selectedItem:null,selectedIndex:null,needsSelection:!1,items:[],keyPath:null,forceSelectable:!0,allowDeselection:!1},ctor:function(){this.callBase(),this.bind("selectedItems","add",this._onSelectedItemAdd,this),this.bind("selectedItems","remove",this._onSelectedItemRemove,this),this.bind("selectedItems","reset",this._onSelectedItemReset,this),this.bind("items","remove",this._itemRemove,this),this.bind("items","add",this._itemAdd,this)},_onSelectedItemAdd:function(e){if(this.isRendered()){var t,n=this.$repeat.$renderedItems;for(var r=0;r<n.length;r++)t=n[r].item,e.$===t&&!n[r].component.$.selected&&n[r].component.set({selected:!0},{silent:!0})}},_itemRemove:function(e){e.$.item===this.$.selectedItem&&this._checkNeedsSelection()},_itemAdd:function(){this.$.selectedItem||this._checkNeedsSelection()},_onSelectedItemRemove:function(e){if(this.isRendered()){var t,n=this.$repeat.$renderedItems;for(var r=0;r<n.length;r++)t=n[r].item,e.$===t&&n[r].component.$.selected&&n[r].component.set({selected:!1},{silent:!0})}},_onSelectedItemReset:function(){this._renderSelectedItems(this.$.selectedItems)},hasSelection:function(){if(!this.$.selectedItem)return!1;var e,t=this._getItemKey();for(var n=0;n<this.$renderedChildren.length;n++){e=this.$renderedChildren[n].get(t);if(this._areItemsEqual(e,this.$.selectedItem))return!0}return!1}.onChange("selectedItem"),_onItemsRendered:function(){this.callBase(),this._checkNeedsSelection()},_checkNeedsSelection:function(){if(this.$.needsSelection){var e=this._getItemsArray(this.$.items);if(e&&e.length)if(this.$.multiSelect)this.$.selectedItems.length===0&&this.$.selectedItems.add(e[0]);else{for(var t=0;t<e.length;t++)if(this.$.selectedItem===e[t])return;this.set("selectedItem",e[0])}else this.$.multiSelect?this.$.selectedItems.clear():this.set("selectedItem",null)}},_renderChild:function(e){if(e instanceof t){var n=this;this.$.forceSelectable===!0&&e.set({selectable:!0}),e.bind("change:selected",function(t,r){!t.$&&!n.$.allowDeselection&&e.set("selected",!0,{silent:!0}),(n.$.allowDeselection||t.$&&!n.$.allowDeselection)&&n._onChildSelected(t.target)})}this.callBase();var r=e.get(this._getItemKey());if(r)if(this.$.multiSelect){for(var i=0;i<this.$.selectedItems.length;i++)if(this._areItemsEqual(r,this.$.selectedItems.at(i))){e.set({selected:!0},{silent:!0});break}}else this._areItemsEqual(r,this.$.selectedItem)&&e.set({selected:!0},{silent:!0});this.$.needsSelection&&(!this.$.multiSelect&&!this.$.selectedItem?this.set("selectedItem",r):this.$.multiSelect&&this.$.selectedItems.length==0&&this.$.selectedItems.add(r))},_addTemplate:function(e){this.callBase(),e.$.name=="placeHolder"&&(this.$hasPlaceHolder=!0)},_renderPlaceHolderValue:function(e,t){this.$placeHolder&&this.removeChild(this.$placeHolder);if(this.$hasPlaceHolder){var n={};n[this._getItemKey()]=e,n.selected=this.$.selectedItem===e,this.$placeHolder=this.$templates.placeHolder.createInstance(n),this.addChild(this.$placeHolder,{childIndex:0})}},_renderSelectedItem:function(e,t){if(!this.$.multiSelect){var n=this.getComponentForItem(e);this.$hasPlaceHolder&&e===this.$.placeHolderValue&&(n=this.$placeHolder);if(n){n.set({selected:!0},{silent:!0});var r;if(!this.$.multiSelect)for(var i=0;i<this.$renderedChildren.length;i++)r=this.$renderedChildren[i],r!=n&&r.$.selected===!0&&r.set({selected:!1},{silent:!0})}else t!=null&&(n=this.getComponentForItem(t),n&&n.set({selected:!1},{silent:!0}))}},_renderSelectedItems:function(e){if(this.$.multiSelect)if(e&&e.length){var t,n=this.$repeat.$renderedItems,r;for(var i=0;i<n.length;i++){t=n[i].item;for(var s=0;s<e.length;s++){r=this._areItemsEqual(t,e.at(s));if(r)break}n[i].component.set({selected:r},{silent:!0})}}else this.$placeHolder&&this.$.selectedItem==null&&this.$placeHolder.set({selected:!0},{silent:!0})},_renderSelectedIndex:function(e,t){if(!this.$.multiSelect){if(e!==null&&e<this.$renderedChildren.length&&e>-1){var n=this.$renderedChildren[e];n.set({selected:!0},{silent:!0})}if(t!==null&&t<this.$renderedChildren.length&&t>-1){var r=this.$renderedChildren[t];r.set({selected:!1},{silent:!0})}}},_onChildSelected:function(e){var t,n,r=e.$.selected===!0&&this.$.multiSelect===!1,i=!1,s=[],o=[],u,a=null;for(n=0;n<this.$renderedChildren.length;n++){t=this.$renderedChildren[n],r&&t!=e&&t.$.selected===!0&&t.set({selected:!1},{silent:!0});if(t.$.selected===!0){u=n,s.push(t);var f=t.get(this._getItemKey());f!=null&&(o.push(f),a=f)}}i||(this.set("selectedViews",s),this.$.multiSelect?this.$.selectedItems.reset(o):this.set({selectedIndex:u,selectedItem:a}))},_areItemsEqual:function(e,t){return this.$.keyPath?!e||!t?!1:this.get(e,this.$.keyPath)===this.get(t,this.$.keyPath):e===t}})}),define("js/html/Select",["js/ui/SelectionView"],function(e){return e.inherit("js.html.Select",{defaults:{multiSelect:!1,forceSelectable:!1,needsSelection:!0,tagName:"select"},$defaultTemplateName:null,_renderMultiSelect:function(e){this.$el.multiple=e},_bindDomEvents:function(){var e=this;this.bindDomEvent("change",function(t){e._checkOptions()}),this.callBase()},_checkOptions:function(){var e=[],t;for(var n=0;n<this.$renderedChildren.length;n++)t=this.$renderedChildren[n],t.$el.selected?t.set({selected:!0}):e.push(this.$renderedChildren[n]);for(n=0;n<e.length;n++)e[n].set({selected:!1},{silent:!0})}})}),define("js/html/TextArea",["js/html/HtmlElement","js/core/TextElement","js/core/BindingCreator"],function(e,t,n){var r;return e.inherit("js.html.TextArea",{defaults:{updateOnEvent:"change"},$classAttributes:["updateOnEvent"],_renderChild:function(e){if(e instanceof t){var n=this.$bindingCreator.evaluate(this._getTextContentFromDescriptor(e.$descriptor),this,"value");this.set("value",n)}},_renderValue:function(e){if(e===null||e===r)e="";this.$el.value=String(e)},_bindDomEvents:function(){this.callBase();var e=this;this.bindDomEvent(this.$.updateOnEvent,function(t){e.set("value",t.target?t.target.value:e.$el.innerText)})}})}),define("js/ui/FieldClass",["js/ui/View","js/html/Input","js/html/Select","js/html/TextArea","js/core/ErrorProvider"],function(e,t,n,r,i){var s=0;return e.inherit("js.ui.FieldClass",{defaults:{label:"",inputId:null,enabled:!0,error:null,required:!1,requiredClass:"required"},inject:{errorProvider:i},$errorAttribute:"value",ctor:function(){this.callBase(),this.$.inputId||this.set("inputId","field_"+ ++s)},_render$error:function(e,t){e?(this.set("error",e),this.addClass("error")):(this.set("error",null),this.removeClass("error"))},$defaultContentName:"controls",_renderContentChildren:function(){this.callBase();var e=this.findContent("controls").$children,t;for(var n=0;n<e.length;n++){t=this.getFirstChild(e[n]);if(t){t.$.id||t.set("id",this.$.inputId);return}}},_renderRequired:function(e){e?this.addClass(this.$.requiredClass):this.removeClass(this.$.requiredClass)},getFirstChild:function(e){if(e instanceof t||e instanceof n||e instanceof r)return e;if(e&&e.$children){var i=e.getViewChildren();for(var s=0;s<i.length;s++){var o=this.getFirstChild(i[s]);if(o)return o}}return null}})}),define("xaml!js/ui/Field",["js/ui/FieldClass","js/core/Element","js/html/HtmlElement","js/ui/ContentPlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:FieldClass xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="js.ui" componentClass="control-group" tagName="div">\n    <label class="control-label" for="{inputId}">{label}</label>\n    <ui:ContentPlaceHolder class="controls" name="controls" tagName="div"/>\n    <div class="error" visible="{error}">\n        {errorProvider.getErrorMessage(error)}\n    </div>\n</ui:FieldClass>')})}),define("js/ui/field/TextClass",["xaml!js/ui/Field"],function(e){return e.inherit("js.ui.field.TextClass",{defaults:{type:"text",value:"",size:"large",placeholder:""},$defaultContentName:"additionalControls"})}),define("xaml!js/ui/field/Text",["js/ui/field/TextClass","js/core/Element","js/core/Content","js/html/Input","js/ui/ContentPlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<field:TextClass xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="js.ui" xmlns:js="js.core" xmlns:field="js.ui.field">\n    <js:Content name="controls">\n        <input type="{type}" value="{{value}}" class="input-{size}" enabled="{enabled}" placeholder="{placeholder}"/>\n        <ui:ContentPlaceHolder name="additionalControls"/>\n    </js:Content>\n</field:TextClass>')})}),define("xaml!js/ui/field/Password",["xaml!js/ui/field/Text","js/core/Element"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<field:Text type="password" xmlns:field="js.ui.field"/>')})}),define("js/ui/CheckboxClass",["js/ui/View"],function(e){return e.inherit("js.ui.CheckboxClass",{defaults:{componentClass:"checkbox",checked:!1,value:null,label:"",name:null},_renderLabel:function(e,t){e&&this._renderTemplateToPlaceHolder("label","label",{$label:e})}})}),define("xaml!js/ui/Checkbox",["js/ui/CheckboxClass","js/core/Element","js/core/Template","js/html/Input","js/ui/PlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:CheckboxClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" tagName="label">\n    <js:Template name="layout">\n        <input type="checkbox" name="{name}" checked="{{checked}}" value="{{value}}" enabled="{enabled}"/> <ui:PlaceHolder name="label"/>\n    </js:Template>\n    <js:Template name="label">{label}</js:Template>\n</ui:CheckboxClass>')})}),define("xaml!js/ui/Radio",["xaml!js/ui/Checkbox","js/core/Element","js/core/Template","js/html/Input","js/ui/PlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:Checkbox xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" tagName="label" componentClass="radio">\n    <js:Template name="layout">\n        <input type="radio" name="{name}" checked="{{checked}}" value="{{value}}" enabled="{enabled}"/> <ui:PlaceHolder name="label"/>\n    </js:Template>\n</ui:Checkbox>')})}),define("js/ui/RadioGroup",["js/ui/View","xaml!js/ui/Radio"],function(e,t){var n=0;return e.inherit("js.ui.RadioGroup",{ctor:function(){this.callBase(),this.$.name||this.set("name","radiogroup_"+ ++n)},defaults:{value:null,componentClass:"radio-group"},addChild:function(e){if(!(e instanceof t))throw new Error("Children for RadioGroup must be from type Radio");e.set("name",this.$.name),e.bind("change:checked",this._onRadioSelected,this),e.$.checked&&this.set("value",e.$.value),this.callBase()},_commitValue:function(e){var t=this.getViewChildren();for(var n=0;n<t.length;n++){var r=t[n];r.$.value===e&&r.set("checked",!0)}},_onRadioSelected:function(e){e.$===!0&&this.set("value",e.target.$.value)}})}),define("js/ui/Tab",["js/ui/View"],function(e){return e.inherit("js.ui.Tab",{defaults:{title:""}})}),define("js/ui/TabViewClass",["js/ui/View","js/html/HtmlElement","js/ui/Tab","js/core/List"],function(e,t,n,r){return e.inherit("js.ui.TabViewClass",{defaults:{selectedIndex:null,selectedView:null,selectedTab:null,tabClassName:"nav nav-tabs",menuClassName:null,contentClassName:null,tabItems:r},$defaultTemplateName:null,events:["on:selectTab"],initialize:function(){this.bind("tabSelection","change:selectedItem",this._onSelectionChange,this),this.callBase()},_renderChild:function(e){e instanceof n?(this.$.tabItems.add(e),this.$.tabContent.addChild(e)):this.callBase()},removeChild:function(e){e instanceof n?(this.$.tabItems.remove(e),this.$.tabContent.removeChild(e)):this.callBase()},_renderSelectedView:function(e){this.$.tabSelection.set({selectedView:e})},_onSelectionChange:function(e){e.$&&this.trigger("on:selectTab",{tab:e.$})}})}),define("js/ui/TemplatePlaceHolder",["js/ui/View"],function(e){return e.inherit({defaults:{item:null,templateName:null},$classAttributes:["item","templateName"],_renderTemplateName:function(e){if(e){this.$template||(this.$template=this.getTemplate(e));if(!this.$templateChildren){this.$templateChildren=this.$template.createComponents({item:this.$.item},this.$template.$parentScope);var t;for(var n=0;n<this.$templateChildren.length;n++)t=this.$templateChildren[n],t.$classAttributes&&t.$classAttributes.push("item"),this.addChild(t)}}else this.$template=null},_commitChangedAttributes:function(e){this.callBase();if(this.$templateChildren&&e.hasOwnProperty("item"))for(var t=0;t<this.$templateChildren.length;t++)this.$templateChildren[t].set("item",e.item)}})}),define("js/ui/SegmentedView",["js/ui/View","js/html/HtmlElement"],function(e,t){return e.inherit({defaults:{tagName:"div",visibleView:null,visibleIndex:null},ctor:function(){this.$views=[],this.callBase()},addChild:function(e){this.callBase(),e instanceof t&&this.$views.push(e)},_renderChild:function(e){if(this.$.visibleView==e){e.set({visible:!0});var t=this.$children.indexOf(e);this.set("visibleIndex",t),this.callBase()}},_renderVisibleView:function(e,t){t&&t.set({visible:!1}),e&&(e.isRendered()||(e.set({visible:!1}),this._renderChild(e)),e.set({visible:!0}))},_renderVisibleIndex:function(e){e!=null&&e>-1&&e<this.$views.length?this.set({visibleView:this.$views[e]}):this.$.visibleView&&this.$.visibleView.set({visible:!1})}})}),define("xaml!js/ui/TabView",["js/ui/TabViewClass","js/core/Element","js/core/Template","js/html/HtmlElement","js/ui/SelectionView","js/ui/TemplatePlaceHolder","js/ui/SegmentedView","xaml!js/ui/Link"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:TabViewClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" componentClass="tab-view" selectedIndex="null" selectedTab="null">\n    <js:Template name="layout">\n        <div class="tab-menu {menuClassName}">\n            <ui:SelectionView tagName="ul" cid="tabSelection" items="{tabItems}" class="{tabClassName}" needsSelection="true" forceSelectable="true" selectedIndex="{{selectedIndex}}" selectedItem="{{selectedTab}}">\n                <js:Template name="item">\n                    <ui:TemplatePlaceHolder templateName="tab" enabled="{item.enabled}" class="{item.class}" tagName="li"/>\n                </js:Template>\n            </ui:SelectionView>\n        </div>\n        <ui:SegmentedView cid="tabContent" componentClass="tab-content" class="{contentClassName}" visibleView="{selectedTab}"/>\n    </js:Template>\n\n    <js:Template name="tab">\n        <ui:Link label="{item.title}"/>\n    </js:Template>\n</ui:TabViewClass>')})}),define("js/ui/DataGridColumnClass",["js/core/Component"],function(e){var t;return e.inherit("js.ui.DataGridColumnClass",{defaults:{sortPath:null,path:null,sortable:!0,sortDirection:0,name:"column",$dataItem:null,item:"$dataItem.data",title:""},getFormatFnc:function(){return null},createCellRenderer:function(e){return this.$templates.cell.createInstance(e)},createCellContainer:function(e){return this.$templates.cellContainer.createInstance(null,e)},isDefined:function(e){return e!==null&&e!==t},isSorted:function(){return this.$.sortDirection!==0}.onChange("sortDirection"),sortDirectionStatus:function(){return this.$.sortDirection===1?"up":"down"}.onChange("sortDirection"),getSortPath:function(){return this.$.sortPath||this.$.path}})}),define("xaml!js/ui/DataGridColumn",["js/ui/DataGridColumnClass","js/core/Element","js/core/Template","js/html/HtmlElement"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:DataGridColumnClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">\n    <js:Template name="cell">\n        {data}\n    </js:Template>\n    <js:Template name="cellContainer">\n        <div class="cell-container"></div>\n    </js:Template>\n</ui:DataGridColumnClass>')})}),define("js/ui/VirtualItemsView",["js/ui/View","js/core/Bindable","js/core/List","js/data/Collection","underscore"],function(e,t,n,r,i){var s="none",o="multi",u="single",a="vertical",f="horizontal",l,c=e.inherit("js.ui.VirtualItemsView",{defaults:{data:null,scrollTop:0,scrollLeft:0,width:300,height:300,loading:!1,_itemWidth:100,_itemHeight:100,_rows:3,_cols:3,scrollToIndex:0,horizontalGap:0,verticalGap:0,scrollDirection:a,prefetchItemCount:0,fetchPageDelay:500,fetchWithFullData:!1,$dataAdapter:null,selectionMode:"multi",selectedItems:n,hoverItem:null},events:["on:itemClick","on:itemDblClick","on:itemMouseOver","on:itemMouseOut"],ctor:function(){this.$currentSelectionIndex=null,this.$selectionMap={},this.$selectedViews={},this.$activeRenderer={},this.$availableRenderer=[],this.$container=null,this.$isLoading=!1,this.callBase(),this.createBinding("{$dataAdapter.size()}",this._itemsCountChanged,this)},initialize:function(){this.callBase(),this.bind("selectedItems","reset",this._onSelectedItemsReset,this),this.bind("selectedItems","add",this._onSelectedItemsAdd,this),this.bind("selectedItems","remove",this._onSelectedItemsRemove,this)},_onSelectedItemsReset:function(){this._clearSelection()},_onSelectedItemsAdd:function(e){var t=this.getSelectionKeyForItem(e.$.item);t&&(this.$selectionMap[t]=!0,this.trigger("selectionChanged"))},_onSelectedItemsRemove:function(e){var t=this.getSelectionKeyForItem(e.$.item);t&&(delete this.$selectionMap[t],this.trigger("selectionChanged"))},_isWebkitAndTouch:function(){var e=this.$stage.$window;return this.runsInB_rowser()&&e&&e.hasOwnProperty("ontouchend")&&/AppleWebKit/i.test(e.navigator.userAgent)},_initializeRenderer:function(e){var t=e.getAttribute("style")||"";t=t.split(";"),t.push("overflow: auto"),t.push("-webkit-overflow-scrolling: touch;"),e.setAttribute("style",t.join(";"))},_onDomAdded:function(){this.callBase(),this._syncScrollPosition()},_syncScrollPosition:function(){if(!this.isRendered())return;this.$el.scrollTop=this.$.scrollTop,this.$el.scrollLeft=this.$.scrollLeft},_bindDomEvents:function(e){function n(e){t.set({scrollTop:t.$el.scrollTop,scrollLeft:t.$el.scrollLeft})}this.callBase();var t=this;this.bindDomEvent("scroll",n),this.bindDomEvent("mousemove",function(e){t._mouseMove(e)}),this.bindDomEvent("mouseout",function(e){t.$.hoverItem&&t.trigger("on:itemMouseOut",null,t.$.hoverItem),t.set("hoverItem",null)})},_mouseMove:function(e){var t=this.$.$dataAdapter;if(!t)return;var n=this.globalToLocal({x:e.clientX+this.$el.scrollLeft,y:e.clientY+this.$el.scrollTop}),r=this.getIndexFromPoint(n.x,n.y),i=t.getItemAt(r);i&&(i=i.$.data);if(i===this.$.hoverItem)return;this.$.hoverItem&&this.trigger("on:itemMouseOut",null,this.$.hoverItem),this.set("hoverItem",i),i&&this.trigger("on:itemMouseOver",null,this.$.hoverItem)},render:function(){var e=this.callBase();return this._updateVisibleItems(),e},_initializationComplete:function(){this.callBase(),this.$container=this._getScrollContainer(),this._commitData(this.$.data)},_commitData:function(e){if(!this.$initialized)return;this.set("$dataAdapter",c.createDataAdapter(e,this)),this.$lastEndIndex=null,this.$lastStartIndex=null,this.$currentSelectionIndex=-1,this._releaseActiveRenderer(),this.set("loading",!0),this._scrollToIndex(0),this._updateVisibleItems()},_renderLoading:function(e){e?this.addClass("loading"):this.removeClass("loading")},_commitChangedAttributes:function(e,t){!i.isUndefined(e.scrollToIndex)&&t.initiator!==this&&this._scrollToIndex(e.scrollToIndex),this._hasSome(e,["_itemWidth","_itemHeight","verticalGap","horizontalGap","_cols","_rows"])&&(this._positionActiveRenderers(),this._updateSize(),this._scrollToIndex(this.$.scrollToIndex)),this._hasSome(e,["scrollTop","scrollLeft","height","width"])&&this._updateVisibleItems(),this.callBase()},_updateVisibleItems:function(e){if(this.isRendered()){var t=this.$.$dataAdapter;if(!t)return;var n=this.$.scrollLeft,r=this.$.scrollTop,i=this.getIndexFromPoint(n,r),s=i-this.$.prefetchItemCount,o=this.getIndexFromPoint(n+this.$.width,r+this.$.height),u=o+this.$.prefetchItemCount,a,f,l;i=Math.max(0,i),(i>this.$.scrollToIndex||i+this.$._cols<this.$.scrollToIndex)&&this.set("scrollToIndex",i,{initiator:this}),s=Math.max(0,s);var c=parseFloat(t.size());isNaN(c)||(c<=0&&this._releaseActiveRenderer(),u=Math.min(c-1,u),this.set("loading",!1));if(e||s!==this.$lastStartIndex||u!==this.$lastEndIndex){this.$lastStartIndex=s,this.$lastEndIndex=u,this._releaseActiveRenderer(s,u);var h=[];for(f=s;f<=u;f++)a=this.$activeRenderer[f],a?e&&a.set("$dataItem",t.getItemAt(f)):(a=this._reserveRenderer(),this.$activeRenderer[f]=a,a.set({width:this.$._itemWidth,height:this.$._itemHeight,$dataItem:t.getItemAt(f),$index:f,$viewIndex:f-s}),this._addRenderer(a,a.$.$viewIndex),h.push(a));for(f=0;f<h.length;f++)this._positionRenderer(h[f],h);this._onVisibleItemsUpdated(s,u)}}},_releaseActiveRenderer:function(e,t){i.isUndefined(e)&&(e=Number.MAX_VALUE),i.isUndefined(t)&&(t=-1);var n;for(var r in this.$activeRenderer)this.$activeRenderer.hasOwnProperty(r)&&(r<e||r>t)&&(n=this.$activeRenderer[r],n&&(n.set({$index:null,$dataItem:null}),n.remove(),this.$availableRenderer.push(n)),delete this.$activeRenderer[r])},_onVisibleItemsUpdated:function(e,t){},_addRenderer:function(e,t){this.$container.addChild(e,{childIndex:t})},_positionRenderer:function(e,t){var n=this.getPointFromIndex(e.$.$index);e.set({left:n.x,top:n.y})},_scrollToIndex:function(e){this.$scrollToIndexPos=this.getPointFromIndex(e);var t=this.$scrollToIndexPos.y;this.isRendered()&&(this.$el.scrollTop=t),this.set("scrollTop",t)},_reserveRenderer:function(){if(this.$availableRenderer.length)return this.$availableRenderer.shift();var e=this._createRenderer();return e.bind("on:dblclick",this._onRendererDblClick,this),e.bind("on:pointer",this._onRendererClick,this),e},_onRendererClick:function(e,t){this.trigger("on:itemClick",e,t),e.isDefaultPrevented||this._selectItem(t.$.$index,e.domEvent.shiftKey,e.domEvent.metaKey)},_onRendererDblClick:function(e,t){this.trigger("on:itemDblClick",e,t)},_createRenderer:function(e){return this.$templates.renderer.createComponents(e,this)[0]},_positionActiveRenderers:function(){for(var e in this.$activeRenderer)this.$activeRenderer.hasOwnProperty(e)&&(this.$activeRenderer[e].set({width:this.$._itemWidth,height:this.$._itemHeight}),this._positionRenderer(this.$activeRenderer[e],[]))},_updateSize:function(){if(this.$.$dataAdapter){var e=this.getSizeForItemsCount(this.$.$dataAdapter.size());e&&(this._getScrollContainer().set(e),this._syncScrollPosition())}},_itemsCountChanged:function(){this._updateSize(),this._updateVisibleItems()},getSizeForItemsCount:function(e){if(isNaN(e))return null;var t={};if(this.$.scrollDirection===a){var n=Math.ceil(e/this.$._cols);t.height=n*(this.$._itemHeight+this.$.verticalGap)}else if(this.$.scrollDirection===f){var r=Math.ceil(e/this.$._rows);t.width=r*(this.$._itemWidth+this.$.horizontalGap)}return t},getIndexFromPoint:function(e,t,n,r){var i,s;e+=this.$.horizontalGap*.5,t+=this.$.verticalGap*.5,i=this.$._cols===1?0:Math.floor(e/(this.$._itemWidth+this.$.horizontalGap)),s=this.$._rows===1?0:Math.floor(t/(this.$._itemHeight+this.$.verticalGap));if(this.$.scrollDirection===a)return s*this.$._cols+i;if(this.$.scrollDirection===f)return i*this.$._rows+s},getPointFromIndex:function(e){var t,n;return this.$.scrollDirection===a?(t=Math.floor(e/this.$._cols),n=e%this.$._cols):this.$.scrollDirection===f&&(n=Math.floor(e/this.$._rows),t=e%this.$._rows),{x:n*(this.$._itemWidth+this.$.horizontalGap),y:t*(this.$._itemHeight+this.$.verticalGap)}},_getScrollContainer:function(){var e=this.get("$scrollContainer");if(!e)throw"implement _getScrollContainer or set cid='$scrollContainer'";return e},_renderSelectionMode:function(e){e!==s&&this.$el.setAttribute("tabindex","1")},_onKeyDown:function(e){var t=e.domEvent.keyCode;if(t===38||t===40||t===37||t===39){var n=this.$currentSelectionIndex!==null?this.$currentSelectionIndex:-1,r;this.$.scrollDirection===a?r=this.$._cols:r=this.$._rows;switch(t){case 38:n-=this.$._cols;break;case 40:n+=this.$._cols;break;case 37:n--;break;case 39:n++;break;default:void 0}n<0&&(n=0),this.$.$dataAdapter&&n>=this.$.$dataAdapter.size()&&(n=this.$.$dataAdapter.size()-1),this._selectItem(n,e.domEvent.shiftKey,!1),e.preventDefault(),e.stopPropagation()}},_clearSelection:function(){for(var e in this.$selectionMap)this.$selectionMap.hasOwnProperty(e)&&delete this.$selectionMap[e];this.$.selectedItems.isEmpty()||this.$.selectedItems.clear({silent:!0}),this.$currentSelectionIndex=-1,this.trigger("selectionChanged")},_selectItem:function(e,t,n){if(this.$.selectionMode===s)return;this.$.selectionMode===u&&(t=!1,n=!1),n||this._clearSelection();if(!t||n)this.$lastSelectionIndex=e;var r,i;this.$lastSelectionIndex!==l&&e<this.$lastSelectionIndex?(r=e,i=this.$lastSelectionIndex):(r=this.$lastSelectionIndex,i=e),this.$currentSelectionIndex=e;var o,f;for(var c=r;c<=i;c++)o=this.$.$dataAdapter.getItemAt(c),f=this.getSelectionKeyForItem(o.$.data),f?n&&this.$selectionMap[f]?(delete this.$selectionMap[f],this.$.selectedItems.remove(o.$.data)):(this.$selectionMap[f]=!0,this.$.selectedItems.add(o.$.data)):this.log("no id defined for data item","warn");var h=this.getPointFromIndex(e);if(this.$.scrollDirection===a){var p=h.y,d=p-this.$el.scrollTop,v=d+this.$._itemHeight+this.$.verticalGap-this.$.height;d-=this.$.verticalGap,v>0&&(this.$el.scrollTop+=v),d<0&&(this.$el.scrollTop+=d)}else{var m=h.x,g=m-this.$el.scrollLeft,y=g+this.$._itemWidth+this.$.horizontalGap-this.$.width;g-=this.$.horizontalGap,y>0&&(this.$el.scrollLeft+=y),g<0&&(this.$el.scrollLeft+=g)}t||(this.$lastSelectionIndex=e)},isItemSelected:function(e){var t=this.getSelectionKeyForItem(e);return t?this.$selectionMap[t]!==l:!1}.on("selectionChanged"),getSelectionKeyForItem:function(e){if(!e)return!1;var t;return e.identifier?e.identifier():i.isString(e)?e:(t=this.get(e,"id"),t?t:!1)},sort:function(e){var t=this.$.$dataAdapter;t&&t.sort(e)},query:function(e){var t=this.$.$dataAdapter;t&&t.query(e)}},{createDataAdapter:function(e,t){return e instanceof r?new c.VirtualCollectionDataAdapter(e,t):e instanceof n||e instanceof Array?new c.VirtualDataAdapter(e,t):null}});c.VirtualDataAdapter=t.inherit("js.ui.VirtualItemsView.VirtualDataAdapter",{ctor:function(e,t){if(!(!e||e instanceof Array||e instanceof n))throw new Error("data needs to be either an Array or a List");this.$data=e,this.$virtualItemsView=t;if(e instanceof n&&!(e instanceof r)){var i=function(n){var r=!0;n.type=="add"&&n.$.index>=e.length-1&&(r=!1),this.trigger("sizeChanged"),n.type=="reset"&&t._scrollToIndex(0),t._updateVisibleItems(r)};e.bind("add",i,this),e.bind("remove",i,this),e.bind("reset",i,this),e.bind("sort",i,this)}this.callBase(null)},getItemAt:function(e){var t=this.$data,r=null;return t instanceof Array?r=t[e]:t instanceof n&&(r=t.$items[e]),r&&(r=new c.DataItem({index:e,data:r})),r},size:function(){return this.$data?this.$data.length:0}.on("sizeChanged","change:$data")}),c.VirtualCollectionDataAdapter=c.VirtualDataAdapter.inherit("js.ui.VirtualItemsView.VirtualCollectionDataAdapter",{ctor:function(e){if(!(!e||e instanceof r))throw"data needs to be a Collection";this.$pages={},this.$cache={},this.$pageSize=e.$.pageSize,this.callBase(),e.bind("reset",this._onReset,this),this.$collectionSizeUnknown=isNaN(this.size)},_onReset:function(){this.$pages={},this.$cache={},this.$collectionSizeUnknown=!0,this.$virtualItemsView._updateVisibleItems(!0)},getItemAt:function(e){var t=this,n=Math.floor(e/this.$pageSize),r=!1,i=this.$cache[e];this.$pages.hasOwnProperty(n)||(this.$pages[n]={},r=!0),i||(i=new c.DataItem({index:e,data:null,$status:p}),this.$cache[e]=i);var s=this.$pages[n];return s===!0?(i.set("$status",d),i.set("data",this.$data.at(e))):s&&e>=0&&(i.set("$status",p),s[e]=i,r&&function(e){setTimeout(function(){var n=e*t.$pageSize,r=(e+1)*t.$pageSize-1,i=t.$virtualItemsView;i.$lastStartIndex<=r&&i.$lastEndIndex>=n?t.$data.fetchPage(e,{fullData:t.$virtualItemsView.$.fetchWithFullData},function(n){if(n)delete t.$pages[e];else{var r=t.$pages[e];for(var i in r)r.hasOwnProperty(i)&&(r[i].set({data:t.$data.at(i),$status:d}),r[i]=l);t.$pages[e]=!0,t.$collectionSizeUnknown&&(t.$collectionSizeUnknown=!1,t.$virtualItemsView._updateVisibleItems())}}):t.$pages[e]=l},t.$virtualItemsView.$.fetchPageDelay)}(n)),i},sort:function(e){var t=this.$data.sort(e);this.$sortCollection=t,this.$virtualItemsView.set("data",t)},query:function(e){var t=this.$data.query(e);this.$queryCollection=t,this.$virtualItemsView.set("data",t)},size:function(){return this.$data?this.$data.$.$itemsCount:NaN}.on(["$data","change:$itemsCount"])});var h="empty",p="loading",d="loaded";return c.DataItem=t.inherit("js.ui.VirtualItemsView.DataItem",{defaults:{$index:null,status:h,selected:!1,data:null}}),c.SCROLL_DIRECTION_VERTICAL=a,c.SCROLL_DIRECTION_HORIZONTAL=f,c}),define("js/ui/DataGridItemsViewClass",["js/ui/VirtualItemsView","xaml!js/ui/DataGridColumn","js/core/List","underscore","js/core/Binding"],function(e,t,n,r,i){var s="odd",o="even";return e.inherit("js.ui.DataGridItemsViewClass",{defaults:{columns:n,_cols:1,_itemWidth:null,data:null,prefetchItemCount:3},_createRenderer:function(e){return e&&delete e.width,this.callBase(e)},_addRenderer:function(e,t){this.$.$tbody.addChild(e,{childIndex:t});var n,r,s,o,u,a,f,l=e.getViewChildren();for(var c=0;c<l.length;c++)n=l[c],r=this.$.columns.at(c),n.$children.length||(o=r.createCellRenderer({data:null},e),f=["$dataItem","data"],u=r.createCellContainer(o),r.$.path&&r.$.path!==""&&f.push(r.$.path),s=new i({scope:e,path:f.join("."),target:o,targetKey:"data",transform:r.getFormatFnc()}),a=s.getValue(),o.set({data:a}),u&&(u.addChild(o),o=u),n.addChild(o))},removeChild:function(e){this.$.$columns.remove(e)},_onVisibleItemsUpdated:function(e,t){this.$.$table.set("style",["width: 100%; position: absolute;","top:"+e*this.$._itemHeight+"px"].join(";"))},_positionRenderer:function(e,t,n){},_commitData:function(e){if(!this.$el)return;this.callBase()},render:function(){var e=this.callBase();return this._commitData(this.$.data),e},indexStatus:function(e){return e%2?o:s},focus:function(){this.isRendered()&&this.$.$table.$el.focus()}})}),define("js/ui/DataGridClass",["js/ui/View","xaml!js/ui/DataGridColumn","js/core/List","underscore","js/ui/DataGridItemsViewClass","js/data/Query","js/data/Collection"],function(e,t,n,r,i,s,o){return e.inherit("js.ui.DataGridClass",{defaults:{$columns:n,rowHeight:45,width:null,prefetchItemCount:0,selectedItems:n,selectionMode:"multi",data:null,query:null},events:["on:rowClick","on:rowDblClick"],ctor:function(){this.callBase(),this.bind("$itemsView","on:itemClick",this._onRowClick,this),this.bind("$itemsView","on:itemDblClick",this._onRowDblClick,this)},_onRowClick:function(e){this.trigger("on:rowClick",e)},_onRowDblClick:function(e){this.trigger("on:rowDblClick",e)},_initializationComplete:function(){this.$classAttributes=this.$classAttributes.concat(this.$.$itemsView.$classAttributes),this.callBase()},_handleColumnClick:function(e){if(this.$.data){var t=e.target.$.column,n=t.getSortPath();if(n){var r=t.$.sortDirection===0?1:t.$.sortDirection;r=r===1?-1:1,this.sort(n,r)}}},sort:function(e,t){var n=new s;n.sort((t===1?"+":"-")+e),this.$sortParamter=this.$sortParameter||{};var r;this.$.$columns.each(function(n){n.getSortPath()===e?(n.set("sortDirection",t),r=n):n.set("sortDirection",0)}),r&&(this.$sortParamter[e]=r.$.sortDirection),this.set("sortQuery",n)},_data:function(){var e=this.$.data;return e instanceof o&&(this.$.query&&(e=e.query(this.$.query)),this.$.sortQuery&&(e=e.sort(this.$.sortQuery))),e}.onChange("data","sortQuery","query"),addChild:function(e){this.callBase(),e instanceof t&&this.$.$columns.add(e)},focus:function(){this.$.$itemsView.focus()},removeChild:function(e){this.$.$columns.remove(e)}})}),define("js/ui/DataGridRow",["js/ui/ItemsView"],function(e){return e.inherit("js.ui.DataGridRow",{defaults:{tagName:"tr",itemKey:"column",item:"{$dataItem.data}"},_renderWidth:function(){}})}),define("xaml!js/ui/DataGridItemsView",["js/ui/DataGridItemsViewClass","js/core/Element","js/core/Template","js/ui/DataGridRow","js/html/HtmlElement","js/ui/ItemsView"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:DataGridItemsViewClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" componentClass="data-grid-body">\n    <js:Template name="renderer">\n        <ui:DataGridRow items="{columns}" class="{indexStatus($index)} {$dataItem.status}" selected="{isItemSelected($dataItem.data)}">\n            <js:Template name="item">\n                <td width="{column.width}"></td>\n            </js:Template>\n        </ui:DataGridRow>\n    </js:Template>\n    <div cid="$scrollContainer" position="relative">\n        <table cid="$table" componentClass="table" onkeydown="_onKeyDown" tabindex="1">\n            <thead display="none">\n                <ui:ItemsView items="{columns}" tagName="tr" itemKey="column">\n                    <js:Template name="item">\n                        <td width="{column.width}">{column.title}</td>\n                    </js:Template>\n                </ui:ItemsView>\n            </thead>\n            <tbody cid="$tbody">\n            </tbody>\n        </table>\n    </div>\n</ui:DataGridItemsViewClass>')})}),define("xaml!js/ui/DataGrid",["js/ui/DataGridClass","js/core/Element","js/html/HtmlElement","js/ui/ItemsView","js/core/Template","xaml!js/ui/DataGridItemsView"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:DataGridClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" class="data-grid">\n    <table class="data-grid-head" margin-bottom="0">\n        <ui:ItemsView items="{$columns}" itemKey="column" tagName="tr">\n            <js:Template name="item">\n                <th width="{column.width}" onclick="_handleColumnClick">\n                    <i class="pull-right icon-chevron-{column.sortDirectionStatus()}" visible="{column.isSorted()}"></i>\n                    <div>{column.title}</div>\n                </th>\n            </js:Template>\n        </ui:ItemsView>\n    </table>\n    <ui:DataGridItemsView cid="$itemsView" columns="{$columns}" data="{_data()}" _itemHeight="{rowHeight}" width="{width}" prefetchItemCount="{prefetchItemCount}" heightUpdatePolicy="in" class="data-grid-body" selectedItems="{{selectedItems}}" selectionMode="{{selectionMode}}"/>\n</ui:DataGridClass>')})}),define("js/ui/TileListClass",["js/ui/VirtualItemsView"],function(e){var t="auto";return e.inherit("js.ui.TileListClass",{defaults:{heightUpdatePolicy:"both",widthUpdatePolicy:"both",width:null,scrollContainerClass:"",minItemSize:100,maxItemSize:150,itemWidth:t,itemHeight:t,rows:t,cols:t,aspectRatio:1,horizontalGap:10,verticalGap:10},_commitChangedAttributes:function(n){if(this._hasSome(n,["itemWidth","itemHeight","aspectRation","width","height","verticalGap","horizontalGap"])){var r=this.$.cols,i=this.$.rows,s=this.$.width,o=this.$.height,u=this.$.horizontalGap,a=this.$.verticalGap,f=this.$.itemWidth,l=this.$.itemHeight,c=this.$.aspectRatio,h=!0;if(this.$.scrollDirection===e.SCROLL_DIRECTION_VERTICAL){if(r===t)if(f===t){var p=(s-u)/(this.$.minItemSize+u),d=(s-u)/(this.$.maxItemSize+u);r=Math.round((p+d)/2)}else r=Math.floor((s-u)/(f+u));f===t&&(f=Math.floor((s-(r-1)*u)/r)),l===t&&(l=f*c)}else if(this.$.scrollDirection===e.SCROLL_DIRECTION_HORIZONTAL){if(i===t)if(l===t){var v=(o-a)/(this.$.minItemSize+a),m=(o-a)/(this.$.maxItemSize+a);i=Math.round((v+m)/2)}else i=Math.floor((o-u)/(l+a));l===t&&(l=Math.floor((o-(i-1)*a)/i)),f===t&&(f=l*c)}else h=!1;h&&this.set({_itemHeight:l,_itemWidth:f,_cols:r,_rows:i})}this.callBase()},_createRenderer:function(e){e=e||{},e.$dataItem=null;var t,n=this._createRenderContainer(e,this),r=this.$templates.renderer.createComponents({$dataItem:null,item:"{$dataItem.data}"});if(n){var i;for(var s=0;s<r.length;s++)i=r[s],i.$classAttributes=i.$classAttributes||[],i.$classAttributes.push("item"),n.addChild(i);n.bind("change",function(e){var t=e.$,n;for(var i=0;i<r.length;i++)n=r[i],n.set({$dataItem:t.$dataItem||n.$.$dataItem})}),t=n}else t=r[0];return t&&t.set("position","absolute"),t},_createRenderContainer:function(e,t){var n=this.$templates.rendererContainer;if(n){var r=n.createComponents(e,t)[0];return r.$classAttributes.push("item"),r}return null}})}),define("xaml!js/ui/TileList",["js/ui/TileListClass","js/core/Element","js/core/Template","js/html/HtmlElement"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:TileListClass xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="js.ui" xmlns:js="js.core" componentClass="tile-list" onkeydown="_onKeyDown">\n    <js:Template name="renderer">\n        {item}\n    </js:Template>\n    <js:Template name="rendererContainer">\n        <li selected="{isItemSelected($dataItem.data)}" class="{$dataItem.$status}"></li>\n    </js:Template>\n    <ul cid="$scrollContainer" class="scroll-container {scrollContainerClass}" position="relative" margin="0px">\n    </ul>\n</ui:TileListClass>')})}),define("sprd/view/ImageClass",["js/ui/View","underscore","sprd/data/ImageService"],function(e,t,n){return e.inherit({defaults:{componentClass:"sprd-image",loaded:!1,loadingError:!1,width:null,height:null,src:null,title:null},_onLoad:function(){this.set("loaded",!0)},_onError:function(){this.set({loadingError:!0,loaded:!0})},extendUrlWithSizes:function(e){return this.$.width&&(e+=",width="+n.normalizeImageSize(this.$.width)),this.$.height&&(e+=",height="+n.normalizeImageSize(this.$.height)),e},imageUrl:function(){return this.$.src}.onChange("src"),_renderLoaded:function(e){e?this.removeClass("loading"):this.addClass("loading")},_renderLoadingError:function(e){e?this.addClass("loading-error"):this.removeClass("loading-error")},alt:function(){return this.$.title}})}),define("xaml!sprd/view/Image",["sprd/view/ImageClass","js/core/Element","js/html/HtmlElement"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<view:ImageClass xmlns="http://www.w3.org/1999/xhtml" display="inline-block" xmlns:view="sprd.view">\n    <img cid="$img" src="{imageUrl()}" width="{width}" height="{height}" alt="{alt()}" maxWidth="{width}" maxHeight="{height}" onload="_onLoad" onerror="_onError"/>\n</view:ImageClass>')})}),define("sprd/view/ProductImage",["xaml!sprd/view/Image","sprd/data/ImageService"],function(e,t){var n="product",r="composition",i=/\/views\/(\d+)/,s=e.inherit("sprd.view.ProductImage",{defaults:{view:null,product:null,appearance:null,type:n},inject:{imageService:t},_commitChangedAttributes:function(e){this.callBase(),(e.hasOwnProperty("product")||e.hasOwnProperty("type")||e.hasOwnProperty("appearance")||e.hasOwnProperty("view"))&&this.set("loaded",!1)},imageUrl:function(){var e=null,t=this.$.imageService;if(this.$.product){var n=this.$.product;this.$.type!=r?e=t.$.endPoint+"/products/"+n.$.id:e=t.$.endPoint+"/compositions/"+n.$.id;var s=this.$.view?this.$.view.$.id:n.getDefaultViewId(),o=n.$.resources;if(!s&&o instanceof Array)for(var u=0;u<o.length;u++){s=i.exec(o[u].href);if(s){s=s[1];break}}return e+="/views/"+s,e=this.extendUrlWithSizes(e),this.$.appearance&&(e+=",appearanceId="+this.$.appearance.$.id),e}return e}.onChange("product","width","height","type","view","appearance")});return s.TYPE_COMPOSITION=r,s.TYPE_PRODUCT=n,s}),define("sprd/view/ArticleImage",["sprd/view/ProductImage"],function(e){return e.inherit("sprd.view.ArticleImage",{_commitChangedAttributes:function(e){this.callBase(),e.hasOwnProperty("article")&&this.set("loaded",!1)},imageUrl:function(){var t;if(this.$.article&&this.$.article.$.resources&&this.$.article.$.resources.length){t=this.$.article.$.resources[0].href;var n=this.$.article.$.id;return n=Math.floor(parseInt(n.substr(n.length-2))/5),t=t.replace(/:\/\/image/,"://image"+n),this.$.type===e.TYPE_COMPOSITION&&(t=t.replace("products","compositions")),t=this.extendUrlWithSizes(t),t}return this.callBase()}.onChange("article").on(["article","change:resources"]),alt:function(){return this.get("article.name")}})}),define("js/ui/SelectClass",["js/ui/View","js/data/Collection","js/core/List"],function(e,t,n){var r,i=[];return e.inherit("js.ui.SelectClass",{defaults:{componentClass:"select",open:!1,selectedItem:null,searchTerm:"",placeHolder:"Select Something",queryCreator:null,itemHeight:30,dropDownHeight:200},ctor:function(){this.callBase(),this.bind("tileList.selectedItems","add",this._onSelectedItemsChange,this),this.bind("tileList.selectedItems","remove",this._onSelectedItemsChange,this),this.bind("tileList.selectedItems","reset",this._onSelectedItemsChange,this),this.bind("change:searchTerm",this._onSearchTermChange,this),i.push(this)},_initializationComplete:function(){this.$.tileList.addChild(this.getTemplate("renderer")),this.callBase()},_bindDomEvents:function(e){this.callBase();var t=this;this.dom(this.$stage.$document).bindDomEvent("click",function(e){t.set({open:!1})})},_onKeyDown:function(e){(e.domEvent.keyCode===40||e.domEvent.keyCode===38)&&this.$.tileList.$.data.size()>0&&this.$.tileList._onKeyDown(e),e.domEvent.keyCode===13&&(this._onEnter(e),e.target.$el.blur())},_onContainerSelect:function(e){e.stopPropagation()},_onEnter:function(e){e.domEvent.keyCode===13&&(this._select(),e.stopPropagation())},_onListClick:function(e){this._select(),e.stopPropagation()},_select:function(){this.$.tileList.$.selectedItems.size()>0?(this.set({selectedItem:this.$.tileList.$.selectedItems.at(0),open:!1}),this.$.selector.$el.focus()):this.set("selectedItem",null)},_onSelectedItemsChange:function(e){},_clearSelection:function(e){this.set("selectedItem",null),e.stopPropagation()},_renderSelectedItem:function(e){e?this._renderTemplateToPlaceHolder("selectedItem","selectedItem",{item:e}):this._renderTemplateToPlaceHolder("emptySelection","emptySelection",{})},_onSearchTermChange:function(e){this.$searchTimeout&&clearTimeout(this.$searchTimeout);var t=this;this.$searchTimeout=setTimeout(function(){t._search()},200)},_search:function(){this.$.searchTerm&&this.$.searchTerm.length>1?this.$.data instanceof t?this.queryList(this.$.searchTerm):this.$.data instanceof n&&this.filterList(this.$.searchTerm):this.$realData&&this.set("data",this.$realData),clearTimeout(this.$searchTimeout),this.$searchTimeout=r},queryList:function(e){this.$realData||(this.$realData=this.$.data),this.set({scrollTop:0,data:this.$.data.query(this.createQuery(e))})},createQuery:function(e){return this.$.queryCreator?this.$.queryCreator(e):{}},filterList:function(e){},_handleSelect:function(e){for(var t=0;t<i.length;t++)i[t]!=this&&i[t].set({open:!1});this.set("open",!this.$.open),e.stopPropagation()},_handleKey:function(e){!!this.$.open||e.domEvent.keyCode!==40&&e.domEvent.keyCode!==38?e.domEvent.keyCode===13&&(e.stopPropagation(),e.preventDefault()):(this.set("open",!0),e.stopPropagation())},_renderOpen:function(e){e?(this.addClass("open"),this.$.inputField.$el.focus(),this.$.inputField.$el.select(),this.$.tileList._updateVisibleItems(!0)):this.removeClass("open")}})}),define("xaml!js/ui/Select",["js/ui/SelectClass","js/core/Element","js/html/A","js/html/HtmlElement","js/ui/PlaceHolder","js/html/Input","xaml!js/ui/TileList","js/core/Template"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:SelectClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui">\n    <a cid="selector" onclick="_handleSelect" onkeydown="_handleKey" class="select-choice">\n        <span visible="{selectedItem}" class="selected-item-container">\n            <ui:PlaceHolder name="selectedItem"/>\n        </span>\n        <span visible="{not(selectedItem)}">\n            <ui:PlaceHolder name="emptySelection"/>\n        </span>\n        <abbr visible="{selectedItem}" onclick="_clearSelection"></abbr>\n        <div class="select-icon">\n            <b></b>\n        </div>\n    </a>\n    <div class="select-drop" onclick="_onContainerSelect">\n        <div class="select-search">\n            <input type="text" cid="inputField" value="{{searchTerm}}" onkeydown="_onKeyDown"/>\n        </div>\n        <ui:TileList cid="tileList" onclick="_onListClick" onkeyup="_onEnter" class="select-results" scrollContainerClass="nav nav-pills nav-stacked" cols="1" data="{data}" heightUpdatePolicy="out" widthUpdatePolicy="out" height="{dropDownHeight}" itemHeight="{itemHeight}" itemWidth="null" selectionMode="single">\n\n        </ui:TileList>\n    </div>\n    <js:Template name="selectedItem">\n        <span>\n            {item.name}\n        </span>\n    </js:Template>\n    <js:Template name="renderer">\n        <span>\n            {item}\n        </span>\n    </js:Template>\n    <js:Template name="emptySelection">\n        <span>\n            {placeHolder}\n        </span>\n    </js:Template>\n</ui:SelectClass>')})}),define("js/ui/DialogClass",["js/core/Window"],function(e){return e.inherit("js.ui.DialogClass",{$defaultContentName:"body",defaults:{title:"",closable:!0,size:"normal",tabindex:-1,componentClass:"dialog {size}"},$keyHandlers:{27:"closeDialog",13:"confirmDialog"},showModal:function(){if(!this._keyDownHandler){var e=this;this._keyDownHandler=function(t){if(t.shiftKey||t.metaKey||t.ctrlKey||t.altKey)return;if(t.target!==e.$el)return;var n=e.$keyHandlers[t.keyCode];if(n&&e[n])return e[n].call(e,t),t.stopPropagation(),!1}}this.callBase(),this.isRendered()&&this.bindDomEvent("keydown",this._keyDownHandler)},close:function(){this._keyDownHandler&&this.isRendered()&&this.unbindDomEvent("keydown",this._keyDownHandler),this.callBase()},closeDialog:function(e){this.close()},confirmDialog:function(e){this.close(!0)}})}),define("xaml!js/ui/Dialog",["js/ui/DialogClass","js/core/Element","js/html/HtmlElement","js/ui/ContentPlaceHolder"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:DialogClass xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="js.ui">\n\n    <div class="modal-header">\n        <button type="button" class="close" onclick="closeDialog" visible="{closable}">×</button>\n        <h3>{title}</h3>\n    </div>\n\n    <ui:ContentPlaceHolder name="body" class="modal-body"/>\n\n    <ui:ContentPlaceHolder name="footer" class="modal-footer"/>\n\n</ui:DialogClass>')})}),define("xaml!example/window/CustomDialog",["xaml!js/ui/Dialog","js/core/Element","js/core/Content","js/html/Input","js/html/HtmlElement","js/ui/Button"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<ui:Dialog xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" title="My Dialog">\n    <js:Content name="body">\n        <input type="text" cid="nameInput" value="Guest"/>\n        <p>\n            Hello {nameInput.value}!\n        </p>\n    </js:Content>\n    <js:Content name="footer">\n        <ui:Button onclick="closeDialog" label="close"/>\n        <ui:Button onclick="confirmDialog" label="Save" type="primary"/>\n    </js:Content>\n</ui:Dialog>')})}),define("xaml!app/module/Ui",["app/module/UiClass","js/core/Element","js/core/Injection","sprd/data/ImageService","xaml!sprd/data/SprdApiDataSource","js/core/Head","js/core/Content","js/html/HtmlElement","js/ui/Button","app/view/Code","xaml!js/ui/MenuButton","js/html/A","xaml!js/ui/SplitButton","xaml!js/ui/field/Text","xaml!js/ui/field/Password","xaml!js/ui/Checkbox","js/ui/RadioGroup","xaml!js/ui/Radio","xaml!js/ui/TabView","js/ui/Tab","xaml!js/ui/DataGrid","xaml!js/ui/DataGridColumn","js/core/Template","xaml!js/ui/TileList","sprd/view/ArticleImage","xaml!js/ui/Select","xaml!example/window/CustomDialog"],function(e,t){return e.inherit({_$descriptor:t.xmlStringToDom('<module:UiClass xmlns="http://www.w3.org/1999/xhtml" xmlns:js="js.core" xmlns:ui="js.ui" xmlns:view="app.view" xmlns:sprd="sprd.data" xmlns:module="app.module" xmlns:sprdView="sprd.view" xmlns:field="js.ui.field" xmlns:example="example.window">\n\n    <js:Injection cid="injection">\n        <sprd:ImageService endPoint="//image.spreadshirt.com/image-server/v1"/>\n    </js:Injection>\n    <sprd:SprdApiDataSource cid="api" gateway="api/v1" endPoint="http://api.spreadshirt.net/api/v1"/>\n    <js:Head title="UI Components - rAppid.js"/>\n    <js:Content name="main">\n\n        <header class="jumbotron subhead" id="overview">\n            <h1>UI Components</h1>\n            <p class="lead">\n                rAppid:js encapsulates the most common UI components based on the popular\n                bootstrap framework.\n            </p>\n        </header>\n\n        <section>\n            <div class="page-header">\n                <h1>\n                    Buttons\n                </h1>\n            </div>\n\n            <h2>Simple Buttons</h2>\n            <div class="row">\n                <div class="span4">\n                    <h3>Overview and examples</h3>\n                    <div class="btn-toolbar">\n                        <div class="btn-group">\n                            <ui:Button label="Action"/>\n                        </div>\n\n                        <div class="btn-group">\n                            <ui:Button label="Danger" type="danger"/>\n                        </div>\n                        <div class="btn-group">\n                            <ui:Button label="Success" type="success"/>\n                        </div>\n                        <div class="btn-group">\n                            <ui:Button label="Info" type="info" iconClass="icon-white icon-info-sign"/>\n                        </div>\n                    </div>\n                </div>\n                <div class="span8">\n                    <h3>Example markup</h3>\n                    <view:Code data-title="App.xml">\n                        <![CDATA[\n                            <ui:Button label="Info" iconClass="icon-white icon-info" type="info" />\n                        ]]>\n                    </view:Code>\n                </div>\n            </div>\n\n            <br/>\n            <h2>Menu Buttons</h2>\n            <div class="row">\n                <div class="span4">\n                    <h3>Overview and examples</h3>\n                    <div class="btn-toolbar">\n                        <ui:MenuButton label="Show" type="info">\n                            <div>\n                                Hello Menu Button :)\n                            </div>\n                        </ui:MenuButton>\n                        <ui:MenuButton label="Click Me" type="inverse">\n                            <ul class="unstyled">\n                                <li>\n                                    <a href="#">Action</a>\n                                </li>\n                                <li>\n                                    <a href="#">Another action</a>\n                                </li>\n                                <li>\n                                    <a href="#">Something else here</a>\n                                </li>\n                                <li class="divider"></li>\n                                <li>\n                                    <a href="#">Separated link</a>\n                                </li>\n                            </ul>\n                        </ui:MenuButton>\n                    </div>\n                </div>\n                <div class="span8">\n                    <h3>Example markup</h3>\n                    <view:Code data-title="App.xml">\n                        <![CDATA[\n                        <ui:MenuButton label="Show" type="info">\n                            <div>\n                                Hello Menu Button :)\n                            </div>\n                        </ui:MenuButton>\n                    ]]>\n                    </view:Code>\n                </div>\n            </div>\n\n            <br/>\n            <h2>Split Menu Buttons</h2>\n            <div class="row">\n                <div class="span4">\n                    <h3>Overview and examples</h3>\n                    <div class="btn-toolbar">\n                        <ui:SplitButton label="Account">\n                            Some account options\n                        </ui:SplitButton>\n                        <ui:SplitButton label="Show" type="info" iconClass="icon-info-sign icon-white">\n                            Some Menu content\n                        </ui:SplitButton>\n\n                    </div>\n                </div>\n                <div class="span8">\n                    <h3>Example markup</h3>\n                    <view:Code data-title="App.xml">\n                        <![CDATA[\n                       <ui:SplitButton label="Show" type="info" iconClass="icon-add">\n                            Some Menu content\n                        </ui:SplitButton>\n                    ]]>\n                    </view:Code>\n                </div>\n            </div>\n\n        </section>\n\n        <section>\n            <div class="page-header">\n                <h1>\n                    Forms\n                    <small>Create clear forms - in code and UI</small>\n                </h1>\n            </div>\n\n            <blockquote>\n                <p>\n                    Write a few tags, annotate some bindings and it works.\n                </p>\n                <small>Marcus Krejpowicz</small>\n            </blockquote>\n\n            <h2>Html Elements</h2>\n            <div class="row">\n                <div class="span3">\n                    <h3>Form fields</h3>\n                    <field:Text label="Text" value="some text" cid="textInput"/>\n                    <field:Password label="Text" value="mypass" cid="passwordInput"/>\n                </div>\n                <div class="span3">\n                    <h3>Output</h3>\n                    <p>\n                        <strong>Text Input:</strong>\n                        {textInput.value}\n                    </p>\n                    <p>\n                        <strong>Password Input:</strong>\n                        {passwordInput.value}\n                    </p>\n                </div>\n                <div class="span6">\n                    <h3>Example markup</h3>\n                    <p>You can either use the generic Field component, which renders a container with a label and the\n                        the given input, or you can use special fields like Text and Password. More fields are coming\n                        soon.\n                    </p>\n                    <view:Code data-title="App.xml">\n                        <![CDATA[\n                            <ui:Field label="Text">\n                                <input type="text" value="some text"/>\n                            </ui:Field>\n                            <field:Text label="Text" value="some text"/>\n                            <field:Password label="Text" value=""/>\n                        ]]>\n                    </view:Code>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="span3">\n                    <h3>Selections</h3>\n                    <p>\n                        <ui:Checkbox label="I like rAppidJs" cid="chkLike" checked="true"/>\n                    </p>\n                    <p>\n                        <ui:RadioGroup cid="radioGender" value="male">\n                            <ui:Radio label="Male" value="male"/>\n                            <ui:Radio label="Female" value="female"/>\n                        </ui:RadioGroup>\n                    </p>\n\n                </div>\n                <div class="span3">\n                    <h3>Output</h3>\n                    <p visible="{chkLike.checked}">\n                        Thanks for liking us.\n                    </p>\n                    <p visible="{not(chkLike.checked)}">\n                        We are sorry. Please try plain Javascript.\n                    </p>\n                    <p>\n                        You\'re a {radioGender.value}.\n                    </p>\n                </div>\n                <div class="span6">\n                    <h3>Example markup</h3>\n                    <view:Code data-title="App.xml">\n                        <![CDATA[\n                            <ui:Checkbox label="I like rAppidJs" checked="true"/>\n                            <ui:RadioGroup cid="radioGender" value="male">\n                                <ui:Radio label="Male" value="male"/>\n                                <ui:Radio label="Female" value="female"/>\n                            </ui:RadioGroup>\n                        ]]>\n                    </view:Code>\n                </div>\n            </div>\n\n        </section>\n\n        <section>\n            <div class="page-header">\n                <h1>\n                    TabView\n                    <small>A simple way to use Tabs</small>\n                </h1>\n            </div>\n            <div class="row">\n                <div class="span4">\n                    <h3>Simple Tab View</h3>\n                    <ui:TabView>\n                        <ui:Tab title="Tab A">\n                            <p>A Tab View renders it\'s children as Tabs.</p>\n                        </ui:Tab>\n                        <ui:Tab title="Tab B">\n                            Tab Content B\n                        </ui:Tab>\n                        <ui:Tab title="Tab C">\n                            Tab Content C\n                        </ui:Tab>\n                    </ui:TabView>\n                </div>\n                <div class="span8">\n                    <h3>Example Markup</h3>\n                    <view:Code>\n                        <![CDATA[\n                            <ui:TabView>\n                                <ui:Tab title="Tab A">\n                                    <p>A Tab View renders it\'s children as Tabs.</p>\n                                </ui:Tab>\n                                <ui:Tab title="Tab B">\n                                    Tab Content B\n                                </ui:Tab>\n                                <ui:Tab title="Tab C">\n                                    Tab Content C\n                                </ui:Tab>\n                            </ui:TabView>\n                         ]]>\n                    </view:Code>\n                </div>\n            </div>\n        </section>\n\n        <section>\n            <div class="page-header">\n                <h1>\n                    VirtualItemsView\n                    <small>Display huge amounts of data in high-performance</small>\n                </h1>\n            </div>\n            <blockquote>\n                <p>\n                    They just render data that is visible in the current view-port and\n                    also fetches only necessary data-pages from the server.\n                </p>\n                <small>Tony Findeisen</small>\n            </blockquote>\n\n\n            <h2>DataGrid</h2>\n            <div class="row">\n                <div class="span6">\n                    <p>\n                        The DataGrid is a table based component rendering bindable data in\n                        columns.\n                        Each column can be set up with a\n                        <code>Template</code>\n                        defining how to render the data.\n                    </p>\n                    <p>All VirtualItemsViews have a selection model and offer key support for selecting items.\n                        Try it by using the keyboard.\n                    </p>\n\n                    <h3>Code example</h3>\n                    <p>\n                        <view:Code>\n                            <![CDATA[\n                                <ui:DataGrid data="{shop.articles}" rowHeight="45"\n                                             prefetchItemCount="10">\n                                    <ui:DataGridColumn title="Id" path="id"/>\n                                    <ui:DataGridColumn title="Name" path="name"/>\n                                    <ui:DataGridColumn>\n                                      <js:Template name="cell">\n                                        <ui:Button label="Visit" onclick="visit"/>\n                                      </js:Template>\n                                    </ui:DataGridColumn>\n                                </ui:DataGrid>\n                           ]]>\n                        </view:Code>\n                    </p>\n                    <p>\n                        <em>Have a look to the DOM and network-monitor and see that only\n                            necessary items are rendered and requested.\n                            Also take note of the debouncing of 500ms.\n                        </em>\n                    </p>\n                </div>\n                <div class="span6">\n                    <ui:DataGrid data="{shop.articles}" prefetchItemCount="10" cid="grid" onkeydown="_keyHandler">\n                        <ui:DataGridColumn title="Id" width="90" path="id"/>\n                        <ui:DataGridColumn title="Name" width="400" path="name"/>\n                        <ui:DataGridColumn>\n                            <js:Template name="cell">\n                                <ui:Button label="Visit" onclick="_itemClickHandler"/>\n                            </js:Template>\n                        </ui:DataGridColumn>\n                    </ui:DataGrid>\n                    <p>\n                        Selected {grid.selectedItems.size()} of {shop.articles.size()}\n                    </p>\n                </div>\n            </div>\n            <br/>\n            <h2>TileList</h2>\n            <div class="row">\n                <div class="span6">\n                    The TileList is another implementation of VirtualItemsView which displays data in rows and cols. You\n                    can specify a custom renderer for the items.\n                    <h3>Code Example</h3>\n                    <view:Code>\n                        <![CDATA[\n                            <ui:TileList class="article-list"\n                                    data="{shop.articles}"\n                                    prefetchItemCount="10"\n                                    height="300"\n                                    cols="4"\n                                    verticalGap="8"\n                                    horizontalGap="8">\n                                <js:Template name="renderer">\n                                    <sprdView:ArticleImage\n                                        article="{item}" />\n                                </js:Template>\n                            </ui:TileList>\n                        ]]>\n                    </view:Code>\n                </div>\n                <div class="span6">\n                    <ui:TileList class="article-list" data="{shop.articles}" prefetchItemCount="10" height="300" cid="tileList" verticalGap="6" horizontalGap="6" onitemDblClick="_itemClickHandler" onkeyup="_keyHandler">\n                        <js:Template name="renderer">\n                            <sprdView:ArticleImage width="100" height="100" article="{item}"/>\n                        </js:Template>\n                    </ui:TileList>\n                </div>\n            </div>\n            <br/>\n            <h2>Select</h2>\n            <div class="row">\n                <div class="span4">\n                    <h3>\n                        A simple select component\n                    </h3>\n                    <p>\n                        The Select component let\'s you filter and browse a collection of items.\n                        (In this example ca. {shop.articles.size()} shop articles).\n                        You can specify a custom renderer for the selected and the list item.\n                    </p>\n                    <ui:Select data="{shop.articles}" cid="articleSelector" queryCreator="{queryCreator()}" itemHeight="30" width="300">\n                        <js:Template name="selectedItem">\n                            <span class="text-item">\n                                {item.name}\n                            </span>\n                        </js:Template>\n                        <js:Template name="renderer">\n                            <a class="text-item">\n                                {item.name}\n                            </a>\n                        </js:Template>\n                    </ui:Select>\n\n\n                    <br/>\n                    <sprdView:ArticleImage width="100" height="100" article="{articleSelector.selectedItem}" margin-top="20px"/>\n                </div>\n                <div class="span8">\n                    <h3>Code Example</h3>\n                    <view:Code>\n                        <![CDATA[\n                            <ui:Select data="{shop.articles}"\n                                       queryCreator="{queryCreator()}"\n                                       itemHeight="30" width="300">\n                                <js:Template name="selectedItem">\n                                    <span>\n                                        {item.name}\n                                    </span>\n                                </js:Template>\n                                <js:Template name="renderer">\n                                    <a>\n                                        {item.name}\n                                    </a>\n                                </js:Template>\n                            </ui:Select>\n                        ]]>\n                    </view:Code>\n\n                </div>\n            </div>\n        </section>\n        <section>\n            <div class="page-header">\n                <h1>\n                    Windows and Dialogs\n                </h1>\n            </div>\n            <h2>Dialogs</h2>\n            <div class="row">\n                <div class="span3">\n                    <p>\n                        Dialogs can be created by extending the Dialog Component.\n                        You can specify content for the body and the footer.\n                        The dialog can be shown by calling\n                        <code>showModal</code>\n                    </p>\n                    <js:Content name="wtf">\n                        <example:CustomDialog cid="myDialog"/>\n                    </js:Content>\n                    <ui:Button label="Show Window" size="large" type="primary" onclick="_openDialog"/>\n                </div>\n                <div class="span9">\n                    <ui:TabView>\n                        <ui:Tab title="CustomDialog.xml">\n                            <view:Code>{customDialogExample}</view:Code>\n                        </ui:Tab>\n                        <ui:Tab title="Dialog Integration">\n                            <view:Code>\n                                <![CDATA[\n                                    <js:Content>\n                                     <example:CustomDialog cid="myDialog"/>\n                                    </js:Content>\n                                    <ui:Button label="Show Window" onclick="_openDialog"/>\n                                ]]>\n                            </view:Code>\n                        </ui:Tab>\n\n                        <ui:Tab title="Show Dialog">\n                            <view:Code>\n                                <![CDATA[\n                                    _openDialog: function(e){\n                                        this.$.myDialog.showModal(function(){\n                                            // handle close\n                                        });\n                                    }\n                                ]]>\n                            </view:Code>\n                        </ui:Tab>\n                    </ui:TabView>\n                </div>\n\n            </div>\n        </section>\n    </js:Content>\n</module:UiClass>')})}),define("app/module/Ui",function(){});