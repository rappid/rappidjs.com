define(["js/ui/View","js/type/Color"],function(e,t){return e.inherit("js.ui.ColorPickerClass",{defaults:{color:t.HSB,paletteSize:300,_palettePosition:{x:0,y:0},_scale:0},events:["on:colorSelect"],_imageMouseDown:function(e){e.preventDefault()},_paletteMouseDown:function(e){this.$mouseDown=!0;var t=e.pointerEvent,n=this.globalToLocal({x:t.pageX,y:t.pageY});e.preventDefault();var r=this;this.$moveHandler||(this.$moveHandler=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation();if(r.$mouseDown){e.changedTouches&&(e=e.changedTouches[0]);var t=r.$.paletteImage.globalToLocal({x:e.pageX,y:e.pageY});r._updateColorAndPaletteCursor(t),r._triggerColorChange()}return!1}),this.$upHandler||(this.$upHandler=function(){r.$mouseDown=!1,r.dom(r.$stage.$window).unbindDomEvent("pointermove",r.$moveHandler),r.dom(r.$stage.$window).unbindDomEvent("pointerup",r.$upHandler)}),this.dom(this.$stage.$window).bindDomEvent("pointermove",this.$moveHandler),this.dom(this.$stage.$window).bindDomEvent("pointerup",this.$upHandler),this._updateColorAndPaletteCursor(n),this._triggerColorChange()},_updateColorAndPaletteCursor:function(e){e.x=e.x<0?0:e.x,e.x=e.x>this.$.paletteSize?this.$.paletteSize:e.x,e.y=e.y<0?0:e.y,e.y=e.y>this.$.paletteSize?this.$.paletteSize:e.y;var n=100*(1-e.y/this.$.paletteSize),r=100*(e.x/this.$.paletteSize),i=this.$.color.toHSB();this.set("color",new t.HSB(i.h,Math.round(r),Math.round(n)))},_updateColorAndHueCursor:function(e){e=e<0?0:e,e=e>this.$.paletteSize?this.$.paletteSize:e;var n=this.$.color.toHSB(),r=Math.round(360*(1-e/this.$.paletteSize));r=r>=360?359:r,this.set("color",new t.HSB(r,n.s,n.b))},_triggerColorChange:function(){this.$triggerColorTimeout&&clearTimeout(this.$triggerColorTimeout);var e=this;this.$triggerColorTimeout=setTimeout(function(){e.trigger("on:colorSelect",e.$.color)},300)},_renderColor:function(e){if(e){var t=e.toHSB(),n={x:Math.round(this.$.paletteSize*t.s*.01),y:Math.round(this.$.paletteSize*(1-t.b*.01))};this.set({_palettePosition:n,_scale:Math.round(this.$.paletteSize*(1-t.h/360))})}},_commitColor:function(e,t){e&&(!t||e.toHSB().h!==t.toHSB().h)&&this.trigger("hueChanged")},_hueBarDown:function(e){this.$hueBarDown=!0;var t=this;this.$hueBarMoveHandler||(this.$hueBarMoveHandler=function(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation(),t.$hueBarDown&&(e.changedTouches&&(e=e.changedTouches[0]),t._updateColorAndHueCursor(t.$.hueBar.globalToLocal({x:0,y:e.pageY}).y),t._triggerColorChange()),!1}),this.$hueBarUpHandler||(this.$hueBarUpHandler=function(e){t.$hueBarDown=!1,t.dom(t.$stage.$window).unbindDomEvent("pointermove",t.$hueBarMoveHandler),t.dom(t.$stage.$window).unbindDomEvent("pointerup",t.$hueBarUpHandler)}),this.dom(this.$stage.$window).bindDomEvent("pointermove",this.$hueBarMoveHandler),this.dom(this.$stage.$window).bindDomEvent("pointerup",this.$hueBarUpHandler),this._updateColorAndHueCursor(e.target.globalToLocal({x:0,y:e.pointerEvent.pageY}).y),this._triggerColorChange()},_backgroundColor:function(){if(this.$.color){var e=this.$.color.toHSB();return(new t.HSB(e.h,100,100)).toRGB()}return t.RGB(0,0,0)}.on("hueChanged"),_preventDefault:function(e){e.preventDefault()}})});